!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="45492674-3130-4387-b050-99e1afe8bcaa",e._sentryDebugIdIdentifier="sentry-dbid-45492674-3130-4387-b050-99e1afe8bcaa")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3835,8426],{7887:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/editor/[id]",function(){return n(99836)}])},12615:(e,t,n)=>{"use strict";n.d(t,{A:()=>P});var o=n(80263),l=n(77877),a=n(59153),i=n.n(a),r=n(73969),s=n(12862),c=n(97872),d=n(60709),u=n(32144),m=n(80251),f=n(17613),h=n(96557),g=n(81979),x=n(32036),p=n(86118),v=n(52723);async function y(e){let{projectRef:t,connectionString:n,table:o,filters:l,roleImpersonationState:a}=e,i=(0,g.Nf)(function(e){var t;let{table:n,filters:o}=e,l=new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).delete();return o.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,v.b)(n,e);l=l.filter(e.column,e.operator,t)}),l.toSql()}({table:o,filters:l}),a),{result:r}=await (0,h.E)({projectRef:t,connectionString:n,sql:i,isRoleImpersonationEnabled:(0,x._c)(null==a?void 0:a.role)});return r}let b=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.jE)();return(0,m.n)(e=>y(e),{async onSuccess(t,n,l){let{projectRef:a,table:i}=n;await o.invalidateQueries(p.j.tableRowsAndCount(a,i.id)),await (null==e?void 0:e(t,n,l))},async onError(e,n,o){void 0===t?r.oR.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,o)},...n})};var w=n(63720),j=n(23992);async function C(e){let{projectRef:t,connectionString:n,table:o,rows:l,roleImpersonationState:a}=e,i=(0,g.Nf)(function(e){var t;let{table:n,rows:o}=e,{primaryKeys:l,error:a}=(0,v.j)({table:n});if(a)throw a;let i=new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).delete();return null==l||l.forEach(e=>{let t=o.map(t=>t[e]);i=i.filter(e,"in",t)}),i.toSql()}({table:o,rows:l}),a),{result:r}=await (0,h.E)({projectRef:t,connectionString:n,sql:i,isRoleImpersonationEnabled:(0,x._c)(null==a?void 0:a.role)});return r}let N=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,u.jE)();return(0,m.n)(e=>C(e),{async onSuccess(t,n,o){let{projectRef:a,table:i}=n;await l.invalidateQueries(p.j.tableRowsAndCount(a,i.id)),await (null==e?void 0:e(t,n,o))},async onError(e,n,l){if(void 0===t){let{table:t,rows:l}=n,a=e.message.includes("Please add a primary key column"),i=e.message.includes("violates foreign key constraint"),s=l.length>1;if(i){let n=t.name,l=e.message.split("on table ")[2].replaceAll('"',""),a=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),i=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(l,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(l,"`."),c="Set an on delete behavior on the foreign key relation `".concat(a,"` in the `").concat(l,"` table to automatically respond when row(s) are being deleted in the `").concat(n,"` table.");(0,r.oR)(i,{description:(0,o.jsx)(w.o,{content:c,className:"[&>p]:m-0"}),action:(0,o.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,o.jsx)(j.A,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else a?(0,r.oR)("Unable to delete row(s) as table has no primary keys",{description:(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)(j.A,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):r.oR.error("Failed to delete table row: ".concat(e.message))}else t(e,n,l)},...n})};async function S(e){let{projectRef:t,connectionString:n,table:o}=e,l=function(e){var t;let{table:n}=e;return new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).truncate().toSql()}({table:o}),{result:a}=await (0,h.E)({projectRef:t,connectionString:n,sql:l});return a}let D=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.jE)();return(0,m.n)(e=>S(e),{async onSuccess(t,n,l){let{projectRef:a,table:i}=n;await o.invalidateQueries(p.j.tableRowsAndCount(a,i.id)),await (null==e?void 0:e(t,n,l))},async onError(e,n,o){void 0===t?r.oR.error("Failed to truncate table row: ".concat(e.message)):t(e,n,o)},...n})};var k=n(69817),E=n(39321),R=n(65511),T=n(70324),A=n(71126),I=n(64540);let P=e=>{var t,n,a,u,m,f,h,g,p;let{selectedTable:v,onTableDeleted:y}=e,{project:w}=(0,c.Om)(),j=(0,E.ap)(),{filters:C,onApplyFilters:S}=(0,s.M)(),P=e=>{let{columnName:t}=e;S(C.filter(e=>e.column!==t))},{mutate:_}=(0,d.T)({onSuccess:()=>{var e;if((null==(e=j.confirmationDialog)?void 0:e.type)!=="column")return;let t=j.confirmationDialog.column;P({columnName:t.name}),r.oR.success('Successfully deleted column "'.concat(t.name,'"'))},onError:e=>{var t;if((null==(t=j.confirmationDialog)?void 0:t.type)!=="column")return;let n=j.confirmationDialog.column;r.oR.error("Failed to delete ".concat(n.name,": ").concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:L}=(0,k.A)({onSuccess:async()=>{r.oR.success('Successfully deleted table "'.concat(null==v?void 0:v.name,'"')),null==y||y()},onError:e=>{r.oR.error("Failed to delete ".concat(null==v?void 0:v.name,": ").concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:O,isLoading:M}=N({onSuccess:()=>{var e,t,n;(null==(e=j.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=j.confirmationDialog).callback)||t.call(n)),r.oR.success("Successfully deleted selected row(s)")},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:F,isLoading:G}=b({onSuccess:()=>{var e,t,n;(null==(e=j.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=j.confirmationDialog).callback)||t.call(n)),r.oR.success("Successfully deleted selected rows")},onError:e=>{r.oR.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:z,isLoading:K}=D({onSuccess:()=>{var e,t,n;(null==(e=j.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=j.confirmationDialog).callback)||t.call(n)),r.oR.success("Successfully deleted all rows from table")},onError:e=>{r.oR.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),Q=(null==(t=j.confirmationDialog)?void 0:t.type)==="row"&&j.confirmationDialog.allRowsSelected,W=(null==(n=j.confirmationDialog)?void 0:n.type)==="row"?j.confirmationDialog.allRowsSelected?null!=(p=j.confirmationDialog.numRows)?p:0:j.confirmationDialog.rows.length:0,q=((null==(a=j.confirmationDialog)?void 0:a.type)==="column"||(null==(u=j.confirmationDialog)?void 0:u.type)==="table")&&j.confirmationDialog.isDeleteWithCascade,$=async()=>{var e;if((null==(e=j.confirmationDialog)?void 0:e.type)!=="column"||void 0===w)return;let t=j.confirmationDialog.column;void 0!==t&&_({column:t,cascade:q,projectRef:w.ref,connectionString:null==w?void 0:w.connectionString})},U=async()=>{var e;(null==(e=j.confirmationDialog)?void 0:e.type)==="table"&&void 0!==v&&L({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,id:v.id,name:v.name,schema:v.schema,cascade:q})},H=(0,x.Qj)(),V=async()=>{var e;if(!w)return console.error("Project ref is required");if(!v)return console.error("Selected table required");if((null==(e=j.confirmationDialog)?void 0:e.type)!=="row")return;let t=j.confirmationDialog.rows;if(j.confirmationDialog.allRowsSelected)if(0===C.length){if(void 0!==H().role)return j.closeConfirmationDialog(),r.oR.error("Table truncation is not supported when impersonating a role");z({projectRef:w.ref,connectionString:w.connectionString,table:v})}else F({projectRef:w.ref,connectionString:w.connectionString,table:v,filters:C,roleImpersonationState:H()});else O({projectRef:w.ref,connectionString:w.connectionString,table:v,rows:t,roleImpersonationState:H()})};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(I.A,{variant:"destructive",size:"small",visible:(null==(m=j.confirmationDialog)?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null==(f=j.confirmationDialog)?void 0:f.type)==="column"&&j.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{j.closeConfirmationDialog()},onConfirm:$,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,o.jsx)(R.A,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:q,onChange:()=>j.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),q&&(0,o.jsxs)(T.Fc,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,o.jsx)(T.XL,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,o.jsx)(T.TN,{children:(0,o.jsx)(A.$,{asChild:!0,size:"tiny",type:"default",icon:(0,o.jsx)(l.A,{}),children:(0,o.jsx)(i(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,o.jsx)(I.A,{variant:"destructive",size:"small",visible:(null==(h=j.confirmationDialog)?void 0:h.type)==="table",title:(0,o.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==v?void 0:v.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{j.closeConfirmationDialog()},onConfirm:U,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,o.jsx)(R.A,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:q,onChange:()=>j.toggleConfirmationIsWithCascade(!q),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),q&&(0,o.jsxs)(T.Fc,{variant:"warning",children:[(0,o.jsx)(T.XL,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,o.jsx)(T.TN,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,o.jsx)(T.TN,{className:"mt-4",children:(0,o.jsx)(A.$,{asChild:!0,size:"tiny",type:"default",icon:(0,o.jsx)(l.A,{}),children:(0,o.jsx)(i(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,o.jsx)(I.A,{variant:"destructive",size:"small",visible:(null==(g=j.confirmationDialog)?void 0:g.type)==="row",title:(0,o.jsxs)("p",{className:"break-words",children:[(0,o.jsx)("span",{children:"Confirm to delete the selected row"}),(0,o.jsx)("span",{children:W>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>j.closeConfirmationDialog(),onConfirm:()=>V(),loading:K||M||G,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,o.jsx)("div",{className:"space-y-4",children:(0,o.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,o.jsx)("span",{children:"Are you sure you want to delete "}),(0,o.jsxs)("span",{children:[Q?"all":"the selected"," "]}),(0,o.jsx)("span",{children:W>1&&"".concat(W," ")}),(0,o.jsx)("span",{children:"row"}),(0,o.jsx)("span",{children:W>1&&"s"}),(0,o.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},61992:(e,t,n)=>{"use strict";n.d(t,{K:()=>a});var o=n(53239);function l(e,t){return e.indexOf(t)>=0}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],[a,i]=o.useState(),r=o=>{var a;if(!e||l(t,o.target.nodeName)||l(n,o.target.className))return;let r=(a=o).metaKey&&a.shiftKey?"Command+Shift+".concat(a.key):a.metaKey?"Command+".concat(a.key):a.shiftKey&&"Enter"===a.key?"Shift+".concat(a.key):a.ctrlKey&&a.key?"Control+".concat(a.key):a.key;e[r]&&(r.includes("+")?(o.preventDefault(),e[r](o),i(null)):(i(o.key),o.preventDefault()))},s=t=>{e&&e[t.key]&&a===t.key&&(t.preventDefault(),e[t.key](t),i(null))};o.useEffect(()=>(window.addEventListener("keydown",r),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",s)}))}},83076:(e,t,n)=>{"use strict";n.d(t,{C:()=>a});var o=n(80263),l=n(51859);let a=e=>{let{children:t,className:n}=e;return(0,o.jsx)("div",{className:(0,l.cn)("flex min-h-9 h-9 overflow-hidden overflow-x-auto items-center px-2 w-full border-t",n),"data-sentry-component":"GridFooter","data-sentry-source-file":"GridFooter.tsx",children:t})}},99836:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>e_});var o=n(80263),l=n(53239),a=n(19898),i=n(60045),r=n(59153),s=n.n(r),c=n(47504),d=n(77395),u=n(22745),m=n(37034),f=n(97872),h=n(74945),g=n(47328),x=n(32036),p=n(39321),v=n(8246),y=n(61992);function b(e){let{gridRef:t,rows:n}=e,o=(0,v.Ir)(),a=(0,l.useMemo)(()=>{var e,t;return"windows"==((null==(e=navigator)?void 0:e.appVersion.indexOf("Win"))!==-1?"windows":(null==(t=navigator)?void 0:t.appVersion.indexOf("Mac"))!==-1?"macos":"unknown")?"Control":"Command"},[]);return(0,y.K)({["".concat(a,"+ArrowUp")]:e=>{if(e.stopPropagation(),o.selectedCellPosition){var n,l;let e={idx:null!=(l=null==(n=o.selectedCellPosition)?void 0:n.idx)?l:0,rowIdx:0};t.current.selectCell(e)}else t.current.scrollToCell({rowIdx:Number(0)})},["".concat(a,"+ArrowDown")]:e=>{if(e.stopPropagation(),o.selectedCellPosition){var l,a;let e={idx:null!=(a=null==(l=o.selectedCellPosition)?void 0:l.idx)?a:0,rowIdx:n.length>1?n.length-1:0};t.current.selectCell(e)}else t.current.scrollToCell({rowIdx:Number(n.length)})},["".concat(a,"+ArrowLeft")]:e=>{var n,l;e.stopPropagation();let a={idx:o.gridColumns.filter(e=>e.frozen).length,rowIdx:null!=(l=null==(n=o.selectedCellPosition)?void 0:n.rowIdx)?l:0};t.current.selectCell(a)},["".concat(a,"+ArrowRight")]:e=>{var n,l,a;e.stopPropagation(),null==(l=t.current)||l.selectCell({idx:o.gridColumns.length-2,rowIdx:null!=(a=null==(n=o.selectedCellPosition)?void 0:n.rowIdx)?a:0})}},["INPUT","TEXTAREA","SELECT"]),null}var w=n(83076),j=n(65634),C=n(49015),N=n(42592),S=n(69147),D=n(64685),k=n(54640),E=n(76733),R=n(87959),T=n(12862),A=n(68495),I=n(71126),P=n(16632),_=n(64459),L=n(64540),O=n(28642);let M=e=>{if(0===e)return"0";let t=Math.floor(Math.log(e)/Math.log(1e3)),n=t>4?"T":["","K","M","B","T"][t];return"".concat((e/Math.pow(1e3,t>4?4:t)).toFixed(1)).concat(n)},F=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}],G=()=>{var e,t;let{id:n}=(0,a.g)(),i=n?Number(n):void 0,{project:r}=(0,f.Om)(),s=(0,p.ap)(),c=(0,v.Ir)(),{data:d}=(0,C.Pk)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:i}),u=(0,N.bI)(d)?d.live_rows_estimate:null,{filters:m}=(0,T.M)(),h=c.page,g=(0,x.RY)(),[y,b]=(0,l.useState)(!1),[w,j]=(0,l.useState)(!1),[S,D]=(0,l.useState)(!1),[G,z]=(0,l.useState)(h.toString());(0,l.useEffect)(()=>{z(String(h))},[h]);let{data:K,isLoading:Q,isSuccess:W,isError:q,isFetching:$,error:U}=(0,A.gt)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,tableId:c.table.id,filters:m,enforceExactCount:c.enforceExactCount,roleImpersonationState:g},{keepPreviousData:!0}),H=(null==K?void 0:K.is_estimate)?M(K.count):null==K?void 0:K.count.toLocaleString(),V=Math.ceil((null!=(e=null==K?void 0:K.count)?e:0)/s.rowsPerPage),X=(null!=(t=null==K?void 0:K.count)?t:0)>0?V:1,Y=()=>{B()},Z=()=>{J()},B=()=>{let e=h-1;c.setPage(e)},J=()=>{let e=h+1;c.setPage(e)},ee=e=>{let t=e>V?V:e;c.setPage(t||1)};return(0,l.useEffect)(()=>{h&&h>X&&c.setPage(X)},[h,X]),(0,l.useEffect)(()=>{void 0!==i&&c.setEnforceExactCount(null!==u&&u<=A.kd)},[i]),(0,l.useEffect)(()=>{q&&c.enforceExactCount&&(null==U?void 0:U.code)===408&&c.setEnforceExactCount(!1)},[q,c.enforceExactCount,null==U?void 0:U.code]),(0,o.jsxs)("div",{className:"flex items-center gap-x-4","data-sentry-component":"Pagination","data-sentry-source-file":"Pagination.tsx",children:[Q&&(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading records count..."}),W&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,o.jsx)(I.$,{icon:(0,o.jsx)(k.A,{}),type:"outline",className:"px-1.5",disabled:h<=1||Q,onClick:()=>{h>1&&(c.selectedRows.size>=1?j(!0):B())}}),(0,o.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,o.jsx)(_.p,{className:"w-12",size:"tiny",min:1,max:V,value:G,onChange:e=>z(e.target.value),onKeyDown:e=>{let t=Number(G);"Enter"===e.code&&!Number.isNaN(t)&&t>=1&&t<=V&&ee(t)}}),(0,o.jsxs)("p",{className:"text-xs text-foreground-light",children:["of ",X.toLocaleString()]}),(0,o.jsx)(I.$,{icon:(0,o.jsx)(E.A,{}),type:"outline",className:"px-1.5",disabled:h>=V||Q,onClick:()=>{h<V&&(c.selectedRows.size>=1?b(!0):J())}}),(0,o.jsx)(O.X,{options:F,onSelect:e=>{let t=Number(e);s.setRowsPerPage(isNaN(t)?100:t)},side:"top",align:"start",children:(0,o.jsx)(I.$,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,o.jsx)("span",{children:"".concat(s.rowsPerPage," rows")})})})]}),(0,o.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,o.jsxs)("p",{className:"text-xs text-foreground-light",children:["".concat(H," ").concat(0===K.count||K.count>1?"records":"record")," ",K.is_estimate?"(estimated)":""]}),K.is_estimate&&(0,o.jsxs)(P.m_,{children:[(0,o.jsx)(P.k$,{asChild:!0,children:(0,o.jsx)(I.$,{size:"tiny",type:"text",className:"px-1.5",loading:$,icon:(0,o.jsx)(R.A,{}),onClick:()=>{null===u||K.count>A.kd?D(!0):c.setEnforceExactCount(!0)}})}),(0,o.jsxs)(P.ZI,{side:"top",className:"w-72",children:["This is an estimated value as your table has more than"," ",A.kd.toLocaleString()," rows. ",(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:"text-brand",children:"Click to retrieve the exact count of the table."})]})]})]})]}),q&&(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."}),(0,o.jsx)(L.A,{visible:w,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>j(!1),onConfirm:()=>{Y()},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"Pagination.tsx",children:(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,o.jsx)(L.A,{visible:y,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>b(!1),onConfirm:()=>{Z()},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"Pagination.tsx",children:(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,o.jsx)(L.A,{variant:"warning",visible:S,title:"Confirm to fetch exact count for table",confirmLabel:"Retrieve exact count",onCancel:()=>D(!1),onConfirm:()=>{c.setEnforceExactCount(!0),D(!1)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"Pagination.tsx",children:(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:null===u?"If your table has a row count of greater than ".concat(A.kd.toLocaleString()," rows,\n          retrieving the exact count of the table may cause performance issues on your database."):"Your table has a row count of greater than ".concat(A.kd.toLocaleString()," rows, and\n          retrieving the exact count of the table may cause performance issues on your database.")})})]})},z=e=>{let{isRefetching:t}=e,{project:n}=(0,f.Om)(),{id:l}=(0,a.g)(),i=l?Number(l):void 0,{data:r}=(0,C.Pk)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,id:i}),[{view:s="data"},c]=(0,S.W)(),d=(0,N.b4)(r),u=(0,N.KO)(r);return(0,o.jsxs)(w.C,{"data-sentry-element":"GridFooter","data-sentry-component":"Footer","data-sentry-source-file":"Footer.tsx",children:["data"===s&&(0,o.jsx)(G,{}),(0,o.jsxs)("div",{className:"ml-auto flex items-center gap-x-2",children:[r&&"data"===s&&(0,o.jsx)(D.A,{tableId:r.id,isRefetching:t}),(d||u)&&(0,o.jsx)(j.A,{width:75,options:["definition","data"],activeOption:s,borderOverride:"border",onClickOption:e=>{"data"===e?c({view:void 0}):c({view:e})}})]})]})};var K=n(24560),Q=n(417),W=n(70710),q=n(48153),$=n(93007),U=n(64652),H=n(34969),V=n(51859),X=n(49655),Y=n(32144),Z=n(73969),B=n(63851),J=n(23992),ee=n(86118),et=n(63189),en=n(9711),eo=n(82347);function el(e,t){let{show:n}=(0,en.EF)();return(0,o.jsx)(K.fI,{...t,onContextMenu:function(e){n(e,{id:eo.JY,props:{rowIdx:t.rowIdx}})},"data-sentry-element":"Row","data-sentry-component":"RowRenderer","data-sentry-source-file":"RowRenderer.tsx"},e)}let ea=e=>{var t;return null!=(t=null==e?void 0:e.idx)?t:-1},ei=(0,l.memo)((0,l.forwardRef)((e,t)=>{var n;let{width:a,height:i,containerClass:r,gridClass:s,rowClass:c,rows:d,error:u,isLoading:m,isSuccess:h,isError:g,filters:y,onApplyFilters:b}=e,w=(0,p.ap)(),j=(0,v.Ir)(),C=function(e){let{project:t}=(0,f.Om)(),n=(0,v.Ir)(),a=(0,Y.jE)(),i=(0,x.Qj)(),{mutate:r}=(0,et.oG)({async onMutate(e){let{projectRef:t,table:n,configuration:o,payload:l}=e,i=new Set(Object.keys(o.identifiers)),r=ee.j.tableRows(t,{table:{id:n.id}});await a.cancelQueries(r);let s=a.getQueriesData(r);return a.setQueriesData(r,e=>{var t;return{rows:null!=(t=null==e?void 0:e.rows.map(e=>Object.entries(e).filter(e=>{let[t]=e;return i.has(t)}).every(e=>{let[t,n]=e;return n===o.identifiers[t]})?{...e,...l}:e))?t:[]}}),{previousRowsQueries:s}},onError(e,t,n){var o;let{previousRowsQueries:l}=n;l.forEach(e=>{let[t,n]=e;n&&a.setQueriesData(t,n),a.invalidateQueries(t)}),Z.oR.error(null!=(o=null==e?void 0:e.message)?o:e)}});return(0,l.useCallback)((l,a)=>{var s;if(!t)return;let c=l[a.indexes[0]],d=e.find(e=>e.idx==c.idx),u=Object.keys(c).find(e=>c[e]!==d[e]);if(!d||!u)return;let m={[u]:c[u]},f=null==(s=n.originalTable.columns)?void 0:s.filter(e=>{var t;return(null!=(t=null==e?void 0:e.enums)?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),h={};if((0,N.KO)(n.originalTable)&&n.originalTable.primary_keys.forEach(e=>{let t=n.originalTable.columns.find(t=>t.name===e.name);h[e.name]=(null==t?void 0:t.format)==="bytea"?(0,B.ds)(d[e.name]):d[e.name]}),0===Object.keys(h).length)return(0,Z.oR)("Unable to update row as table has no primary keys",{description:(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)(J.A,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})});r({projectRef:t.ref,connectionString:t.connectionString,table:n.originalTable,configuration:{identifiers:h},payload:m,enumArrayColumns:f,roleImpersonationState:i()})},[i,r,t,e,n.originalTable])}(d),S=(0,l.useRef)(null),D=j.table,{mutate:k}=(0,U.h)(),E=(0,H.a)(),{project:R}=(0,f.Om)(),{data:T}=(0,$.Hw)({projectRef:null==R?void 0:R.ref,connectionString:null==R?void 0:R.connectionString,schema:null!=(n=null==D?void 0:D.schema)?n:void 0}),A=()=>{b([])};return(0,o.jsxs)("div",{className:(0,V.cn)("flex flex-col relative",r),style:{width:a||"100%",height:i||"50vh"},children:[0===(null!=d?d:[]).length&&(0,o.jsxs)("div",{style:{height:"calc(100% - 35px)"},className:"absolute top-9 p-2 w-full z-[1] pointer-events-none",children:[m&&(0,o.jsx)(X.y,{}),g&&(0,o.jsx)(q.A,{className:"pointer-events-auto",error:u,subject:"Failed to retrieve rows from table",children:y.length>0&&(0,o.jsx)("p",{children:"Verify that the filter values are correct, as the error may stem from an incorrectly applied filter"})}),h&&(0,o.jsx)(o.Fragment,{children:0===(null!=y?y:[]).length?(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,o.jsx)("p",{className:"text-sm text-light",children:"This table is empty"}),(0,o.jsx)("p",{className:"text-sm text-light mt-1",children:"Add rows to your table to get started."}),(0,o.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,o.jsx)(I.$,{type:"default",className:"pointer-events-auto",onClick:()=>{var e,t;w.onImportData(),k({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!=(e=null==R?void 0:R.ref)?e:"Unknown",organization:null!=(t=null==E?void 0:E.slug)?t:"Unknown"}})},children:"Import data from CSV"})})]}):(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full",children:[(0,o.jsx)("p",{className:"text-sm text-light",children:"The filters applied have returned no results from this table"}),(0,o.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,o.jsx)(I.$,{type:"default",className:"pointer-events-auto",onClick:()=>A(),children:"Remove all filters"})})]})})]}),(0,o.jsx)(K.Ay,{ref:t,className:"".concat(s," flex-grow"),rowClass:c,columns:j.gridColumns,rows:null!=d?d:[],renderers:{renderRow:el},rowKeyGetter:ea,selectedRows:j.selectedRows,onColumnResize:j.updateColumnSize,onRowsChange:C,onSelectedCellChange:function(e){S.current=e,j.setSelectedCellPosition({idx:e.column.idx,rowIdx:e.rowIdx})},onSelectedRowsChange:function(e){j.setSelectedRows(e)},onCellDoubleClick:e=>(function(e,t){let n=function(e){var t,n;let{targetTableSchema:o,targetTableName:l,targetColumnName:a}=null!=(n=null==D||null==(t=D.columns.find(t=>t.name==e))?void 0:t.foreignKey)?n:{},i=null==T?void 0:T.find(t=>t.source_schema===(null==D?void 0:D.schema)&&t.source_table===(null==D?void 0:D.name)&&t.source_columns.includes(e)&&t.target_schema===o&&t.target_table===l&&t.target_columns.includes(a));return void 0!==i?(0,W.C)([i])[0]:void 0}(t.name);n&&w.onEditForeignKeyColumnValue({foreignKey:n,row:e,column:t})})(e.row,e.column),onCellKeyDown:Q.GL})]})}));var er=n(63134),es=n(1964);let ec=e=>{var t;let{customHeader:n,gridProps:i,children:r}=e,{id:s}=(0,a.g)(),c=s?Number(s):void 0,{project:y}=(0,f.Om)(),w=(0,p.ap)(),j=(0,v.Ir)(),C=(0,l.useRef)(null),[N,S]=(0,l.useState)(!1),{filters:D,onApplyFilters:k}=(0,T.M)(),{sorts:E,onApplySorts:R}=(0,es.G)(),A=(0,x.RY)(),{data:I,error:P,isSuccess:_,isError:L,isLoading:O,isRefetching:M}=(0,h.vs)({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,tableId:c,sorts:E,filters:D,page:j.page,limit:w.rowsPerPage,roleImpersonationState:A},{keepPreviousData:!0,retryDelay:(e,t)=>{var n,o,l;let a=t&&(null==(n=t.message)?void 0:n.includes("does not exist")),i=null==(o=t.message)?void 0:o.includes("Too Many Requests"),r=null==(l=t.message)?void 0:l.includes("query vault failed");return(a&&R([]),e>3||a||i||r)?1/0:5e3}});(0,l.useEffect)(()=>{N||S(!0)},[]);let F=null!=(t=null==I?void 0:I.rows)?t:g.Oj;return(0,o.jsx)(d.Q,{backend:u.t2,context:window,"data-sentry-element":"DndProvider","data-sentry-component":"SupabaseGrid","data-sentry-source-file":"SupabaseGrid.tsx",children:(0,o.jsxs)("div",{className:"sb-grid h-full flex flex-col",children:[(0,o.jsx)(er.Ay,{customHeader:n,"data-sentry-element":"Header","data-sentry-source-file":"SupabaseGrid.tsx"}),r||(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ei,{ref:C,...i,rows:F,error:P,isLoading:O,isSuccess:_,isError:L,filters:D,onApplyFilters:k}),(0,o.jsx)(z,{isRefetching:M}),(0,o.jsx)(b,{gridRef:C,rows:F})]}),N&&(0,m.createPortal)((0,o.jsx)(eo.Td,{rows:F}),document.body)]})})};var ed=n(61607),eu=n(77227),em=n(25321),ef=n(68875),eh=n(82008),eg=n(22787),ex=n(56163),ep=n(10406),ev=n(12615),ey=n(99599),eb=n(14360),ew=n(796),ej=n(96457),eC=n(66152),eN=n(73237),eS=n(17271),eD=n(49443);let ek=e=>{let{entity:t}=e,{ref:n}=(0,a.g)(),i=(0,l.useRef)(null),r=(0,l.useRef)(null),{resolvedTheme:c}=(0,ew.D)(),{project:d}=(0,f.Om)(),u=(0,eN.G_)({id:null==t?void 0:t.id,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString},{enabled:(0,N.b4)(t)}),m=(0,eC.$)({id:null==t?void 0:t.id,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString},{enabled:(0,N.KO)(t)}),{data:h,isLoading:g}=(0,N.b4)(t)?u:m,x=(0,N.eg)(t)?"create view ".concat(t.schema,".").concat(t.name," as\n"):(0,N.rW)(t)?"create materialized view ".concat(t.schema,".").concat(t.name," as\n"):"",p=(0,l.useMemo)(()=>h?(0,eS.A)(x+h):void 0,[h]),v=async(e,t)=>{i.current=e,r.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eD.wR)(500),null==e||e.focus()};return g?(0,o.jsxs)("div",{className:"h-full grid",children:[(0,o.jsx)("div",{className:"p-4",children:(0,o.jsx)(ej.y,{})}),(0,o.jsx)("div",{className:"mt-auto",children:(0,o.jsx)(z,{})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,o.jsx)(I.$,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10","data-sentry-element":"Button","data-sentry-source-file":"TableDefinition.tsx",children:(0,o.jsx)(s(),{href:"/project/".concat(n,"/sql/new?content=").concat(encodeURIComponent(null!=p?p:"")),"data-sentry-element":"Link","data-sentry-source-file":"TableDefinition.tsx",children:"Open in SQL Editor"})}),(0,o.jsx)(eb.default,{className:"monaco-editor",theme:(null==c?void 0:c.includes("dark"))?"vs-dark":"vs",onMount:v,defaultLanguage:"pgsql",value:p,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},"data-sentry-element":"Editor","data-sentry-source-file":"TableDefinition.tsx"})]}),(0,o.jsx)(z,{"data-sentry-element":"Footer","data-sentry-source-file":"TableDefinition.tsx"})]})},eE=e=>{var t;let{isLoadingSelectedTable:n=!1,selectedTable:r}=e,d=(0,c.useRouter)(),u=(0,ef.KT)(),m=(0,eg.qM)(),{ref:f,id:h}=(0,a.g)(),g=(0,ex.zv)(),{selectedSchema:x}=(0,em.k)();(0,Q.VO)({projectRef:f,table:r});let[{view:p="data"}]=(0,S.W)(),y=(0,eu.SE)(i.aG.TENANT_SQL_ADMIN_WRITE,"tables"),b=(0,eu.SE)(i.aG.TENANT_SQL_ADMIN_WRITE,"columns"),w=h?g.openTabs.find(e=>e.endsWith(h)):void 0,j=g.openTabs.filter(e=>!e.startsWith("sql"));(0,ed.Jc)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString});let C=(0,l.useCallback)(()=>{f&&m.setDashboardHistory(f,"editor",void 0)},[m,f]),D=(0,l.useCallback)(e=>{d.push("/project/".concat(f,"/editor/").concat(e.id))},[f,d]),k=(0,l.useCallback)(async()=>{if(r){let e=(0,ex.lW)(r.entity_type,{id:r.id});g.handleTabClose({id:e,router:d,editor:"table",onClearDashboardHistory:C})}},[C,d,r,g]);if(n||!f)return(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("div",{className:"h-10 bg-dash-sidebar dark:bg-surface-100"}),(0,o.jsx)("div",{className:"h-9 border-y"}),(0,o.jsx)("div",{className:"p-2 col-span-full",children:(0,o.jsx)(X.y,{})})]});if(!r)return(0,o.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,o.jsx)("div",{className:"w-[400px]",children:(0,o.jsx)(ep.Z,{type:"default",title:"Unable to find your table with ID ".concat(h),description:"This table doesn't exist in your database",children:w?(0,o.jsx)(I.$,{type:"default",className:"mt-2",onClick:()=>{g.handleTabClose({id:w,router:d,editor:"table",onClearDashboardHistory:C})},children:"Close tab"}):j.length>0?(0,o.jsx)(I.$,{asChild:!0,type:"default",className:"mt-2",onClick:()=>m.setDashboardHistory(f,"editor",void 0),children:(0,o.jsx)(s(),{href:"/project/".concat(f,"/editor/").concat(j[0].split("-")[1]),children:"Close tab"})}):(0,o.jsx)(I.$,{asChild:!0,type:"default",className:"mt-2",onClick:()=>m.setDashboardHistory(f,"editor",void 0),children:(0,o.jsx)(s(),{href:"/project/".concat(f,"/editor"),children:"Head back"})})})})});let E=(0,N.eg)(r)||(0,N.rW)(r),R=(0,N.KO)(r),T=eh.i.includes(null!=(t=null==r?void 0:r.schema)?t:""),A=!(!y&&!b)&&R&&!T,P="".concat(r.schema,"_").concat(r.name);return(0,o.jsx)("div",{className:"h-full",onClick:()=>g.makeActiveTabPermanent(),"data-sentry-component":"TableGridEditor","data-sentry-source-file":"TableGridEditor.tsx",children:(0,o.jsxs)(v.HQ,{projectRef:f,table:r,editable:A,"data-sentry-element":"TableEditorTableStateContextProvider","data-sentry-source-file":"TableGridEditor.tsx",children:[(0,o.jsx)(ec,{gridProps:{height:"100%"},customHeader:(E||R)&&"definition"===p?(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsxs)("p",{children:["SQL Definition of ",(0,o.jsx)("code",{className:"text-sm",children:r.name})," "]}),(0,o.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,"data-sentry-element":"SupabaseGrid","data-sentry-source-file":"TableGridEditor.tsx",children:(E||R)&&"definition"===p&&(0,o.jsx)(ek,{entity:r})},P),(0,o.jsx)(ey.A,{editable:A,selectedTable:(0,N.KO)(r)?r:void 0,onTableCreated:D,"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"TableGridEditor.tsx"}),(0,o.jsx)(ev.A,{selectedTable:(0,N.KO)(r)?r:void 0,onTableDeleted:k,"data-sentry-element":"DeleteConfirmationDialogs","data-sentry-source-file":"TableGridEditor.tsx"})]},"table-editor-table-".concat(r.id))})};var eR=n(1053),eT=n(97878),eA=n(34037),eI=n(57052);let eP=()=>{let{id:e,ref:t}=(0,a.g)(),n=e?Number(e):void 0,i=(0,ex.zv)(),{project:r}=(0,f.Om)(),{data:s,isLoading:c}=(0,C.Pk)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:n});return(0,l.useEffect)(()=>{if(s&&t){let e=(0,ex.lW)(s.entity_type,{id:s.id});i.tabsMap[e]?i.makeTabActive(e):i.addTab({id:e,type:s.entity_type,label:s.name,metadata:{schema:s.schema,name:s.name,tableId:n}})}},[s,n,t]),(0,o.jsx)(eE,{isLoadingSelectedTable:c,selectedTable:s,"data-sentry-element":"TableGridEditor","data-sentry-component":"TableEditorPage","data-sentry-source-file":"[id].tsx"})};eP.getLayout=e=>(0,o.jsx)(eR.A,{children:(0,o.jsx)(eT.$,{productMenu:(0,o.jsx)(eI.A,{}),product:"Table Editor",children:(0,o.jsx)(eA.A,{children:e})})});let e_=eP}},e=>{var t=t=>e(e.s=t);e.O(0,[89,4335,2180,2147,726,735,9353,7176,3730,2056,6110,9844,9025,1501,8316,5297,4387,4100,445,2981,4181,556,4560,7795,698,6538,4938,6692,5758,460,9849,7872,5874,49,2174,971,9063,9124,651,4452,1490,6389,6206,9567,6593,636,8792],()=>t(7887)),_N_E=e.O()}]);