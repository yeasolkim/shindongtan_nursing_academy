!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="918f4469-1ba4-4072-97a3-2488e2d2ec06",e._sentryDebugIdIdentifier="sentry-dbid-918f4469-1ba4-4072-97a3-2488e2d2ec06")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7651,8426],{3771:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/auth/policies",function(){return s(25521)}])},4487:(e,t,s)=>{"use strict";s.d(t,{A:()=>g});var a=s(80263),n=s(60045),l=s(27452),i=s(44679),r=s(66345),o=s(53239),c=s(97872),d=s(788),m=s(77227),u=s(71126),x=s(25171),h=s(70324),p=s(95793),f=s(36141),y=s(67585);let g=e=>{let{className:t,disabled:s=!1,size:g="tiny",showError:j=!0,selectedSchemaName:_,supportSelectAll:v=!1,excludedSchemas:b=[],onSelectSchema:N,onSelectCreateSchema:w,portal:S=!0}=e,[C,E]=(0,o.useState)(!1),A=(0,m.SE)(n.aG.TENANT_SQL_ADMIN_WRITE,"schemas"),{project:k}=(0,c.Om)(),{data:T,isLoading:L,isSuccess:q,isError:R,error:P,refetch:I}=(0,d.w$)({projectRef:null==k?void 0:k.ref,connectionString:null==k?void 0:k.connectionString}),M=(T||[]).filter(e=>!b.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,a.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[L&&(0,a.jsx)(u.$,{type:"default",className:"w-full [&>span]:w-full",size:g,disabled:!0,children:(0,a.jsx)(x.E,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),j&&R&&(0,a.jsxs)(h.Fc,{variant:"warning",className:"!px-3 !py-3",children:[(0,a.jsx)(h.XL,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,a.jsxs)(h.TN,{className:"text-xs mb-2 break-words",children:["Error: ",null==P?void 0:P.message]}),(0,a.jsx)(u.$,{type:"default",size:"tiny",onClick:()=>I(),children:"Reload schemas"})]}),q&&(0,a.jsxs)(p.AM,{open:C,onOpenChange:E,modal:!1,children:[(0,a.jsx)(p.Wv,{asChild:!0,children:(0,a.jsx)(u.$,{size:g,disabled:s,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,a.jsx)(l.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:_?(0,a.jsxs)("div",{className:"w-full flex gap-1",children:[(0,a.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,a.jsx)("p",{className:"text-foreground",children:"*"===_?"All schemas":_})]}):(0,a.jsx)("div",{className:"w-full flex gap-1",children:(0,a.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schemaâ€¦"})})})}),(0,a.jsx)(p.hl,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:"start",portal:S,sameWidthAsTrigger:!0,children:(0,a.jsxs)(f.uB,{children:[(0,a.jsx)(f.G7,{placeholder:"Find schema..."}),(0,a.jsxs)(f.oI,{children:[(0,a.jsx)(f.xL,{children:"No schemas found"}),(0,a.jsx)(f.L$,{children:(0,a.jsxs)(y.FK,{className:(M||[]).length>7?"h-[210px]":"",children:[v&&(0,a.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{N("*"),E(!1)},onClick:()=>{N("*"),E(!1)},children:[(0,a.jsx)("span",{children:"All schemas"}),"*"===_&&(0,a.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==M?void 0:M.map(e=>(0,a.jsxs)(f.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{N(e.name),E(!1)},onClick:()=>{N(e.name),E(!1)},children:[(0,a.jsx)("span",{children:e.name}),_===e.name&&(0,a.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==w&&A&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.fx,{}),(0,a.jsx)(f.L$,{children:(0,a.jsxs)(f.h_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{w(),E(!1)},onClick:()=>{w(),E(!1)},children:[(0,a.jsx)(r.A,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},8931:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var a=s(80263),n=s(51194),l=s(66915),i=s(59153),r=s.n(i),o=s(53239),c=s(51859);let d=e=>{let t,{title:s,description:i,children:d,footer:m,url:u="",linkHref:x="",imgUrl:h,imgAlt:p,icon:f,className:y,loading:g=!1,fixedHeight:j=!0,hideChevron:_=!1,titleClass:v="",containerElement:b,...N}=e,w=u||x||N.onClick,S={},C=b&&o.isValidElement(b)?e=>(0,o.cloneElement)(b,{...e}):void 0;N.onClick?(t=null!=C?C:"button",S=N):x?(t=null!=C?C:r(),S={href:x,...N}):u?(t=null!=C?C:"a",S={href:u,...N}):(t=null!=C?C:"div",S=N);let E=["group relative text-left","bg-surface-100","border border-surface","rounded-md p-5 flex flex-row","transition ease-in-out duration-150"];w&&(E=[...E,"cursor-pointer","hover:bg-surface-200","hover:border-control"]),j&&(E=[...E,"min-h-32 md:min-h-44"]);let A=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"mr-4 flex flex-col","data-sentry-component":"ImageContainer","data-sentry-source-file":"CardButton.tsx",children:t})},k=(0,a.jsxs)(a.Fragment,{children:[h&&(0,a.jsx)(A,{children:(0,a.jsx)("img",{className:" transition-all group-hover:scale-110 ",src:"".concat(h),alt:"".concat(p),width:"26"})}),f&&(0,a.jsx)(A,{children:f}),(0,a.jsxs)("div",{className:"flex h-full w-full flex-col space-y-2",children:["string"==typeof s?(0,a.jsx)("h5",{className:"text-foreground pr-5 ".concat(v),children:s}):s,(d||i)&&(0,a.jsxs)("div",{className:"flex w-full flex-1 flex-col",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:i}),(0,a.jsx)("div",{className:"w-full",children:d&&d})]}),m&&(0,a.jsx)("div",{className:"w-full !mt-auto",children:m})]}),w&&(0,a.jsx)("div",{className:" absolute right-4 top-4 text-foreground-lighter transition-all duration-200 group-hover:right-3 group-hover:text-foreground ",children:g?(0,a.jsx)(n.A,{className:"animate-spin"}):_?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(l.A,{})})]});return(0,a.jsx)(t,{...S,className:(0,c.cn)(E,y),"data-sentry-element":"Container","data-sentry-component":"CardButton","data-sentry-source-file":"CardButton.tsx",children:k})}},10585:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(80263),n=s(55866);let l=e=>{let{resourceText:t,isFullPage:s=!1}=e,l=()=>(0,a.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(n.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,a.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("div",{className:"w-[550px]",children:(0,a.jsx)(l,{})})}):(0,a.jsx)(l,{})}},12484:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(80263),n=s(59153),l=s.n(n),i=s(38220),r=s(65863),o=s(71126);let c=e=>{let{name:t="",isActive:s,isExternal:n,icon:c,rightIcon:d,url:m="",target:u="_self",onClick:x,textClassName:h="",hoverText:p="",label:f}=e,y=(0,a.jsx)(i.Ay.Item,{icon:c,rounded:!0,active:s,onClick:x,children:(0,a.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,a.jsxs)("div",{title:p||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+h,children:[(0,a.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==f&&(0,a.jsx)(r.E,{variant:"warning",className:"py-0 px-1.5 capitalize",children:f})]}),d&&(0,a.jsx)("div",{children:d})]})});return m?n?(0,a.jsx)(o.$,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,a.jsx)(l(),{href:m,target:"_blank",rel:"noreferrer",children:t})}):(0,a.jsx)(l(),{href:m,className:"block",target:u,children:y}):y}},12804:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(80263),n=s(16110),l=s(64036);let i=()=>(0,a.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center","data-sentry-component":"NoSearchResults","data-sentry-source-file":"NoSearchResults.tsx",children:[(0,a.jsx)(n.A,{src:"".concat(l.o2,"/img/no-search-results.svg"),preProcessor:e=>e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"'),"data-sentry-element":"SVG","data-sentry-source-file":"NoSearchResults.tsx"}),(0,a.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that match your query."})]})},21466:(e,t,s)=>{"use strict";s.d(t,{f:()=>d});var a=s(45874),n=s(32144),l=s(80251),i=s(73969),r=s(96557),o=s(65344);async function c(e){let{projectRef:t,connectionString:s,originalPolicy:n}=e,l=new Headers;s&&l.set("x-connection-encrypted",s);let{sql:i}=a.A.policies.remove(n),{result:o}=await (0,r.E)({projectRef:t,connectionString:s,sql:i,queryKey:["policy","delete",n.id]});return o}let d=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.jE)();return(0,l.n)(e=>c(e),{async onSuccess(t,s,n){let{projectRef:l}=s;await a.invalidateQueries(o.S.list(l)),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?i.oR.error("Failed to delete database policy: ".concat(e.message)):t(e,s,a)},...s})}},23420:(e,t,s)=>{"use strict";s.d(t,{V:()=>d});var a=s(45874),n=s(32144),l=s(80251),i=s(73969),r=s(96557),o=s(65344);async function c(e){let{projectRef:t,connectionString:s,originalPolicy:n,payload:l}=e,i=new Headers;s&&i.set("x-connection-encrypted",s);let{sql:o}=a.A.policies.update(n,l),{result:c}=await (0,r.E)({projectRef:t,connectionString:s,sql:o,queryKey:["policy","update",n.id]});return c}let d=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.jE)();return(0,l.n)(e=>c(e),{async onSuccess(t,s,n){let{projectRef:l}=s;await a.invalidateQueries(o.S.list(l)),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?i.oR.error("Failed to update database policy: ".concat(e.message)):t(e,s,a)},...s})}},24198:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(80263),n=s(51859),l=s(71126);let i=e=>{let{searchString:t,onResetFilter:s,className:i}=e;return(0,a.jsxs)("div",{className:(0,n.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",i),"data-sentry-component":"NoSearchResults","data-sentry-source-file":"NoSearchResults.tsx",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==s&&(0,a.jsx)(l.$,{type:"default",onClick:()=>s(),children:"Reset filter"})]})}},25400:(e,t,s)=>{"use strict";s.d(t,{$E:()=>d,kV:()=>o,op:()=>c});var a=s(56947),n=s(32144),l=s(40807),i=s(53239),r=s(69830);async function o(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:n}=await (0,l.Jt)("/platform/auth/{ref}/config",{params:{path:{ref:s}},signal:t});return n&&(0,l.H4)(n),a}let c=function(e){let{projectRef:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(r.Z.authConfig(t),e=>{let{signal:s}=e;return o({projectRef:t},s)},{enabled:s&&void 0!==t,...n})},d=e=>{let{projectRef:t}=e,s=(0,n.jE)();return(0,i.useCallback)(()=>{t&&s.prefetchQuery(r.Z.authConfig(t),e=>{let{signal:s}=e;return o({projectRef:t},s)})},[s,t])}},25521:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>q});var a=s(80263),n=s(60045),l=s(53667),i=s.n(l),r=s(95285),o=s(53239),c=s(90915),d=s(64377),m=s(95670),u=s(86182),x=s(87080),h=s(76579),p=s(1053),f=s(97872),y=s(48153),g=s(23992),j=s(10585),_=s(4487),v=s(96457),b=s(53935),N=s(788),w=s(61607),S=s(77227),C=s(69147),E=s(82008),A=s(22787),k=s(16988);let T=(e,t,s)=>{if(!s)return e.slice().sort((e,t)=>e.name.localeCompare(t.name));{let a=s.toLowerCase(),n=e=>e.toLowerCase().includes(a),l=t.filter(e=>n(e.name));return e.slice().filter(e=>e.name.toLowerCase().includes(a)||e.id.toString()===a||l.some(t=>t.table===e.name)).sort((e,t)=>e.name.localeCompare(t.name))}},L=()=>{let[e,t]=(0,C.W)(),{schema:s="public",search:l=""}=e,{project:h}=(0,f.Om)(),{setEditorPanel:p}=(0,A.qM)(),L=(0,c.h4)(),[q,R]=(0,o.useState)(),[P,I]=(0,o.useState)(!1),[M,D]=(0,o.useState)(),{data:z}=(0,N.w$)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),[F]=i()(z,e=>{var t;return(null==e?void 0:e.name)!=="realtime"&&E.i.includes(null!=(t=null==e?void 0:e.name)?t:"")}),V=null==z?void 0:z.find(e=>e.name===s),B=F.some(e=>e.id===(null==V?void 0:V.id)),{data:O}=(0,b.j)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),{data:Q,isLoading:H,isSuccess:W,isError:$,error:U}=(0,w.LW)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,schema:s}),G=T(null!=Q?Q:[],null!=O?O:[],l),K=(0,S.SE)(n.aG.TENANT_SQL_ADMIN_READ,"policies");return(0,S.Lh)()&&!K?(0,a.jsx)(j.A,{isFullPage:!0,resourceText:"view this project's RLS policies"}):(0,a.jsxs)("div",{className:"flex flex-col h-full","data-sentry-component":"AuthPoliciesPage","data-sentry-source-file":"policies.tsx",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"w-full flex flex-col lg:flex-row items-center justify-between gap-2",children:[(0,a.jsx)(_.A,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:s,onSelectSchema:s=>{t({...e,search:void 0,schema:s})},"data-sentry-element":"SchemaSelector","data-sentry-source-file":"policies.tsx"}),(0,a.jsxs)("div",{className:"w-full flex-grow flex items-center justify-between gap-2 lg:gap-4",children:[(0,a.jsx)(k.A,{size:"tiny",placeholder:"Filter tables and policies",className:"block w-full lg:w-52",value:l||"",onChange:s=>{let a=s.target.value;t({...e,search:""===a?void 0:a})},icon:(0,a.jsx)(r.A,{size:14}),"data-sentry-element":"Input","data-sentry-source-file":"policies.tsx"}),(0,a.jsx)(g.A,{href:"https://supabase.com/docs/learn/auth-deep-dive/auth-row-level-security","data-sentry-element":"DocsButton","data-sentry-source-file":"policies.tsx"})]})]})}),H&&(0,a.jsx)(v.y,{}),$&&(0,a.jsx)(y.A,{error:U,subject:"Failed to retrieve tables"}),W&&(0,a.jsx)(d.A,{schema:s,tables:G,hasTables:Q.length>0,isLocked:B,onSelectCreatePolicy:e=>{L?p({open:!0,initialValue:'create policy "replace_with_policy_name"\n  on '.concat(s,".").concat(e,"\n  for select\n  to authenticated\n  using (\n    true  -- Write your policy condition here\n);"),label:'Create new RLS policy on "'.concat(e,'"'),saveLabel:"Create policy",initialPrompt:'Create and name a entirely new RLS policy for the "'.concat(e,'" table in the ').concat(s," schema. The policy should...")}):(R(e),I(!0))},onSelectEditPolicy:e=>{if(L){let t=(0,x.F)(e),s=(0,m.S3)(e.schema,e.table);p({open:!0,initialValue:t,label:'Edit policy "'.concat(e.name,'"'),saveLabel:"Update policy",templates:s.map(e=>({name:e.templateName,description:e.description,content:e.statement})),initialPrompt:'Update the policy with name "'.concat(e.name,'" in the ').concat(e.schema," schema on the ").concat(e.table," table. It should...")})}else D(e),I(!0)}}),(0,a.jsx)(u.s,{visible:P,schema:s,searchString:l,selectedTable:q,selectedPolicy:M,onSelectCancel:()=>{R(void 0),I(!1),D(void 0)},authContext:"database","data-sentry-element":"PolicyEditorPanel","data-sentry-source-file":"policies.tsx"})]})};L.getLayout=e=>(0,a.jsx)(p.A,{children:(0,a.jsx)(h.A,{children:(0,a.jsx)("div",{className:"h-full p-4",children:e})})});let q=L},35634:e=>{e.exports={"spin-ai-icon-container":"ai-icon-animation-style_spin-ai-icon-container__7sgAA",spinAiIconContainer:"ai-icon-animation-style_spinAiIconContainer__rBP6P","ai-icon__container":"ai-icon-animation-style_ai-icon__container__2aXBS","ai-icon__grid":"ai-icon-animation-style_ai-icon__grid__Qrwxf","ai-icon__grid__square":"ai-icon-animation-style_ai-icon__grid__square__YU8EZ","ai-icon__grid__square--static":"ai-icon-animation-style_ai-icon__grid__square--static__1tOM_","ai-icon__container--allow-hover-effect":"ai-icon-animation-style_ai-icon__container--allow-hover-effect__HrB86","ai-icon__grid__square--step-1":"ai-icon-animation-style_ai-icon__grid__square--step-1__KATlI",step1_square1:"ai-icon-animation-style_step1_square1__BIjL3",step1_square2:"ai-icon-animation-style_step1_square2__QzsE7",step1_square3:"ai-icon-animation-style_step1_square3__ls1SO",step1_square4:"ai-icon-animation-style_step1_square4__Kk8zi","ai-icon__grid__square--step-2":"ai-icon-animation-style_ai-icon__grid__square--step-2__9OoIG",step2_square1:"ai-icon-animation-style_step2_square1__o_hcu",step2_square2:"ai-icon-animation-style_step2_square2__HBZt7",step2_square3:"ai-icon-animation-style_step2_square3__K6E2K",step2_square4:"ai-icon-animation-style_step2_square4__oDGDL","ai-icon__grid__square--step-3":"ai-icon-animation-style_ai-icon__grid__square--step-3__RldL4",step3_square1:"ai-icon-animation-style_step3_square1__Oo6vT",step3_square2:"ai-icon-animation-style_step3_square2__36Os9",step3_square3:"ai-icon-animation-style_step3_square3__Nj5rc",step3_square4:"ai-icon-animation-style_step3_square4__OFVFh","ai-icon__grid__square--step-4":"ai-icon-animation-style_ai-icon__grid__square--step-4__7o69c",step4_square1:"ai-icon-animation-style_step4_square1__G_8pn",step4_square2:"ai-icon-animation-style_step4_square2__KHYf3",step4_square3:"ai-icon-animation-style_step4_square3__XON12",step4_square4:"ai-icon-animation-style_step4_square4__Aq8dV","ai-icon__grid__square--step-5":"ai-icon-animation-style_ai-icon__grid__square--step-5__cF2Rx",step5_square1:"ai-icon-animation-style_step5_square1__me9Ru",step5_square2:"ai-icon-animation-style_step5_square2__0Ydfw",step5_square3:"ai-icon-animation-style_step5_square3__bOHqW",step5_square4:"ai-icon-animation-style_step5_square4__m2l32","ai-icon__grid__square--exiting--step-1":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-1__JYREY",exit_step1_square1:"ai-icon-animation-style_exit_step1_square1__C_GBC",exit_step1_square2:"ai-icon-animation-style_exit_step1_square2__TID0l",exit_step1_square3:"ai-icon-animation-style_exit_step1_square3__ADmUT",exit_step1_square4:"ai-icon-animation-style_exit_step1_square4__kilu_","ai-icon__grid__square--exiting--step-2":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-2__kDUVt",exit_step2_square1:"ai-icon-animation-style_exit_step2_square1__vmYa5",exit_step2_square2:"ai-icon-animation-style_exit_step2_square2__zxv0q",exit_step2_square3:"ai-icon-animation-style_exit_step2_square3__Dhey5",exit_step2_square4:"ai-icon-animation-style_exit_step2_square4__P1UKx","ai-icon__grid__square--exiting--step-3":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-3__h48Ts",exit_step3_square1:"ai-icon-animation-style_exit_step3_square1__l1FKu",exit_step3_square2:"ai-icon-animation-style_exit_step3_square2__4RPQL",exit_step3_square3:"ai-icon-animation-style_exit_step3_square3__s2vMz",exit_step3_square4:"ai-icon-animation-style_exit_step3_square4__Zros9","ai-icon__grid__square--exiting--step-4":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-4__VEmk_",exit_step4_square1:"ai-icon-animation-style_exit_step4_square1__bG99O",exit_step4_square2:"ai-icon-animation-style_exit_step4_square2__1Fxvf",exit_step4_square3:"ai-icon-animation-style_exit_step4_square3__EWeB7",exit_step4_square4:"ai-icon-animation-style_exit_step4_square4__HC5ov","ai-icon__grid__square--exiting--step-5":"ai-icon-animation-style_ai-icon__grid__square--exiting--step-5___9jFB",exit_step5_square1:"ai-icon-animation-style_exit_step5_square1__w4ctB",exit_step5_square2:"ai-icon-animation-style_exit_step5_square2__UZdas",exit_step5_square3:"ai-icon-animation-style_exit_step5_square3__O_mvc",exit_step5_square4:"ai-icon-animation-style_exit_step5_square4__SKL7Z"}},38220:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>u});var a=s(80263),n=s(53239),l=s(16865),i=s(51859);function r(e){let{children:t,className:s,tag:n="div",style:l}=e;return(0,a.jsx)("".concat(n),{style:l,"data-sentry-element":"CustomTag","data-sentry-component":"Typography","data-sentry-source-file":"Typography.tsx",children:t})}r.Title=function(e){let{className:t,level:s=1,children:n,style:l}=e;return(0,a.jsx)("h".concat(s),{style:l,"data-sentry-element":"CustomTag","data-sentry-component":"Title","data-sentry-source-file":"Title.tsx",children:n})},r.Text=function(e){let{className:t,children:s,style:n,type:l,disabled:i,mark:r,code:o,keyboard:c,underline:d,strikethrough:m,strong:u,small:x}=e;return o?(0,a.jsx)("code",{style:n,children:s}):r?(0,a.jsx)("mark",{style:n,children:s}):c?(0,a.jsx)("kbd",{style:n,children:s}):u?(0,a.jsx)("strong",{style:n,children:s}):(0,a.jsx)("span",{style:n,"data-sentry-component":"Text","data-sentry-source-file":"Text.tsx",children:s})},r.Link=function(e){let{children:t,target:s="_blank",href:n,className:l,onClick:i,style:r}=e;return(0,a.jsx)("a",{onClick:i,href:n,target:s,rel:"noopener noreferrer",style:r,"data-sentry-component":"Link","data-sentry-source-file":"Link.tsx",children:t})};let o=(0,n.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,a.jsx)(o.Provider,{value:{type:t},"data-sentry-element":"unknown","data-sentry-component":"MenuContextProvider","data-sentry-source-file":"MenuContext.tsx",children:e.children})},d=()=>{let e=(0,n.useContext)(o);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function m(e){let{children:t,className:s,ulClassName:n,style:l,type:i="text"}=e;return(0,a.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:s,style:l,"data-sentry-component":"Menu","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)(c,{type:i,"data-sentry-element":"MenuContextProvider","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)("ul",{className:n,children:t})})})}m.Item=function(e){let{children:t,icon:s,active:n,rounded:r,onClick:o,doNotCloseOverlay:c=!1,showActiveBar:m=!1,style:u}=e,x=(0,l.A)("menu"),{type:h}=d(),p=[x.item.base];p.push(x.item.variants[h].base),n?p.push(x.item.variants[h].active):p.push(x.item.variants[h].normal);let f=[x.item.content.base];n?f.push(x.item.content.active):f.push(x.item.content.normal);let y=[x.item.icon.base];return n?y.push(x.item.icon.active):y.push(x.item.icon.normal),(0,a.jsxs)("li",{role:"menuitem",className:(0,i.cn)("outline-none",p),style:u,onClick:o,"aria-current":n?"page":void 0,"data-sentry-component":"Item","data-sentry-source-file":"Menu.tsx",children:[s&&(0,a.jsx)("div",{className:"".concat(y.join(" ")," min-w-fit"),children:s}),(0,a.jsx)("span",{className:f.join(" "),children:t})]})},m.Group=function(e){let{children:t,icon:s,title:n}=e,i=(0,l.A)("menu"),{type:r}=d();return(0,a.jsxs)("div",{className:[i.group.base,i.group.variants[r]].join(" "),"data-sentry-component":"Group","data-sentry-source-file":"Menu.tsx",children:[s&&(0,a.jsx)("span",{className:i.group.icon,children:s}),(0,a.jsx)("span",{className:i.group.content,children:n}),t]})},m.Misc=function(e){let{children:t}=e;return(0,a.jsx)("div",{"data-sentry-component":"Misc","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)(r.Text,{"data-sentry-element":"unknown","data-sentry-source-file":"Menu.tsx",children:(0,a.jsx)("span",{children:t})})})};let u=m},39071:(e,t,s)=>{"use strict";s.d(t,{l:()=>r});var a=s(80263),n=s(38220),l=s(65863),i=s(12484);let r=e=>{let{page:t,menu:s}=e;return(0,a.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto","data-sentry-component":"ProductMenu","data-sentry-source-file":"ProductMenu.tsx",children:(0,a.jsx)(n.Ay,{type:"pills","data-sentry-element":"Menu","data-sentry-source-file":"ProductMenu.tsx",children:s.map((e,r)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"my-6 space-y-8",children:(0,a.jsxs)("div",{className:"mx-3",children:[(0,a.jsx)(n.Ay.Group,{title:e.title?(0,a.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,a.jsx)("span",{children:e.title}),e.isPreview&&(0,a.jsx)(l.E,{variant:"warning",children:"Not production ready"})]}):null}),(0,a.jsx)("div",{children:e.items.map(e=>{let s=e.pages?e.pages.includes(null!=t?t:""):t===e.key;return(0,a.jsx)(i.A,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:s,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key)})})]})}),r!==s.length-1&&(0,a.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},41623:(e,t,s)=>{"use strict";s.d(t,{a:()=>l,h:()=>i});var a=s(80263),n=s(62763);let l=e=>{let{name:t}=e;return(0,a.jsx)("div",{className:"text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark flex cursor-not-allowed items-center space-x-2 rounded bg-gray-600 py-0.5 px-2 text-sm","data-sentry-component":"BadgeDisabled","data-sentry-source-file":"Badges.tsx",children:(0,a.jsx)("span",{className:"opacity-50",children:t})})},i=e=>{let{name:t,handleRemove:s}=e;return(0,a.jsxs)("div",{className:"text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark flex items-center space-x-2 rounded bg-surface-300 py-0.5 px-2 text-sm",onClick:e=>e.preventDefault(),"data-sentry-component":"BadgeSelected","data-sentry-source-file":"Badges.tsx",children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)(n.A,{size:12,className:"cursor-pointer opacity-50 transition hover:opacity-100",onClick:e=>{e.preventDefault(),e.stopPropagation(),s()},"data-sentry-element":"X","data-sentry-source-file":"Badges.tsx"})]})}},46610:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(80263),n=s(77877),l=s(41370),i=s(59153),r=s.n(i),o=s(71126);let c=e=>{let{title:t="",size:s="medium",children:i,ctaButtonLabel:c="",infoButtonLabel:d="",infoButtonUrl:m="",onClickCta:u=()=>{},loading:x=!1,disabled:h=!1,disabledMessage:p="",ctaUrl:f}=e,y=c&&u||m&&d;return(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center","data-sentry-component":"ProductEmptyState","data-sentry-source-file":"ProductEmptyState.tsx",children:(0,a.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsxs)("div",{className:"".concat("medium"===s?"w-80":"w-[400px]"," space-y-4"),children:[(0,a.jsx)("h5",{className:"text-foreground",children:t}),(0,a.jsx)("div",{className:"flex flex-col space-y-2 text-foreground-light",children:i}),y&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[c&&f?(0,a.jsx)(o.$,{asChild:!0,type:"primary",children:(0,a.jsx)(r(),{href:f,children:c})}):c&&u?(0,a.jsx)(l.G,{type:"primary",onClick:u,loading:x,disabled:x||h,tooltip:{content:{side:"bottom",text:h&&p.length>0?p:void 0}},children:c}):null,m&&d?(0,a.jsx)(o.$,{type:"default",icon:(0,a.jsx)(n.A,{strokeWidth:1.5}),children:(0,a.jsx)("a",{target:"_blank",rel:"noreferrer",href:m,children:d})}):null]})]})})})})}},53935:(e,t,s)=>{"use strict";s.d(t,{j:()=>c});var a=s(56947),n=s(40807),l=s(68875),i=s(64036),r=s(65344);async function o(e,t,s){let{projectRef:a,connectionString:l,schema:i}=e;if(!a)throw Error("projectRef is required");let r=new Headers(s);l&&r.set("x-connection-encrypted",l);let{data:o,error:c}=await (0,n.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":l},path:{ref:a},query:{included_schemas:i||"",excluded_schemas:""}},headers:r,signal:t});return c&&(0,n.H4)(c),o}let c=function(e){let{projectRef:t,connectionString:s,schema:n}=e,{enabled:c=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},m=(0,l.KT)(),u=(null==m?void 0:m.status)===i.BU.ACTIVE_HEALTHY;return(0,a.I)(r.S.list(t,n),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:s,schema:n},a)},{enabled:c&&void 0!==t&&u,...d})}},63615:(e,t,s)=>{"use strict";s.d(t,{a:()=>m,e:()=>u});var a=s(45874),n=s(32144),l=s(80251),i=s(73969),r=s(96557),o=s(6691),c=s(73370),d=s(98207);async function m(e){let{projectRef:t,connectionString:s,id:n,name:l,schema:i,payload:o}=e,{sql:c}=a.A.tables.update({id:n,name:l,schema:i},o),{result:d}=await (0,r.E)({projectRef:t,connectionString:s,sql:c,queryKey:["table","update",n]});return d}let u=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.jE)();return(0,l.n)(e=>m(e),{async onSuccess(t,s,n){let{projectRef:l,schema:i,id:r}=s;await Promise.all([a.invalidateQueries(c.i.tableEditor(l,r)),a.invalidateQueries(d.v.list(l,i)),a.invalidateQueries(o.O.lint(l))]),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?i.oR.error("Failed to update database table: ".concat(e.message)):t(e,s,a)},...s})}},63910:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(80263),n=s(53239),l=s(67920),i=s(66586),r=s(71126);let o=e=>{let{visible:t=!1,danger:s=!1,title:o="",description:c="",size:d="small",buttonLabel:m="",buttonLoadingLabel:u="",onSelectCancel:x=()=>{},onSelectConfirm:h=()=>{}}=e;(0,n.useEffect)(()=>{t&&f(!1)},[t]);let[p,f]=(0,n.useState)(!1),y=()=>{f(!0),h()};return(0,a.jsx)(l.A,{header:o,visible:t,title:o,description:c,size:d,hideFooter:!0,onCancel:x,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,a.jsx)(i.A,{initialValues:{},validateOnBlur:!0,onSubmit:()=>y(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.A.Content,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.$,{block:!0,htmlType:"button",type:"default",onClick:x,disabled:p,children:"Cancel"}),(0,a.jsx)(r.$,{htmlType:"submit",block:!0,type:s?"danger":"primary",disabled:p,loading:p,children:u&&p?u:m||"Confirm"})]})})})})})}},64377:(e,t,s)=>{"use strict";s.d(t,{A:()=>et});var a=s(80263),n=s(97344),l=s.n(n),i=s(87959),r=s(47504),o=s(53239),c=s(73969),d=s(19898),m=s(83927),u=s.n(m),x=s(3073),h=s(97872),p=s(48153),f=s(21889),y=s(98453),g=s(53935),j=s(56947),_=s(96557),v=s(98207);let b=e=>{let{schema:t,table:s}=e;return"\nSELECT grantee, privilege_type\nFROM information_schema.role_table_grants\nWHERE table_schema = '".concat(t,"'\n  AND table_name = '").concat(s,"'\n  AND grantee IN ('anon', 'authenticated');\n").trim()};async function N(e,t){let{schema:s,table:a,projectRef:n,connectionString:l}=e;if(!s)throw Error("schema is required");let i=b({schema:s,table:a}),{result:r}=await (0,_.E)({projectRef:n,connectionString:l,sql:i,queryKey:["TableRolesAccess",s]},t),o=[];return r.some(e=>"anon"===e.grantee)&&o.push("anon"),r.some(e=>"authenticated"===e.grantee)&&o.push("authenticated"),o}let w=function(e){let{projectRef:t,connectionString:s,schema:a,table:n}=e,{enabled:l=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,j.I)(v.v.rolesAccess(t,a,n),e=>{let{signal:l}=e;return N({projectRef:t,connectionString:s,schema:a,table:n},l)},{enabled:l&&void 0!==t&&void 0!==a,...i})};var S=s(51859),C=s(16632),E=s(49655),A=s(60045),k=s(1051),T=s(15576),L=s(28097),q=s(93511),R=s(25400),P=s(77227),I=s(89634),M=s(71126),D=s(65863),z=s(74115),F=s(87080);let V=e=>{let{policy:t,isLocked:s,onSelectEditPolicy:n=u(),onSelectDeletePolicy:l=u()}=e,i=(0,I.xd)(),r=(0,P.SE)(A.aG.TENANT_SQL_ADMIN_WRITE,"policies"),{project:o}=(0,h.Om)(),{data:c}=(0,R.op)({projectRef:null==o?void 0:o.ref}),d=("realtime"!==t.schema||"messages"!==t.table)&&s,m=(null==c?void 0:c.EXTERNAL_ANONYMOUS_USERS_ENABLED)&&(t.roles.includes("authenticated")||t.roles.includes("public"));return(0,a.jsxs)(f.A.Content,{className:(0,S.cn)("flex border-overlay","w-full last:border-0 space-x-4 border-b py-4 lg:items-center"),"data-sentry-element":"unknown","data-sentry-component":"PolicyRow","data-sentry-source-file":"PolicyRow.tsx",children:[(0,a.jsx)("div",{className:"flex grow flex-col gap-y-1",children:(0,a.jsxs)("div",{className:"flex items-start gap-x-4",children:[(0,a.jsx)("p",{className:"font-mono text-xs text-foreground-light translate-y-[2px] min-w-12",children:t.command}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)(M.$,{type:"text",className:"h-auto text-foreground text-sm border-none p-0 hover:bg-transparent justify-start",onClick:()=>n(t),"data-sentry-element":"Button","data-sentry-source-file":"PolicyRow.tsx",children:t.name}),(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsxs)("div",{className:"text-foreground-lighter text-sm",children:["Applied to:"," ",t.roles.slice(0,3).map((e,s)=>(0,a.jsxs)("span",{children:[(0,a.jsx)("code",{className:"text-foreground-light text-xs",children:e}),s<Math.min(t.roles.length,3)-1?", ":" "]},"policy-".concat(e,"-").concat(s))),t.roles.length>1?"roles":"role"]}),t.roles.length>3&&(0,a.jsxs)(C.m_,{children:[(0,a.jsx)(C.k$,{asChild:!0,children:(0,a.jsxs)("code",{className:"text-foreground-light text-xs",children:["+ ",t.roles.length-3," more roles"]},"policy-etc")}),(0,a.jsx)(C.ZI,{side:"bottom",align:"center",children:t.roles.slice(3).join(", ")})]})]})]}),m?(0,a.jsx)(D.E,{color:"yellow",children:"Applies to anonymous users"}):null]})}),(0,a.jsx)("div",{children:!d&&(0,a.jsxs)(z.rI,{children:[(0,a.jsx)(z.ty,{asChild:!0,children:(0,a.jsx)(M.$,{type:"default",className:"px-1.5",icon:(0,a.jsx)(k.A,{})})}),(0,a.jsxs)(z.SQ,{side:"bottom",align:"end",className:"w-52",children:[(0,a.jsxs)(z._2,{className:"gap-x-2",onClick:()=>n(t),children:[(0,a.jsx)(T.A,{size:14}),(0,a.jsx)("p",{children:"Edit policy"})]}),(0,a.jsxs)(z._2,{className:"space-x-2",onClick:()=>{let e=(0,F.F)(t);i.newChat({name:"Update policy ".concat(t.name),open:!0,sqlSnippets:[e],initialInput:'Update the policy with name "'.concat(t.name,'" in the ').concat(t.schema," schema on the ").concat(t.table," table. It should..."),suggestions:{title:'I can help you make a change to the policy "'.concat(t.name,'" in the ').concat(t.schema," schema on the ").concat(t.table," table, here are a few example prompts to get you started:"),prompts:["Tell me how I can improve this policy...","Duplicate this policy for another table...","Add extra conditions to this policy..."]}})},children:[(0,a.jsx)(T.A,{size:14}),(0,a.jsx)("p",{children:"Edit policy with Assistant"})]}),(0,a.jsx)(z.mB,{}),(0,a.jsxs)(q.x,{className:"gap-x-2",disabled:!r,onClick:()=>l(t),tooltip:{content:{side:"left",text:"You need additional permissions to delete policies"}},children:[(0,a.jsx)(L.A,{size:14}),(0,a.jsx)("p",{children:"Delete policy"})]})]})]})})]})};var B=s(26470),O=s(78777),Q=s(41370),H=s(44914),W=s(83026);let $=e=>{let{table:t,isLocked:s,onSelectToggleRLS:n=u(),onSelectCreatePolicy:l}=e,{ref:i}=(0,d.g)(),r=(0,I.xd)(),o=(0,P.SE)(A.aG.TENANT_SQL_ADMIN_WRITE,"policies"),c=(0,P.SE)(A.aG.TENANT_SQL_ADMIN_WRITE,"tables"),m="realtime"===t.schema,x=m&&"messages"===t.name,h=m?!x:s;return(0,a.jsxs)("div",{id:t.id.toString(),className:"flex w-full items-center justify-between","data-sentry-component":"PolicyTableRowHeader","data-sentry-source-file":"PolicyTableRowHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex gap-x-4 text-left",children:[(0,a.jsxs)(H.tv,{projectRef:i,id:String(t.id),className:"flex items-center gap-x-2","data-sentry-element":"EditorTablePageLink","data-sentry-source-file":"PolicyTableRowHeader.tsx",children:[t.rls_enabled?(0,a.jsx)("div",{className:"flex items-center gap-x-1 text-xs",children:(0,a.jsx)(B.A,{size:14,strokeWidth:2,className:"text-brand"})}):(0,a.jsx)("div",{className:"flex items-center gap-x-1 text-xs",children:(0,a.jsx)(O.A,{size:14,strokeWidth:2,className:"text-warning-600"})}),(0,a.jsx)("h4",{className:"m-0",children:t.name})]}),(0,a.jsx)("div",{className:"flex items-center gap-x-2",children:h&&(0,a.jsx)(D.E,{children:(0,a.jsxs)("span",{className:"flex gap-2 items-center text-xs uppercase text-foreground-lighter",children:[(0,a.jsx)(B.A,{size:12})," Locked"]})})})]}),!h&&(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex flex-row justify-end gap-x-2",children:[!x&&(0,a.jsx)(Q.G,{type:"default",disabled:!c,onClick:()=>n(t),tooltip:{content:{side:"bottom",text:c?void 0:"You need additional permissions to toggle RLS"}},children:t.rls_enabled?"Disable RLS":"Enable RLS"}),(0,a.jsx)(Q.G,{type:"default",disabled:!c||!o,onClick:()=>l(),tooltip:{content:{side:"bottom",text:c||c&&o?void 0:"You need additional permissions to create RLS policies"}},children:"Create policy"}),(0,a.jsx)(Q.G,{type:"default",className:"px-1",onClick:()=>{r.newChat({name:"Create new policy",open:!0,initialInput:"Create and name a new policy for the ".concat(t.schema," schema on the ").concat(t.name," table that ...")})},tooltip:{content:{side:"bottom",text:c&&o?"Create with Supabase Assistant":"You need additional permissions to create RLS policies"}},children:(0,a.jsx)(W.M,{size:16})})]})})]})},U=e=>{let{table:t,isLocked:s,onSelectToggleRLS:n=u(),onSelectCreatePolicy:l,onSelectEditPolicy:i=u(),onSelectDeletePolicy:r=u()}=e,{project:o}=(0,h.Om)(),{data:c}=(0,y.y)({projectRef:null==o?void 0:o.ref}),d=(null==c?void 0:c.db_schema)?null==c?void 0:c.db_schema.replace(/ /g,"").split(","):[],m=t.rls_enabled,j=d.includes(t.schema),{data:_=[]}=w({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,schema:t.schema,table:t.name}),v=0!==_.length,b=!m&&j&&v,{data:N,error:A,isLoading:k,isError:T,isSuccess:L}=(0,g.j)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),q=(null!=N?N:[]).filter(e=>e.schema===t.schema&&e.table===t.name).sort((e,t)=>e.name.localeCompare(t.name)),R=m&&0===q.length;return(0,a.jsxs)(f.A,{className:"!m-0",title:(0,a.jsx)($,{table:t,isLocked:s,onSelectToggleRLS:n,onSelectCreatePolicy:l}),"data-sentry-element":"Panel","data-sentry-component":"PolicyTableRow","data-sentry-source-file":"index.tsx",children:[(b||R)&&(0,a.jsxs)("div",{className:(0,S.cn)("dark:bg-alternative-200 bg-surface-200 px-6 py-2 text-xs flex items-center gap-2",0===q.length?"":"border-b"),children:[(0,a.jsx)("div",{className:(0,S.cn)("w-1.5 h-1.5 rounded-full bg-warning-600 ",R&&"bg-selection")}),(0,a.jsxs)("span",{className:(0,S.cn)("font-bold text-warning-600",R&&"text-foreground"),children:[b?"Warning":"Note",":"]})," ",(0,a.jsx)("span",{className:"text-foreground-light",children:b?"Row Level Security is disabled. Your table is publicly readable and writable.":"Row Level Security is enabled, but no policies exist. No data will be selectable via Supabase APIs."}),b&&(0,a.jsxs)(C.m_,{children:[(0,a.jsx)(C.k$,{asChild:!0,children:(0,a.jsx)(x.A,{className:"w-3 h-3"})}),(0,a.jsx)(C.ZI,{className:"w-[400px]",children:"Anyone with the project's anonymous key can modify or delete your data. Enable RLS and create access policies to keep your data secure."})]})]}),k&&(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsx)(E.A,{})}),T&&(0,a.jsx)(p.A,{className:"border-0 rounded-none",error:A,subject:"Failed to retrieve policies"}),L&&(0,a.jsxs)(a.Fragment,{children:[0===q.length&&(0,a.jsx)("div",{className:"px-6 py-4 flex flex-col gap-y-3",children:(0,a.jsx)("p",{className:"text-foreground-lighter text-sm",children:"No policies created yet"})}),null==q?void 0:q.map(e=>(0,a.jsx)(V,{isLocked:s,policy:e,onSelectEditPolicy:i,onSelectDeletePolicy:r},e.id))]})]})};var G=s(43970),K=s(12804),Y=s(46610),X=s(72256),J=s(21466),Z=s(63615),ee=s(63910);let et=e=>{let{schema:t,tables:s,hasTables:n,isLocked:m,onSelectCreatePolicy:u,onSelectEditPolicy:x}=e,p=(0,r.useRouter)(),{ref:f}=(0,d.g)(),{project:y}=(0,h.Om)(),[g,j]=(0,o.useState)(),[_,v]=(0,o.useState)({}),{mutate:b}=(0,Z.e)({onError:e=>{c.oR.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{w()}}),{mutate:N}=(0,J.f)({onSuccess:()=>{c.oR.success("Successfully deleted policy!")},onSettled:()=>{w()}}),w=()=>{v({}),j(void 0)},S=e=>{j(e)},C=e=>{x(e)},E=e=>{v(e)},A=async()=>{if(!g)return console.error("Table is required");let e={id:g.id,rls_enabled:!g.rls_enabled};b({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,id:g.id,name:g.name,schema:g.schema,payload:e})},k=async()=>{if(!y)return console.error("Project is required");N({projectRef:y.ref,connectionString:y.connectionString,originalPolicy:_})};return 0===s.length?(0,a.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,a.jsx)(Y.A,{size:"large",title:"Row-Level Security (RLS) Policies",ctaButtonLabel:"Create a table",infoButtonLabel:"What is RLS?",infoButtonUrl:"https://supabase.com/docs/guides/auth/row-level-security",onClickCta:()=>p.push("/project/".concat(f,"/editor")),children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(X.A,{title:"What are policies?",icon:(0,a.jsx)(i.A,{size:14,strokeWidth:2}),description:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Policies restrict, on a per-user basis, which rows can be returned by normal queries, or inserted, updated, or deleted by data modification commands."}),(0,a.jsx)("p",{className:"text-sm",children:"This is also known as Row-Level Security (RLS). Each policy is attached to a table, and the policy is executed each time its accessed."})]})}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Create a table in this schema first before creating a policy."})]})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-4 pb-4",children:[m&&(0,a.jsx)(G.A,{schema:t,entity:"policies"}),s.length>0?s.map(e=>(0,a.jsx)("section",{children:(0,a.jsx)(U,{table:e,isLocked:"realtime"===t||m,onSelectToggleRLS:S,onSelectCreatePolicy:()=>u(e.name),onSelectEditPolicy:C,onSelectDeletePolicy:E})},e.id)):n?(0,a.jsx)(K.A,{}):null]}),(0,a.jsx)(ee.A,{danger:!0,visible:!l()(_),title:"Confirm to delete policy",description:'This is permanent! Are you sure you want to delete the policy "'.concat(_.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:w,onSelectConfirm:k,"data-sentry-element":"ConfirmModal","data-sentry-source-file":"Policies.tsx"}),(0,a.jsx)(ee.A,{danger:null==g?void 0:g.rls_enabled,visible:void 0!==g,title:"Confirm to ".concat((null==g?void 0:g.rls_enabled)?"disable":"enable"," Row Level Security"),description:"Are you sure you want to ".concat((null==g?void 0:g.rls_enabled)?"disable":"enable",' Row Level Security for the table "').concat(null==g?void 0:g.name,'"?'),buttonLabel:"Confirm",buttonLoadingLabel:"Saving",onSelectCancel:w,onSelectConfirm:A,"data-sentry-element":"ConfirmModal","data-sentry-source-file":"Policies.tsx"})]})}},76579:(e,t,s)=>{"use strict";s.d(t,{A:()=>y});var a=s(80263),n=s(59153),l=s.n(n),i=s(47504),r=s(19898),o=s(90915),c=s(39071),d=s(25400),m=s(80207),u=s(70324),x=s(71126),h=s(30651),p=s(93035);let f=()=>{let e=(0,i.useRouter)(),{ref:t="default"}=(0,r.g)(),s=(0,o.p4)();(0,d.$E)({projectRef:t});let n=e.pathname.split("/")[4];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.l,{page:n,menu:(0,p.B)(t),"data-sentry-element":"ProductMenu","data-sentry-source-file":"AuthLayout.tsx"}),s&&(0,a.jsx)("div",{className:"px-3",children:(0,a.jsxs)(u.Fc,{children:[(0,a.jsx)(u.XL,{className:"text-sm",children:"Column Privileges has been shifted"}),(0,a.jsxs)(u.TN,{className:"text-xs",children:[(0,a.jsx)("p",{className:"mb-2",children:"It can now be found in the menu under the database section."}),(0,a.jsx)(x.$,{asChild:!0,type:"default",size:"tiny",children:(0,a.jsx)(l(),{href:"/project/".concat(t,"/database/column-privileges"),children:"Head over to Database"})})]})]})})]})},y=(0,m.r)(e=>{let{children:t}=e;return(0,a.jsx)(h.A,{title:"Authentication",product:"Authentication",productMenu:(0,a.jsx)(f,{}),isBlocking:!1,"data-sentry-element":"ProjectLayout","data-sentry-component":"AuthLayout","data-sentry-source-file":"AuthLayout.tsx",children:t})})},82770:(e,t,s)=>{"use strict";s.d(t,{_:()=>f});var a=s(80263),n=s(30788),l=s.n(n),i=s(37253),r=s.n(i),o=s(62659),c=s(44679),d=s(53239),m=s(95793),u=s(51859),x=s(36141),h=s(67585),p=s(41623);let f=e=>{let{options:t,value:s,placeholder:n,searchPlaceholder:i="Search for option",disabled:f=!1,onChange:y=()=>{}}=e,[g,j]=(0,d.useState)(!1),[_,v]=(0,d.useState)(s||[]),b=s||_,N=l()(t,["disabled"],["desc"]),w=e=>void 0!==(b||[]).find(t=>t===e.value),S=e=>{let s=w(e)?[...r()(b,e.value)]:[...b.concat([e.value])],a=t.filter(e=>e.disabled).map(e=>e.name),n=[...new Set(s.concat(a))];v(n),y(n)};return(0,a.jsx)("div",{className:f?"pointer-events-none opacity-50":"","data-sentry-component":"MultiSelectV2","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsxs)(m.AM,{open:g,onOpenChange:j,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:[(0,a.jsx)(m.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsxs)("div",{className:(0,u.cn)("relative border border-strong bg-control rounded","flex w-full flex-wrap items-start gap-1.5 p-1.5 cursor-pointer","".concat(0===b.length?"h-9":"")),onClick:()=>j(!0),children:[0===b.length&&n&&(0,a.jsx)("div",{className:"px-2 text-sm text-foreground-light h-full flex items-center",children:n}),b.map((e,t)=>{var s;let n="".concat(e,"-").concat(t),l=N.find(t=>t.value===e),i=null!=(s=null==l?void 0:l.disabled)&&s;return l?i?(0,a.jsx)(p.a,{name:l.name},n):(0,a.jsx)(p.h,{name:l.name,handleRemove:()=>S(l)},n):(0,a.jsx)(a.Fragment,{})}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 pl-3 pr-2 flex space-x-1 items-center cursor-pointer ",children:(0,a.jsx)(o.A,{size:16,strokeWidth:2,className:"text-foreground-lighter","data-sentry-element":"ChevronDown","data-sentry-source-file":"MultiSelectV2.tsx"})})]})}),(0,a.jsx)(m.hl,{className:"p-0 w-96 border-strong",side:"bottom",align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsxs)(x.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:[(0,a.jsx)(x.G7,{placeholder:i,"data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx"}),(0,a.jsxs)(x.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:[(0,a.jsx)(x.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:"No options found"}),(0,a.jsx)(x.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MultiSelectV2.tsx",children:(0,a.jsx)(h.FK,{className:(0,u.cn)(N.length>7?"h-[210px]":""),"data-sentry-element":"ScrollArea","data-sentry-source-file":"MultiSelectV2.tsx",children:null==N?void 0:N.map(e=>{let t=!!(b&&b.find(t=>t===e.value));return(0,a.jsx)(x.h_,{value:e.value,className:"cursor-pointer w-full",onClick:()=>S(e),onSelect:()=>S(e),children:(0,a.jsxs)("div",{className:"w-full flex items-center justify-between",children:[e.name,t&&(0,a.jsx)(c.A,{size:14})]})},e.id)})})})]})]})})]})})}},86182:(e,t,s)=>{"use strict";s.d(t,{s:()=>eN});var a=s(80263),n=s(32981),l=s(60045),i=s(32144),r=s(84305),o=s.n(r),c=s(53239),d=s(87494),m=s(73969),u=s(39353),x=s(19898),h=s(41370),p=s(23420),f=s(65344),y=s(68800),g=s(77227),j=s(68875),_=s(57980),v=s(14943),b=s(51859),N=s(9093),w=s(97380),S=s(71126),C=s(84746),E=s(67585),A=s(64540);let k=e=>{let{name:t,schema:s,table:a,behavior:n,command:l,roles:i,using:r,check:o}=e,c='create policy "'.concat(t,'" on "').concat(s,'"."').concat(a,'" as ').concat(n," for ").concat(l," to ").concat(i);return"insert"===l?"".concat(c," with check (").concat(o,");"):"".concat(c," using (").concat(r,")").concat((null!=o?o:"").length>0?"with check (".concat(o,");"):";")},T=(e,t)=>!(("INSERT"!==e.command||e.check===t.check)&&("INSERT"===e.command||e.definition===t.definition&&e.check===t.check)&&e.name===t.name&&o()(e.roles,t.roles));var L=s(26470);let q=e=>{let{schema:t,selectedPolicy:s,formFields:n}=e,l=void 0!==s,{name:i,table:r,behavior:o,command:c,roles:d}=n;return(0,a.jsxs)("div",{className:"bg-surface-300 pt-2 pb-1","data-sentry-component":"LockedCreateQuerySection","data-sentry-source-file":"LockedQuerySection.tsx",children:[(0,a.jsx)("div",{className:"flex items-center justify-between px-5 mb-1",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"pl-0.5 pr-5 flex items-center justify-center",children:(0,a.jsx)(L.A,{size:14,className:"text-foreground-lighter","data-sentry-element":"Lock","data-sentry-source-file":"LockedQuerySection.tsx"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter font-mono uppercase",children:"Use options above to edit"})]})}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"1"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:l?"alter":"create"}),' policy "',0===i.length?"policy_name":i,'"']})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"2"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"on"}),' "',t,'"."',r,'"']})]}),!l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"3"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"as"})," ",o.toLocaleUpperCase()]})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"4"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"for"})," ",c.toLocaleUpperCase()]})]})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"5"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"to"})," ",0===d.length?"public":d]})]}),(0,a.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,a.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"6"}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"insert"===c?"with check":"using"})," ",(0,a.jsx)("span",{className:"text-[#ffd700]",children:"("})]})]})]})},R=e=>{let{oldName:t,newName:s,schema:n,table:l,lineNumber:i}=e;return(0,a.jsxs)("div",{className:"bg-surface-300 py-1","data-sentry-component":"LockedRenameQuerySection","data-sentry-source-file":"LockedQuerySection.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:i})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"alter"})," policy ",t]})]}),(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:i+1})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"on"}),' "',n,'"."',l,'"']})]}),(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:i+2})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"rename"}),' to "',s,'";']})]})]})};var P=s(27452),I=s(44679),M=s(97872),D=s(96485),z=s(61607),F=s(24794),V=s(95793),B=s(36141),O=s(20894),Q=s(29297),H=s(82770);let W=e=>{let{schema:t,searchString:s,selectedTable:n,isEditing:i,form:r,onUpdateCommand:o,authContext:d}=e,{project:m}=(0,M.Om)(),[u,x]=(0,c.useState)(!1),h=(0,g.SE)(l.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{data:p,isSuccess:f}=(0,z.LW)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,schema:t,sortByProperty:"name",includeColumns:!0}),{data:y}=(0,D._X)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString}),j=(null!=y?y:[]).map(e=>({id:e.id,name:e.name,value:e.name,disabled:!1})).sort((e,t)=>e.name.localeCompare(t.name));return(0,c.useEffect)(()=>{if(!i&&void 0===n){let e=null==p?void 0:p.find(e=>e.schema===t&&(e.id.toString()===s||e.name===s));e?r.setValue("table",e.name):f&&p.length>0&&r.setValue("table",p[0].name)}},[i,r,s,p,f,n]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"px-5 py-5 flex flex-col gap-y-4 border-b",children:(0,a.jsxs)("div",{className:"items-start justify-between gap-4 grid grid-cols-12",children:[(0,a.jsx)(_.zB,{control:r.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(_.eI,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,a.jsx)(_.lR,{children:"Policy Name"}),(0,a.jsx)(_.MJ,{children:(0,a.jsx)(F.p,{...t,disabled:!h,className:"bg-control border-control",placeholder:"Provide a name for your policy"})}),(0,a.jsx)(_.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(_.zB,{control:r.control,name:"table",render:e=>{let{field:s}=e;return(0,a.jsxs)(_.eI,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,a.jsxs)(_.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Table"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"on"})," clause"]})]}),"database"===d&&(0,a.jsx)(_.MJ,{children:(0,a.jsxs)(V.AM,{open:u,onOpenChange:x,modal:!1,children:[(0,a.jsx)(V.Wv,{asChild:!0,children:(0,a.jsx)(S.$,{type:"default",disabled:!h,className:"w-full [&>span]:w-full h-[38px] text-sm",iconRight:(0,a.jsx)(P.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:(0,a.jsx)("div",{className:"w-full flex gap-1",children:(0,a.jsxs)("span",{className:"text-foreground",children:[t,".",s.value]})})})}),(0,a.jsx)(V.hl,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,a.jsxs)(B.uB,{children:[(0,a.jsx)(B.G7,{placeholder:"Find a table..."}),(0,a.jsxs)(B.oI,{children:[(0,a.jsx)(B.xL,{children:"No tables found"}),(0,a.jsx)(B.L$,{children:(0,a.jsx)(E.FK,{className:(null!=p?p:[]).length>7?"h-[200px]":"",children:(null!=p?p:[]).map(e=>(0,a.jsx)(B.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{r.setValue("table",e.name),x(!1)},onClick:()=>{r.setValue("table",e.name),x(!1)},children:(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[s.value===e.name?(0,a.jsx)(I.A,{size:13}):"",e.name]})},e.id))})})]})]})})]})}),"realtime"===d&&(0,a.jsx)(_.MJ,{children:(0,a.jsx)(F.p,{disabled:!0,value:"messages.realtime",className:"bg-control border-control"})}),(0,a.jsx)(_.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(_.zB,{control:r.control,name:"behavior",render:e=>{let{field:t}=e;return(0,a.jsxs)(_.eI,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,a.jsxs)(_.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Policy Behavior"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"as"})," clause"]})]}),(0,a.jsx)(_.MJ,{children:(0,a.jsxs)(O.l6,{disabled:i,value:t.value,onValueChange:e=>r.setValue("behavior",e),children:[(0,a.jsx)(O.bq,{className:"text-sm h-10 capitalize",children:t.value}),(0,a.jsx)(O.gC,{children:(0,a.jsxs)(O.s3,{children:[(0,a.jsxs)(O.eb,{value:"permissive",className:"text-sm",children:[(0,a.jsx)("p",{children:"Permissive"}),(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:'Policies are combined using the "OR" Boolean operator'})]}),(0,a.jsxs)(O.eb,{value:"restrictive",className:"text-sm",children:[(0,a.jsx)("p",{children:"Restrictive"}),(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:'Policies are combined using the "AND" Boolean operator'})]})]})})]})}),(0,a.jsx)(_.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(_.zB,{control:r.control,name:"command",render:e=>{let{field:t}=e;return(0,a.jsxs)(_.eI,{className:"col-span-12 flex flex-col gap-y-1",children:[(0,a.jsxs)(_.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Policy Command"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"for"})," clause"]})]}),(0,a.jsx)(_.MJ,{children:(0,a.jsx)(Q.z6,{disabled:i,value:t.value,defaultValue:t.value,onValueChange:e=>{r.setValue("command",e),o(e)},className:"grid grid-cols-10 gap-3 ".concat(i?"opacity-50":""),children:["select","insert",..."database"===d?["update","delete","all"]:[]].map(e=>(0,a.jsx)(Q.Dv,{value:e,disabled:i,label:e.toLocaleUpperCase(),className:"col-span-2 w-auto ".concat(i?"cursor-not-allowed":"")},e))})}),(0,a.jsx)(_.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"}),(0,a.jsx)(_.zB,{control:r.control,name:"roles",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(_.eI,{className:"col-span-12 flex flex-col gap-y-1",children:[(0,a.jsxs)(_.lR,{className:"flex items-center gap-x-4",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Target Roles"}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:[(0,a.jsx)("code",{className:"text-xs",children:"to"})," clause"]})]}),(0,a.jsx)(_.MJ,{children:(0,a.jsx)(H._,{disabled:!h,options:j,value:0===s.value.length?[]:null==(t=s.value)?void 0:t.split(", "),placeholder:"Defaults to all (public) roles if none selected",searchPlaceholder:"Search for a role",onChange:e=>r.setValue("roles",e.join(", "))})}),(0,a.jsx)(_.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"PolicyDetailsV2.tsx"})]})})})};var $=s(62763),U=s(62659),G=s(92692),K=s(65751),Y=s(71390),X=s(16632);let J=e=>{var t;let{selectedPolicy:s,showTools:n,setShowTools:l}=e,[i,r]=(0,c.useState)(!1);return(0,a.jsxs)(v.Fm,{className:(0,b.cn)("py-3 flex flex-row justify-between items-start border-b"),"data-sentry-element":"SheetHeader","data-sentry-component":"PolicyEditorPanelHeader","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-3 max-w-[75%] items-start",children:[(0,a.jsxs)(v.kN,{className:(0,b.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","transition disabled:pointer-events-none data-[state=open]:bg-secondary","mt-1.5"),"data-sentry-element":"SheetClose","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[(0,a.jsx)($.A,{className:"h-3 w-3","data-sentry-element":"X","data-sentry-source-file":"PolicyEditorPanelHeader.tsx"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,a.jsx)("div",{className:"h-[24px] w-[1px] bg-border-overlay"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.qp,{className:"truncate","data-sentry-element":"SheetTitle","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:void 0!==s?"Update policy: ".concat(s.name):"Create a new Row Level Security policy"}),void 0!==s&&(0,a.jsxs)(Y.Nt,{className:"-mt-1.5 pb-1.5",open:i,onOpenChange:r,children:[(0,a.jsx)(Y.R6,{className:"group  font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2 w-full",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"View policy details"}),(0,a.jsx)(U.A,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,a.jsx)(Y.Ke,{className:"grid gap-1.5",children:(0,a.jsx)("div",{className:"flex my-2",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Name:"}),(0,a.jsx)("p",{className:"pr-4",children:null==s?void 0:s.name})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Action:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.action})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Command:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.command})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Target roles:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.roles.join(", ")})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"USING expression:"}),(0,a.jsx)("p",{className:"font-mono pr-4",children:null==s?void 0:s.definition})]}),(0,a.jsxs)("div",{className:"text-xs flex items-start space-x-2 pt-1.5",children:[(0,a.jsx)("p",{className:"w-[110px] text-foreground-light",children:"CHECK expression:"}),(0,a.jsx)("p",{className:"".concat((null==s?void 0:s.check)?"":"text-foreground-light"," font-mono pr-4"),children:null!=(t=null==s?void 0:s.check)?t:"None"})]})]})})})]})]})]}),(0,a.jsxs)(X.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[(0,a.jsx)(X.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:(0,a.jsx)("button",{"aria-expanded":n,"aria-controls":"ai-chat-assistant",className:(0,b.cn)(n?"text-light":"text-foreground-lighter","mt-1 hover:text-foreground transition"),onClick:()=>l(!n),children:n?(0,a.jsx)(K.A,{size:19,strokeWidth:1}):(0,a.jsx)(G.A,{size:19,strokeWidth:1})})}),(0,a.jsxs)(X.ZI,{side:"left","data-sentry-element":"TooltipContent","data-sentry-source-file":"PolicyEditorPanelHeader.tsx",children:[n?"Hide":"Show"," tools"]})]})]})};var Z=s(95285),ee=s(16988),et=s(22195),es=s(65863),ea=s(63720),en=s(83364),el=s(8931),ei=s(14430),er=s(24198),eo=s(95670);let ec=e=>{let{schema:t,table:s,selectedPolicy:n,selectedTemplate:l,onSelectTemplate:i}=e,[r,o]=(0,c.useState)(""),d="realtime"===t?(0,eo.z_)():"pgmq"===t?(0,eo.$Q)():(0,eo.S3)(t,s.length>0?s:"table_name"),m=void 0!==n?d.filter(e=>e.command===n.command):d,u=r.length>0?m.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.command.toLowerCase().includes(r.toLowerCase())):m;return(0,a.jsxs)("div",{className:"h-full px-content py-content flex flex-col gap-3","data-sentry-component":"PolicyTemplates","data-sentry-source-file":"PolicyTemplates.tsx",children:[(0,a.jsx)("label",{className:"sr-only",htmlFor:"template-search",children:"Search templates"}),(0,a.jsx)(ee.A,{size:"small",id:"template-search",icon:(0,a.jsx)(Z.A,{size:16,className:"text-foreground-muted"}),placeholder:"Search templates",value:r,onChange:e=>o(e.target.value),"data-sentry-element":"Input","data-sentry-source-file":"PolicyTemplates.tsx"}),r.length>0&&0===u.length&&(0,a.jsx)(er.A,{searchString:r,className:"min-w-full"}),(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:u.map(e=>(0,a.jsxs)(et.jc,{openDelay:100,closeDelay:100,children:[(0,a.jsx)(et.d0,{children:(0,a.jsx)(el.A,{title:e.name,titleClass:"text-sm",className:(0,b.cn)("transition w-full",e.id===l?"!border-stronger bg-surface-200 hover:!border-stronger":""),onClick:()=>i(e),hideChevron:!0,fixedHeight:!1,icon:(0,a.jsx)("div",{className:"min-w-16",children:(0,a.jsx)(es.E,{className:(0,b.cn)("!rounded font-mono","UPDATE"===e.command?"bg-blue-400 text-blue-900 border border-blue-800":""),variant:"ALL"===e.command?"outline":"SELECT"===e.command?"brand":"UPDATE"===e.command?"default":"DELETE"===e.command?"destructive":"warning",children:e.command})}),children:(0,a.jsx)(ea.o,{content:e.description,className:"[&>p]:m-0 space-y-2"})},e.id)}),(0,a.jsxs)(et.Et,{hideWhenDetached:!0,side:"left",align:"center",className:"w-[500px] flex",animate:"slide-in",children:[(0,a.jsx)(en.X,{showCopy:!1,className:"sql",parentClassName:"!p-0 [&>div>span]:text-xs",children:e.statement}),(0,a.jsx)(ei.A,{iconOnly:!0,type:"default",className:"px-1 absolute top-1.5 right-1.5",text:e.statement})]})]},e.id))})]})};var ed=s(53029),em=s.n(ed),eu=s(88491),ex=s.n(eu),eh=s(35634),ep=s.n(eh),ef=s(70324);let ey=e=>{var t,s,n,l;let{error:i,open:r,setOpen:o}=e,c=null!=(l=null==(t=null!=(n=null==i||null==(s=i.formattedError)?void 0:s.split("\n"))?n:[])?void 0:t.filter(e=>e.length>0))?l:[];return(0,a.jsxs)("div",{className:"flex flex-col gap-y-3 px-5","data-sentry-component":"QueryError","data-sentry-source-file":"QueryError.tsx",children:[(0,a.jsxs)(ef.Fc,{variant:"destructive","data-sentry-element":"Alert_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5","data-sentry-element":"svg","data-sentry-source-file":"QueryError.tsx",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z","data-sentry-element":"path","data-sentry-source-file":"QueryError.tsx"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(ef.XL,{className:"m-0","data-sentry-element":"AlertTitle_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:"Error running SQL query"}),(0,a.jsxs)(Y.Nt,{defaultOpen:!0,className:"flex flex-col gap-3",open:r,onOpenChange:()=>o(!r),"data-sentry-element":"Collapsible_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(Y.R6,{asChild:!0,"data-sentry-element":"CollapsibleTrigger_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:(0,a.jsx)(S.$,{size:"tiny",type:"outline",className:(0,b.cn)("group",ep()["ai-icon__container--allow-hover-effect"]),"data-sentry-element":"Button","data-sentry-source-file":"QueryError.tsx",children:r?"Hide error details":"Show error details"})})}),(0,a.jsx)(Y.Ke,{className:"overflow-auto","data-sentry-element":"CollapsibleContent_Shadcn_","data-sentry-source-file":"QueryError.tsx",children:c.length>0?c.map((e,t)=>(0,a.jsx)("pre",{className:"font-mono text-xs whitespace-pre-wrap",children:e.split(" ").reduce((e,t)=>{let s=ex()(e);return s&&"ERROR:"!==s?em()(e).concat([[s,t].join(" ")]):""===s?e.concat([" "]):e.concat([t])},[]).map((e,t,s)=>(0,a.jsx)("span",{className:(0,b.cn)("break-all","ERROR:"===e&&"text-destructive"),children:e},t))},"error-".concat(t))):(0,a.jsx)("p",{className:"font-mono text-xs",children:i.error})})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto"})]})};var eg=s(14360),ej=s(83927),e_=s.n(ej),ev=s(17271);let eb=e=>{let{id:t,defaultValue:s,wrapperClassName:n,className:l,value:i,placeholder:r,readOnly:o=!1,disableTabToUsePlaceholder:d=!1,lineNumberStart:m,onChange:u=e_(),onMount:x=e_(),editorRef:h,monacoRef:p}=e,f=(0,c.useRef)(),y=(0,eg.useMonaco)(),g="monaco-placeholder-".concat(t),j=async(e,t)=>{h.current=e,void 0!==p&&(p.current=t),f.current=e.createContextKey("hasValue",!1);let s=document.getElementById(g);s&&void 0!==r&&0===(null!=i?i:"").trim().length&&(s.style.display="block"),d||e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(null!=r?r:"").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue"),e.focus(),x()};return(0,c.useEffect)(()=>{u()},[i]),(0,c.useEffect)(()=>{if(y){let e=y.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),s=(0,ev.A)(t);return[{range:e.getFullModelRange(),text:s.trim()}]}});return()=>{e.dispose()}}},[y]),(0,c.useEffect)(()=>{if(void 0!==i&&i.trim().length>0){let e=document.getElementById(g);e&&(e.style.display="none")}},[i]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eg.default,{path:t,theme:"supabase",wrapperProps:{className:(0,b.cn)(n)},className:(0,b.cn)(l,"monaco-editor"),value:null!=i?i:void 0,defaultLanguage:"pgsql",defaultValue:null!=s?s:void 0,options:{tabSize:2,fontSize:13,readOnly:o,minimap:{enabled:!1},wordWrap:"on",contextmenu:!0,lineNumbers:void 0!==m?e=>(e+m).toString():void 0,glyphMargin:void 0,lineNumbersMinChars:4,folding:void 0,scrollBeyondLastLine:!1},onMount:j,onChange:e=>{f.current.set((null!=e?e:"").length>0);let t=document.getElementById(g);t&&(e?t.style.display="none":t.style.display="block"),u()},"data-sentry-element":"Editor","data-sentry-source-file":"RLSCodeEditor.tsx"}),void 0!==r&&(0,a.jsx)("div",{id:g,className:(0,b.cn)("monaco-placeholder absolute top-[0px] left-[57px] text-sm pointer-events-none font-mono tracking-tighter","[&>div>p]:text-foreground-lighter [&>div>p]:!m-0"),style:{display:"none"},children:(0,a.jsx)(ea.o,{content:r})})]})},eN=(0,c.memo)(function(e){let{visible:t,schema:s,searchString:r,selectedTable:L,selectedPolicy:P,onSelectCancel:I,authContext:M}=e,{ref:D}=(0,x.g)(),z=(0,i.jE)(),F=(0,j.KT)(),V=(0,g.SE)(l.aG.TENANT_SQL_ADMIN_WRITE,"tables"),[B,O]=(0,c.useState)(""),[Q,H]=(0,c.useState)(""),[$,U]=(0,c.useState)(),[G,K]=(0,c.useState)(!0),Y=(0,c.useRef)(null),X=(0,c.useRef)(null),[Z,ee]=(0,c.useState)(1),[et,es]=(0,c.useState)(0),ea=(0,c.useRef)(null),en=(0,c.useRef)(null),[el,ei]=(0,c.useState)(1),[er,eo]=(0,c.useState)(0),[ed,em]=(0,c.useState)(),[eu,ex]=(0,c.useState)(!0),[eh,ep]=(0,c.useState)(!1),[ef,eg]=(0,c.useState)(),[ej,e_]=(0,c.useState)(!1),[ev,eN]=(0,c.useState)(!1),ew="rls-editor",eS=u.Ik({name:u.Yj().min(1,"Please provide a name"),table:u.Yj(),behavior:u.Yj(),command:u.Yj(),roles:u.Yj()}),eC={name:"",table:"",behavior:"permissive",command:"select",roles:""},eE=(0,d.mN)({mode:"onBlur",reValidateMode:"onBlur",resolver:(0,n.u)(eS),defaultValues:eC}),{name:eA,table:ek,behavior:eT,command:eL,roles:eq}=eE.watch(),eR=["update","all"].includes(eL),eP=void 0!==P&&eA!==P.name,{mutate:eI,isLoading:eM}=(0,y.Y)({onSuccess:async()=>{await z.invalidateQueries(f.S.list(D)),m.oR.success("Successfully created new policy"),I()},onError:e=>em(e)}),{mutate:eD,isLoading:ez}=(0,p.V)({onSuccess:()=>{m.oR.success("Successfully updated policy"),I()}}),eF=()=>{var e,t,s,a;let n=(null!=(s=null==(e=X.current)?void 0:e.getValue().trim())?s:null)||null,l=(null!=(a=null==(t=en.current)?void 0:t.getValue().trim())?a:null)||null,i=void 0===P&&(eA.length>0||eq.length>0||n||l),r=void 0!==P&&T(P,{name:eA,roles:0===eq.length?["public"]:eq.split(", "),definition:n,check:"INSERT"===eL?n:l});i||r?eN(!0):I()};return(0,c.useEffect)(()=>{if(t)if(V&&e_(!0),void 0!==P){let{name:e,action:t,table:s,command:a,roles:n}=P;eE.reset({name:e,table:s,behavior:t.toLowerCase(),command:a.toLowerCase(),roles:1===n.length&&"public"===n[0]?"":n.join(", ")}),P.definition&&O("  ".concat(P.definition)),P.check&&H("  ".concat(P.check)),P.check&&"INSERT"!==P.command&&K(!0)}else void 0!==L&&eE.reset({...eC,table:L});else{var e,s;null==(e=X.current)||e.setValue(""),null==(s=en.current)||s.setValue(""),e_(!1),eN(!1),em(void 0),ep(!1),eg(void 0),O(""),H(""),K(!1),U(void 0),eE.reset(eC)}},[t]),(0,c.useEffect)(()=>{var e;null==(e=X.current)||e.layout({width:0,height:0}),window.requestAnimationFrame(()=>{var e;null==(e=X.current)||e.layout()})},[eh,ed,eu]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.lV,{...eE,children:(0,a.jsx)("form",{id:ew,onSubmit:eE.handleSubmit(e=>{var t,a,n;let{name:l,table:i,behavior:r,command:c,roles:d}=e,m=null!=(n=null==(t=X.current)?void 0:t.getValue().trim())?n:void 0,u=null==(a=en.current)?void 0:a.getValue().trim();if("insert"===c&&(u=m),"insert"===c&&(void 0===u||0===u.length))return U("Please provide a SQL expression for the WITH CHECK statement");if("insert"!==c&&(void 0===m||0===m.length))return U("Please provide a SQL expression for the USING statement");if(U(void 0),void 0===P){let e=k({name:l,schema:s,table:i,behavior:r,command:c,roles:0===d.length?"public":d,using:null!=m?m:"",check:"insert"===c?null!=m?m:"":null!=u?u:""});em(void 0),eI({sql:e,projectRef:null==F?void 0:F.ref,connectionString:null==F?void 0:F.connectionString,handleError:e=>{throw e}})}else if(void 0!==F){let e={},t=0===d.length?["public"]:d.split(", ");if(l!==P.name&&(e.name=l),o()(P.roles,t)||(e.roles=t),null!==P.definition&&P.definition!==m&&(e.definition=m),"INSERT"===P.command?null!==P.check&&P.check!==m&&(e.check=m):null!==P.check&&P.check!==u&&(e.check=u),0===Object.keys(e).length)return I();eD({projectRef:F.ref,connectionString:null==F?void 0:F.connectionString,originalPolicy:P,payload:e})}}),children:(0,a.jsx)(v.cj,{open:t,onOpenChange:()=>eF(),children:(0,a.jsxs)(v.h,{showClose:!1,size:ej?"lg":"default",className:(0,b.cn)("bg-surface-200 p-0 flex flex-row gap-0",ej?"!min-w-[100vw] lg:!min-w-[1000px]":"!min-w-[100vw] lg:!min-w-[600px]"),children:[(0,a.jsxs)("div",{className:(0,b.cn)("flex flex-col grow w-full",ej&&"w-[60%]"),children:[(0,a.jsx)(J,{selectedPolicy:P,showTools:ej,setShowTools:e_}),(0,a.jsxs)("div",{className:"flex flex-col h-full w-full justify-between overflow-y-auto",children:[(0,a.jsx)(W,{schema:s,searchString:r,selectedTable:L,isEditing:void 0!==P,form:eE,onUpdateCommand:e=>{U(void 0),["update","all"].includes(e)?K(!0):K(!1)},authContext:M}),(0,a.jsxs)("div",{className:"h-full",children:[(0,a.jsx)(q,{schema:s,selectedPolicy:P,formFields:{name:eA,table:ek,behavior:eT,command:eL,roles:eq}}),(0,a.jsx)("div",{className:"mt-1 relative block",style:{height:et<=100?"".concat(8+et,"px"):"108px"},children:(0,a.jsx)(eb,{disableTabToUsePlaceholder:!0,readOnly:!V,id:"rls-exp-one-editor",placeholder:"insert"===eL?"-- Provide a SQL expression for the with check statement":"-- Provide a SQL expression for the using statement",defaultValue:"insert"===eL?Q:B,value:"insert"===eL?Q:B,editorRef:X,monacoRef:Y,lineNumberStart:6,onChange:()=>{var e,t,s,a,n;es(null!=(a=null==(e=X.current)?void 0:e.getContentHeight())?a:0),ee(null!=(n=null==(s=X.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},onMount:()=>{setTimeout(()=>{var e,t,s,a,n;es(null!=(a=null==(e=X.current)?void 0:e.getContentHeight())?a:0),ee(null!=(n=null==(s=X.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},200)}})}),(0,a.jsx)("div",{className:"bg-surface-300 py-1",children:(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:7+Z})}),(0,a.jsx)("p",{className:"font-mono tracking-tighter",children:G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[#569cd6]",children:"with check"})," ",(0,a.jsx)("span",{className:"text-[#ffd700]",children:"("})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[#ffd700]",children:")"}),";"]})})]})}),G&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-1 min-h-[28px] relative block",style:{height:er<=100?"".concat(8+er,"px"):"108px"},children:(0,a.jsx)(eb,{disableTabToUsePlaceholder:!0,readOnly:!V,id:"rls-exp-two-editor",placeholder:"-- Provide a SQL expression for the with check statement",defaultValue:Q,value:Q,editorRef:en,monacoRef:ea,lineNumberStart:7+Z,onChange:()=>{var e,t,s,a,n;eo(null!=(a=null==(e=en.current)?void 0:e.getContentHeight())?a:0),ei(null!=(n=null==(s=en.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},onMount:()=>{setTimeout(()=>{var e,t,s,a,n;eo(null!=(a=null==(e=en.current)?void 0:e.getContentHeight())?a:0),ei(null!=(n=null==(s=en.current)||null==(t=s.getModel())?void 0:t.getLineCount())?n:1)},200)}})}),(0,a.jsx)("div",{className:"bg-surface-300 py-1",children:(0,a.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,a.jsx)("div",{className:"w-[57px]",children:(0,a.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:8+Z+el})}),(0,a.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,a.jsx)("span",{className:"text-[#ffd700]",children:")"}),";"]})]})})]}),eP&&(0,a.jsx)(R,{oldName:P.name,newName:eA,schema:s,table:ek,lineNumber:8+Z+(G?el:0)}),void 0!==$&&(0,a.jsx)("p",{className:"px-5 py-2 pb-0 text-sm text-red-900",children:$}),eR&&(0,a.jsxs)("div",{className:"px-5 py-3 flex items-center gap-x-2",children:[(0,a.jsx)(N.S,{id:"use-check",name:"use-check",checked:G,onCheckedChange:()=>{U(void 0),K(!G)}}),(0,a.jsx)(w.J,{className:"text-xs cursor-pointer",htmlFor:"use-check",children:"Use check expression"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[void 0!==ed&&(0,a.jsx)(ey,{error:ed,open:eu,setOpen:ex}),(0,a.jsxs)(v.XW,{className:"flex items-center !justify-end px-5 py-4 w-full border-t",children:[(0,a.jsx)(S.$,{type:"default",disabled:eM||ez,onClick:()=>eF(),children:"Cancel"}),(0,a.jsx)(h.G,{form:ew,htmlType:"submit",loading:eM||ez,disabled:!V||eM||ez,tooltip:{content:{side:"top",text:V?void 0:"You need additional permissions to update policies"}},children:"Save policy"})]})]})]})]}),ej&&(0,a.jsx)("div",{className:(0,b.cn)("border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10",ej&&"w-[50%]","bg-studio overflow-auto"),children:(0,a.jsxs)(C.tU,{defaultValue:"templates",className:"flex flex-col h-full w-full",children:[(0,a.jsx)(C.j7,{className:"flex gap-4 px-content pt-2",children:(0,a.jsx)(C.Xi,{value:"templates",className:"px-0 data-[state=active]:bg-transparent",children:"Templates"},"templates")}),(0,a.jsx)(C.av,{value:"templates",className:(0,b.cn)("!mt-0 overflow-y-auto","data-[state=active]:flex data-[state=active]:grow"),children:(0,a.jsx)(E.FK,{className:"h-full w-full",children:(0,a.jsx)(ec,{schema:s,table:ek,selectedPolicy:P,selectedTemplate:ef,onSelectTemplate:e=>{var t;eE.setValue("name",e.name),eE.setValue("behavior","permissive"),eE.setValue("command",e.command.toLowerCase()),eE.setValue("roles",null!=(t=e.roles.join(", "))?t:""),O("  ".concat(e.definition)),H("  ".concat(e.check)),ee(1),ei(1),U(void 0),["update","all"].includes(e.command.toLowerCase())&&e.check.length>0?K(!0):K(!1)}})})})]})})]})})})}),(0,a.jsx)(A.A,{visible:ev,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>eN(!1),onConfirm:()=>{I(),eN(!1)},children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to close the editor? Any unsaved changes on your policy and conversations with the Assistant will be lost."})})]})});eN.displayName="PolicyEditorPanel"},87080:(e,t,s)=>{"use strict";s.d(t,{F:()=>a});let a=e=>{let t="";return null!==e.definition&&void 0!==e.definition&&(t+="using (".concat(e.definition,")").concat(null===e.check||void 0===e.check?";":"","\n")),null!==e.check&&void 0!==e.check&&(t+="with check (".concat(e.check,");\n")),'\nalter policy "'.concat(e.name,'" \non "').concat(e.schema,'"."').concat(e.table,'"\nto ').concat(e.roles.join(", "),"\n").concat(t,"\n").trim()}},95670:(e,t,s)=>{"use strict";s.d(t,{$Q:()=>l,S3:()=>a,z_:()=>n});let a=(e,t)=>[{id:"policy-1",preview:!1,templateName:"Enable read access to everyone",description:"This policy gives read access to your table for all users via the SELECT operation.",statement:'\ncreate policy "Enable read access for all users"\non "'.concat(e,'"."').concat(t,'"\nfor select using (true);').trim(),name:"Enable read access for all users",definition:"true",check:"",command:"SELECT",roles:[]},{id:"policy-2",preview:!1,templateName:"Enable insert access for authenticated users only",description:"This policy gives insert access to your table for all authenticated users only.",statement:'\ncreate policy "Enable insert for authenticated users only"\non "'.concat(e,'"."').concat(t,'"\nfor insert to authenticated\nwith check (true);').trim(),name:"Enable insert for authenticated users only",definition:"",check:"true",command:"INSERT",roles:["authenticated"]},{id:"policy-3",preview:!1,templateName:"Enable update access for users based on their email *",description:'This policy assumes that your table has a column "email", and allows users to update rows which the "email" column matches their email.',statement:'\ncreate policy "Enable update for users based on email"\non "'.concat(e,'"."').concat(t,"\"\nfor update using (\n  (select auth.jwt()) ->> 'email' = email\n) with check (\n  (select auth.jwt()) ->> 'email' = email\n);").trim(),name:"Enable update for users based on email",definition:"(select auth.jwt()) ->> 'email' = email",check:"(select auth.jwt()) ->> 'email' = email",command:"UPDATE",roles:[]},{id:"policy-4",preview:!1,templateName:"Enable delete access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to delete rows which the "user_id" column matches their ID',statement:'\ncreate policy "Enable delete for users based on user_id"\non "'.concat(e,'"."').concat(t,'"\nfor delete using (\n  (select auth.uid()) = user_id\n);').trim(),name:"Enable delete for users based on user_id",definition:"(select auth.uid()) = user_id",check:"",command:"DELETE",roles:[]},{id:"policy-5",preview:!1,templateName:"Enable insert access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to insert rows which the "user_id" column matches their ID',statement:'\ncreate policy "Enable insert for users based on user_id"\non "'.concat(e,'"."').concat(t,'"\nfor insert with check (\n  (select auth.uid()) = user_id\n);').trim(),name:"Enable insert for users based on user_id",definition:"",check:"(select auth.uid()) = user_id",command:"INSERT",roles:[]},{id:"policy-6",preview:!0,name:"Policy with table joins",templateName:"Policy with table joins",description:"\nQuery across tables to build more advanced RLS rules\n\nAssuming 2 tables called `teams` and `members`, you can query both tables in the policy to control access to the members table.",statement:'\ncreate policy "Members can update team details if they belong to the team"\non teams for update using (\n  (select auth.uid()) in (\n    select user_id from members where team_id = id\n  )\n);\n'.trim(),definition:"(select auth.uid()) in (select user_id from members where team_id = id)",check:"",command:"UPDATE",roles:[]},{id:"policy-7",preview:!0,templateName:"Policy with security definer functions",description:"\nUseful in a many-to-many relationship where you want to restrict access to the linking table.\n\nAssuming 2 tables called `teams` and `members`, you can use a security definer function in combination with a policy to control access to the members table.".trim(),statement:'\ncreate or replace function get_teams_for_user(user_id uuid)\nreturns setof bigint as $$\n  select team_id from members where user_id = $1\n$$ stable language sql security definer;\n\ncreate policy "Team members can update team members if they belong to the team"\non members\nfor all using (\n  team_id in (select get_teams_for_user(auth.uid()))\n);\n'.trim(),name:"Policy with security definer functions",definition:"team_id in (select get_teams_for_user(auth.uid()))",check:"",command:"ALL",roles:[]},{id:"policy-8",preview:!0,name:"Policy to implement Time To Live (TTL)",templateName:"Policy to implement Time To Live (TTL)",description:"\nImplement a TTL-like feature that you see in Instagram stories or Snapchat where messages expire after a day.\n\nRows under the table are available only if they have been created within the last 24 hours.",statement:'\ncreate policy "Stories are live for a day"\non "'.concat(e,'"."').concat(t,"\"\nfor select using (\n  created_at > (current_timestamp - interval '1 day')\n);\n").trim(),definition:"created_at > (current_timestamp - interval '1 day')",check:"",command:"SELECT",roles:[]},{id:"policy-9",preview:!1,templateName:"Allow users to only view their own data",description:"Restrict users to reading only their own data.",statement:'\ncreate policy "Enable users to view their own data only"\non "'.concat(e,'"."').concat(t,'"\nfor select\nto authenticated\nusing (\n  (select auth.uid()) = user_id\n);').trim(),name:"Enable users to view their own data only",definition:"(select auth.uid()) = user_id",check:"",command:"SELECT",roles:["authenticated"]}],n=()=>[{id:"policy-broadcast-1",preview:!1,templateName:"Allow listening for broadcasts for authenticated users only",description:"This policy allows listening for broadcasts for authenticated users only.",statement:"\ncreate policy  \"Allow listening for broadcasts for authenticated users only\"\non realtime.messages for select\nto authenticated\nusing ( realtime.messages.extension = 'broadcast' );".trim(),name:"Allow listening for broadcasts for authenticated users only",definition:"realtime.messages.extension = 'broadcast'",check:"",command:"SELECT",roles:["authenticated"]},{id:"policy-broadcast-2",preview:!1,templateName:"Allow pushing broadcasts for authenticated users only",description:"This policy allows pushing broadcasts for authenticated users only.",statement:"\ncreate policy \"Allow pushing broadcasts for authenticated users only\"\nON realtime.messages for insert\nTO authenticated\nwith check ( realtime.messages.extension = 'broadcast' );".trim(),name:"Allow pushing broadcasts for authenticated users only",definition:"realtime.messages.extension = 'broadcast'",check:"realtime.messages.extension = 'broadcast'",command:"INSERT",roles:["authenticated"]},{id:"policy-broadcast-3",preview:!1,templateName:"Allow listening for broadcasts from a specific channel",description:"This policy allows listening for broadcasts from a specific channel.",statement:"\ncreate policy \"Allow listening for broadcasts from a specific channel\"\non realtime.messages for select\nusing ( realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name' );".trim(),name:"Allow listening for broadcasts from a specific channel",definition:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",check:"",command:"SELECT",roles:[]},{id:"policy-broadcast-4",preview:!1,templateName:"Allow pushing broadcasts to specific channel",description:"This policy allow pushing broadcasts to specific channel.",statement:"\ncreate policy \"Allow pushing broadcasts to specific channel\"\nON realtime.messages for insert\nwith check ( realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name' );".trim(),name:"Allow pushing broadcasts to specific channel",definition:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",check:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",command:"INSERT",roles:[]},{id:"policy-presences-1",preview:!1,templateName:"Allow listening for presences on all channels for authenticated users only",description:"This policy enables listening for presences on all channels for all authenticated users only.",statement:"\ncreate policy \"Allow listening for presences on all channels for authenticated users only\"\non realtime.messages for select\nto authenticated\nusing ( realtime.messages.extension = 'presence' );".trim(),name:"Allow listening for presences on all channels for authenticated users only",definition:"realtime.messages.extension = 'presence'",check:"",command:"SELECT",roles:["authenticated"]},{id:"policy-presences-2",preview:!1,templateName:"Allow broadcasting presences on all channels for authenticated users only",description:"This policy enables broadcasting presences on all channels for all authenticated users only.",statement:"\ncreate policy \"Allow broadcasting presences on all channels for authenticated users only\"\nON realtime.messages for insert\nTO authenticated\nwith check ( realtime.messages.extension = 'presence' );\n  ;".trim(),name:"Allow broadcasting presences on all channels for authenticated users only",definition:"realtime.messages.extension = 'presence'",check:"realtime.messages.extension = 'presence'",command:"INSERT",roles:["authenticated"]},{id:"policy-presences-3",preview:!1,templateName:"Allow listening for presences from a specific channel",description:"This policy enables listening for presences from a specific channel.",statement:"\ncreate policy \"Allow listening for presences from a specific channel\"\non realtime.messages for select\nusing ( realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name' );".trim(),name:"Allow listening for presences from a specific channel",definition:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",check:"",command:"SELECT",roles:[]},{id:"policy-presences-4",preview:!1,templateName:"Publish presence to a specific channel",description:"This policy allows publishing presence to a specific channel.",statement:"\ncreate policy \"Publish presence to a specific channel\"\nON realtime.messages for insert\nwith check ( realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name' );\n  ;".trim(),name:"Publish presence to a specific channel",definition:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",check:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",command:"INSERT",roles:[]}],l=()=>[{id:"policy-queues-1",preview:!1,templateName:"Allow access to queue",statement:"".trim(),name:"Allow anon and authenticated to access messages from queue",description:"Base policy to ensure that anon and authenticated can only access appropriate rows. USING and CHECK statements will need to be adjusted accordingly",definition:"true",check:"true",command:"ALL",roles:["anon","authenticated"]}]},96485:(e,t,s)=>{"use strict";s.d(t,{tV:()=>d,_X:()=>c});var a=s(45874),n=s(56947),l=s(96557);let i={databaseRoles:e=>["projects",e,"database-roles"]},r=a.A.roles.list();async function o(e,t){let{projectRef:s,connectionString:a}=e,{result:n}=await (0,l.E)({projectRef:s,connectionString:a,sql:r.sql,queryKey:["database-roles"]},t);return n}let c=function(e){let{projectRef:t,connectionString:s}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.I)(i.databaseRoles(t),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:s},a)},{enabled:a&&void 0!==t,...l})};function d(e,t){return e.invalidateQueries(i.databaseRoles(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[89,2180,2147,726,735,9353,7176,3730,2056,6110,9844,9025,1501,8316,5297,4387,4100,445,2981,4181,556,4560,7795,698,6538,4938,3916,7872,5874,49,2174,971,9063,9124,651,1490,6593,636,8792],()=>t(3771)),_N_E=e.O()}]);