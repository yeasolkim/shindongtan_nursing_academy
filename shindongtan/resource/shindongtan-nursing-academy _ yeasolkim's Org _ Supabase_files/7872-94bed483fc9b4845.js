!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="e0839e86-1286-48b7-842e-8183bf2ae633",e._sentryDebugIdIdentifier="sentry-dbid-e0839e86-1286-48b7-842e-8183bf2ae633")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7872],{4327:(e,t,a)=>{a.d(t,{PE:()=>u,Rd:()=>h,Uh:()=>p,Ym:()=>c,fU:()=>d,iN:()=>m,ok:()=>i});var o=a(73969),n=a(64588),l=a(51527),r=a(99325),s=a(81018);let i=".emptyFolderPlaceholder",c=(e,t)=>{let a=e.slice(0,t.columnIndex).map(e=>e.name),n=a.length>0?"".concat(a.join("/"),"/").concat(t.name):t.name;(0,l.l)(n),o.oR.success('Copied path to folder "'.concat(t.name,'"'))},d=e=>{let t=Math.floor(e/86400),a=Math.floor((e%=86400)/3600),o=Math.floor((e%=3600)/60);return(e=Math.floor(e%60),t>0)?"".concat(t,"d "):a>0?"".concat(a,"h "):o>0?"".concat(o,"m "):"".concat(e,"s")},u=async e=>{var t,a,l;let{projectRef:s,bucketId:i,file:c,showToast:d=!0,returnBlob:u=!1}=e;if(!s)return o.oR.error("Failed to download: Project ref is required");if(!i)return o.oR.error("Failed to download: Bucket ID is required");if(!c.path)return o.oR.error("Failed to download: Unable to find path to file");let p=c.name,m=null!=(a=null==c||null==(t=c.metadata)?void 0:t.mimetype)?a:void 0,f=d?o.oR.loading("Retrieving ".concat(p,"...")):void 0;try{let e=await (0,n.c)({projectRef:s,bucketId:i,path:c.path}),t=await e.blob(),a=new Blob([t],{type:m});if(u)return{name:p,blob:a};let d=window.URL.createObjectURL(a),h=document.createElement("a");return h.href=d,h.setAttribute("download","".concat(p)),document.body.appendChild(h),h.click(),null==(l=h.parentNode)||l.removeChild(h),window.URL.revokeObjectURL(t),f&&o.oR.success("Downloading ".concat(p),{id:f,closeButton:!0,duration:r.j}),!0}catch(e){return f&&o.oR.error("Failed to download ".concat(p),{id:f,closeButton:!0,duration:r.j}),!1}},p=e=>{let t=0,a=0;return e.forEach(e=>{if(0===(a+=e.remainingBytes))return;let o=e.remainingBytes/a;t+=o*e.remainingTime}),t},m=function(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1?arguments[1]:void 0;return null!=(t=null==(e=null!=a?a:[])?void 0:e.filter(e=>e.name!==i).map(e=>{let t=e.id?s.Vl.FILE:s.Vl.FOLDER,a=Number(new Date)-Number(new Date(e.created_at)),n=t===s.Vl.FILE&&!e.metadata&&a>=9e5,l=t===s.Vl.FILE&&!e.metadata&&a<=9e5?s.U1.LOADING:s.U1.READY;return{...e,metadata:e.metadata,type:t,status:l,isCorrupted:n,path:o?"".concat(o,"/").concat(e.name):e.name}}))?t:[]},f=async e=>{try{return await new Promise((t,a)=>e.file(t,a))}catch(e){console.error("getFile error:",e);return}},h=async e=>{let t=(0,o.oR)("Retrieving items to upload..."),a=[],n=[];for(let t of e){let e=t.webkitGetAsEntry();e&&n.push(e)}for(;n.length>0;){let e=n.shift();if(e&&e.isFile){let t=await f(e);void 0!==t&&(t.path=e.fullPath.slice(1),a.push(t))}else e&&e.isDirectory&&n.push(...await g(e.createReader()))}return o.oR.dismiss(t),a},g=async e=>{let t=[],a=await v(e);for(;a&&a.length>0;)t.push(...a),a=await v(e);return t},v=async e=>{try{return await new Promise((t,a)=>{e.readEntries(t,a)})}catch(e){console.error("readEntriesPromise error:",e)}}},30672:(e,t,a)=>{a.d(t,{Jb:()=>n,OG:()=>l,yO:()=>r});var o=a(77952);let n=(e,t)=>{if(e<=0)return{value:0,unit:o.s.BYTES};let a=void 0!==t?Object.values(o.s).indexOf(t):Math.floor(Math.log(e)/Math.log(1024)),n=void 0!==t?a<0?0:a:a>3?3:a,l=Object.values(o.s)[n];return{value:e/Math.pow(1024,n),unit:l}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.s.BYTES,a=Object.values(o.s).indexOf(t);return e<0||a<0?0:e*Math.pow(1024,a)};function r(e,t,a){let o=new URL(a?"".concat(t,"://").concat(a):"https://".concat(e,".supabase.co"));return o.pathname="/storage/v1/s3",o.toString()}},32036:(e,t,a)=>{a.d(t,{ME:()=>f,Qj:()=>g,RY:()=>h,_c:()=>b,sc:()=>v});var o=a(80263),n=a(53239),l=a(56028),r=a(12532),s=a(19898),i=a(96557),c=a(87936),d=a(68875),u=a(81979);function p(e,t){let a=(0,l.BX)({projectRef:e,role:void 0,claims:void 0,setRole:async(o,n)=>{let l=(null==o?void 0:o.type)==="postgrest"?(0,u.bL)(e,o):void 0;if((null==n?void 0:n.type)==="postgres"&&void 0!==l){let{schema:e,functionName:a}=n,o=await t.current({schema:e,functionName:a,claims:l});o&&(l=o)}a.role=o,l&&(a.claims=l)}});return a}let m=(0,n.createContext)(p("",{current:async()=>{}})),f=e=>{let{children:t}=e,a=(0,d.KT)();async function n(e){var t,o,n;let{schema:l,functionName:r,claims:s}=e,c={user_id:s.sub,claims:s,authentication_method:"password"},d=await (0,i.E)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString,sql:"select ".concat(l,".").concat(r,"('").concat(JSON.stringify(c),"'::jsonb) as event;"),queryKey:["customize-access-token",null==a?void 0:a.ref]});return null==d||null==(n=d.result)||null==(o=n[0])||null==(t=o.event)?void 0:t.claims}let l=(0,c.A)(n),r=(0,s.MF)(()=>{var e;return p(null!=(e=null==a?void 0:a.ref)?e:"",l)});return(0,o.jsx)(m.Provider,{value:r,"data-sentry-element":"unknown","data-sentry-component":"RoleImpersonationStateContextProvider","data-sentry-source-file":"role-impersonation-state.tsx",children:t})};function h(e){let t=(0,n.useContext)(m);return(0,r.s)(t,e)}function g(){let e=(0,n.useContext)(m);return(0,n.useCallback)(()=>(0,l.P9)(e),[e])}function v(e){let t=(0,n.useContext)(m),a=(0,c.A)(e);(0,n.useEffect)(()=>(0,l.B1)(t,()=>{a.current((0,l.P9)(t).role)}),[t])}function b(e){return(null==e?void 0:e.type)==="postgrest"}},39321:(e,t,a)=>{a.d(t,{ap:()=>u,by:()=>d,to:()=>s});var o=a(80263),n=a(53239),l=a(56028),r=a(12532);let s=100,i=()=>{let e=(0,l.BX)({rowsPerPage:s,setRowsPerPage:t=>{e.rowsPerPage=t},ui:{open:"none"},get sidePanel(){return"side-panel"===e.ui.open?e.ui.sidePanel:void 0},get confirmationDialog(){return"confirmation-dialog"===e.ui.open?e.ui.confirmationDialog:void 0},closeSidePanel:()=>{e.ui={open:"none"}},closeConfirmationDialog:()=>{e.ui={open:"none"}},onAddSchema:()=>{e.ui={open:"side-panel",sidePanel:{type:"schema",mode:"new"}}},onAddTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"new"}}},onEditTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"edit"}}},onDuplicateTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"duplicate"}}},onDeleteTable:()=>{e.ui={open:"confirmation-dialog",confirmationDialog:{type:"table",isDeleteWithCascade:!1}}},onAddColumn:()=>{e.ui={open:"side-panel",sidePanel:{type:"column"}}},onEditColumn:t=>{e.ui={open:"side-panel",sidePanel:{type:"column",column:t}}},onDeleteColumn:t=>{e.ui={open:"confirmation-dialog",confirmationDialog:{type:"column",column:t,isDeleteWithCascade:!1}}},onAddRow:()=>{e.ui={open:"side-panel",sidePanel:{type:"row"}}},onEditRow:t=>{e.ui={open:"side-panel",sidePanel:{type:"row",row:t}}},onDeleteRows:function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{numRows:0,allRowsSelected:!1,callback:()=>{}},{numRows:o,allRowsSelected:n,callback:l}=a;e.ui={open:"confirmation-dialog",confirmationDialog:{type:"row",rows:t,numRows:o,allRowsSelected:n,callback:l}}},onExpandJSONEditor:t=>{e.ui={open:"side-panel",sidePanel:{type:"json",jsonValue:t}}},onExpandTextEditor:(t,a)=>{e.ui={open:"side-panel",sidePanel:{type:"cell",value:{column:t,row:a}}}},onEditForeignKeyColumnValue:t=>{e.ui={open:"side-panel",sidePanel:{type:"foreign-row-selector",foreignKey:t}}},onImportData:()=>{e.ui={open:"side-panel",sidePanel:{type:"csv-import"}}},toggleConfirmationIsWithCascade:t=>{"confirmation-dialog"===e.ui.open&&("column"===e.ui.confirmationDialog.type||"table"===e.ui.confirmationDialog.type)&&(e.ui.confirmationDialog.isDeleteWithCascade=null!=t?t:!e.ui.confirmationDialog.isDeleteWithCascade)}});return e},c=(0,n.createContext)(i()),d=e=>{let{children:t}=e,a=(0,n.useRef)(i()).current;return(0,o.jsx)(c.Provider,{value:a,"data-sentry-element":"unknown","data-sentry-component":"TableEditorStateContextProvider","data-sentry-source-file":"table-editor.tsx",children:t})},u=e=>{let t=(0,n.useContext)(c);return(0,r.s)(t,e)}},42230:(e,t,a)=>{let o;a.d(t,{y:()=>et,$:()=>ea});var n=a(80263),l=a(77341),r=a.n(l),s=a(62140),i=a.n(s),c=a(93896),d=a.n(c),u=a(48388),p=a.n(u),m=a(38280),f=a.n(m),h=a(14685),g=a.n(h),v=a(64676),b=a.n(v),y=a(74722),w=a.n(y),I=a(86727),R=a.n(I),x=a(53239),S=a(14251),T=a(73969),A=a(80896),C=a(56028),E=a(12532),j=a(82147),P=a(99715),F=a(19898),D=a(81018),B=a(4327),k=a(30672),O=a(19362),N=a(20010),U=a(16599),M=a(64683),L=a(40807);let _=async(e,t)=>{let{projectRef:a,bucketId:o,paths:n}=e;if(!o)throw Error("bucketId is required");let{data:l,error:r}=await (0,L.yH)("/platform/storage/{ref}/buckets/{id}/objects",{params:{path:{ref:a,id:o}},body:{paths:n},signal:t});return r&&(0,L.H4)(r),l};var q=a(64588);let z=async(e,t)=>{let{projectRef:a,bucketId:o,path:n,options:l}=e;if(!o)throw Error("bucketId is required");let{data:r,error:s}=await (0,L.bE)("/platform/storage/{ref}/buckets/{id}/objects/list",{params:{path:{ref:a,id:o}},body:{path:n,options:l},signal:t});return s&&(0,L.H4)(s),r},G=async e=>{let{projectRef:t,bucketId:a,from:o,to:n}=e;if(!a)throw Error("bucketId is required");let{data:l,error:r}=await (0,L.bE)("/platform/storage/{ref}/buckets/{id}/objects/move",{params:{path:{ref:t,id:a}},body:{from:o,to:n}});return r&&(0,L.H4)(r),l};var Y=a(68875),V=a(64036),K=a(49443);let J=Object.fromEntries(Object.entries(a(32505)).filter(e=>{let[,{extensions:t}]=e;return void 0!==t}).flatMap(e=>{let[t,{extensions:a}]=e;return a.map(e=>[e.toLowerCase(),t])}));var W=a(73535),H=a(99325),X=a(71126);let Z={view:D.JB.COLUMNS,sortBy:D.NA.NAME,sortByOrder:D.ou.ASC};function $(e){var t;let{projectRef:a,resumableUploadUrl:l,serviceKey:s,supabaseClient:c}=e,u=F.rS.STORAGE_PREFERENCE(a),{view:m,sortBy:h,sortByOrder:v}=(0,K.Bl)(null==(t=localStorage)?void 0:t.getItem(u))||Z,y=(0,C.BX)({projectRef:a,supabaseClient:c,resumableUploadUrl:l,serviceKey:s,uploadProgresses:[],abortApiCalls:()=>{o&&(o.abort(),o=new AbortController)},abortUploadCallbacks:{},abortUploads:e=>{y.abortUploadCallbacks[e].forEach(e=>e()),y.abortUploadCallbacks[e]=[]},columns:[],popColumn:()=>{y.abortApiCalls(),y.columns=y.columns.slice(0,y.getLatestColumnIndex())},popColumnAtIndex:e=>{y.columns=y.columns.slice(0,e+1)},pushColumnAtIndex:(e,t)=>{y.columns=y.columns.slice(0,t+1).concat([e])},openedFolders:[],pushOpenedFolderAtIndex:(e,t)=>{y.openedFolders=y.openedFolders.slice(0,t).concat(e)},popOpenedFolders:()=>{y.openedFolders=y.openedFolders.slice(0,y.openedFolders.length-1)},popOpenedFoldersAtIndex:e=>{y.openedFolders=y.openedFolders.slice(0,e+1)},clearOpenedFolders:()=>{y.openedFolders=[]},selectedItems:[],setSelectedItems:e=>y.selectedItems=e,clearSelectedItems:e=>{void 0!==e?y.selectedItems=y.selectedItems.filter(t=>t.columnIndex!==e):y.selectedItems=[]},selectedItemsToDelete:[],setSelectedItemsToDelete:e=>{y.selectedItemsToDelete=e},selectedItemsToMove:[],setSelectedItemsToMove:e=>{y.selectedItemsToMove=e},selectedBucket:{},setSelectedBucket:e=>{y.selectedBucket=e,y.setSelectedFilePreview(void 0),y.clearOpenedFolders(),y.clearSelectedItems()},setSelectedItemToRename:e=>{y.updateRowStatus({name:e.name,status:D.U1.EDITING,columnIndex:e.columnIndex})},view:m,setView:e=>{y.view=e,y.updateExplorerPreference()},sortBy:h,setSortBy:async e=>{y.sortBy=e,y.updateExplorerPreference(),y.setSelectedFilePreview(void 0),await y.refetchAllOpenedFolders()},sortByOrder:v,setSortByOrder:async e=>{y.sortByOrder=e,y.updateExplorerPreference(),y.setSelectedFilePreview(void 0),await y.refetchAllOpenedFolders()},isSearching:!1,setIsSearching:e=>y.isSearching=e,selectedFilePreview:void 0,setSelectedFilePreview:e=>y.selectedFilePreview=e,selectedFileCustomExpiry:void 0,setSelectedFileCustomExpiry:e=>y.selectedFileCustomExpiry=e,updateExplorerPreference:()=>{let e=F.rS.STORAGE_PREFERENCE(a),{view:t,sortBy:o,sortByOrder:n}=y;localStorage.setItem(e,JSON.stringify({view:t,sortBy:o,sortByOrder:n}))},getLatestColumnIndex:()=>y.columns.length-1,setColumnIsLoadingMore:function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];y.columns=y.columns.map((a,o)=>o===e?{...a,isLoadingMoreItems:t}:a)},openBucket:async e=>{let{id:t,name:a}=e;y.setSelectedBucket(e),await y.fetchFolderContents({bucketId:e.id,folderId:t,folderName:a,index:-1})},getPathAlongOpenedFolders:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e?y.openedFolders.length>0?"".concat(y.selectedBucket.name,"/").concat(y.openedFolders.map(e=>e.name).join("/")):y.selectedBucket.name:y.openedFolders.map(e=>e.name).join("/")},getPathAlongFoldersToIndex:e=>y.openedFolders.slice(0,e).map(e=>e.name).join("/"),addNewFolderPlaceholder:e=>{let t=D.Vl.FOLDER,a=-1===e?y.getLatestColumnIndex():e;y.addTempRow({type:t,name:"Untitled folder",status:D.U1.EDITING,columnIndex:a,metadata:null,isPrepend:!0})},addNewFolder:async(e,t)=>{if(!y.supabaseClient)return console.error("Supabase Client is missing");let a=y.sanitizeNameForDuplicateInColumn({name:e,autofix:!1,columnIndex:t});if(null===a)return;if(!/^[a-zA-Z0-9_-\s]*$/.test(a))return T.oR.error("Folder name contains invalid special characters");if(0===a.length)return y.removeTempRows(t);y.updateFolderAfterEdit({folderName:a,columnIndex:t});let o="".concat(a,"/").concat(B.ok),n=y.openedFolders.slice(0,t).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(o):o;await y.supabaseClient.storage.from(y.selectedBucket.name).upload(l,new File([],B.ok)),n.length>0&&await _({projectRef:y.projectRef,bucketId:y.selectedBucket.id,paths:["".concat(n,"/").concat(B.ok)]})},fetchFolderContents:async e=>{let{bucketId:t,folderId:a,folderName:n,index:l,searchString:r}=e;y.abortApiCalls(),y.updateRowStatus({name:n,status:D.U1.LOADING,columnIndex:l}),y.pushColumnAtIndex({id:a,name:n,status:D.U1.LOADING,items:[]},l);let s=y.openedFolders.slice(0,l+1).map(e=>e.name).join("/"),i={limit:200,offset:0,search:r,sortBy:{column:y.sortBy,order:y.sortByOrder}};try{let e=await z({bucketId:t,projectRef:y.projectRef,path:s,options:i},null==o?void 0:o.signal);y.updateRowStatus({name:n,status:D.U1.READY,columnIndex:l});let r=(0,B.iN)(e,s);y.pushColumnAtIndex({id:a||n,name:n,status:D.U1.READY,items:r,hasMoreItems:200===r.length,isLoadingMoreItems:!1},l)}catch(e){"AbortError"===e.name?y.updateRowStatus({name:n,status:D.U1.READY,columnIndex:l}):T.oR.error('Failed to retrieve folder contents from "'.concat(n,'": ').concat(e.message))}},fetchMoreFolderContents:async e=>{let{index:t,column:a,searchString:n=""}=e;y.setColumnIsLoadingMore(t);let l=y.openedFolders.map(e=>e.name).join("/"),r={limit:200,offset:a.items.length,search:n,sortBy:{column:y.sortBy,order:y.sortByOrder}};try{let e=await z({projectRef:y.projectRef,bucketId:y.selectedBucket.id,path:l,options:r},null==o?void 0:o.signal),a=(0,B.iN)(e,l);y.columns=y.columns.map((o,n)=>n===t?{...o,items:o.items.concat(a),isLoadingMoreItems:!1,hasMoreItems:200===e.length}:o)}catch(e){e.message.includes("aborted")||T.oR.error("Failed to retrieve more folder contents: ".concat(e.message))}},refetchAllOpenedFolders:async()=>{let e=y.openedFolders.map(e=>e.name);await y.fetchFoldersByPath({paths:e})},fetchFoldersByPath:async e=>{let{paths:t,searchString:a="",showLoading:o=!1}=e;if(void 0===y.selectedBucket.id)return;let n=[""].concat(t);o&&(y.columns=[y.selectedBucket.name].concat(t).map(e=>({id:e,name:e,status:D.U1.LOADING,items:[]})));let l=(await Promise.all(n.map(async(e,o)=>{let n=t.slice(0,o).join("/"),l={limit:200,offset:0,search:a,sortBy:{column:y.sortBy,order:y.sortByOrder}};try{return await z({projectRef:y.projectRef,bucketId:y.selectedBucket.id,path:n,options:l})}catch(e){return T.oR.error("Failed to fetch folders: ".concat(e.message)),[]}}))).map((e,a)=>{let o=t.slice(0,a).join("/"),l=(0,B.iN)(e,o);return{id:null,status:D.U1.READY,name:0===a?y.selectedBucket.name:n[a],items:l,hasMoreItems:200===l.length,isLoadingMoreItems:!1}});y.columns=l,y.openedFolders=t.map((e,t)=>{let a=p()(l[t].items,{name:e});return a||{id:null,name:e,type:D.Vl.FOLDER,status:D.U1.READY,metadata:null,isCorrupted:!1,created_at:null,updated_at:null,last_accessed_at:null}})},validateParentFolderEmpty:async e=>{try{let a=await z({projectRef:y.projectRef,bucketId:y.selectedBucket.id,path:e,options:{limit:200,offset:0,sortBy:{column:y.sortBy,order:y.sortByOrder}}});if(0===a.length){var t;let a="".concat(e,"/").concat(B.ok);await (null==(t=y.supabaseClient)?void 0:t.storage.from(y.selectedBucket.name).upload(a,new File([],B.ok)))}}catch(e){}},deleteFolder:async e=>{try{let t=await y.getAllItemsAlongFolder(e);if(await y.deleteFiles({files:t,isDeleteFolder:!0}),y.popColumnAtIndex(e.columnIndex),y.popOpenedFoldersAtIndex(e.columnIndex-1),e.columnIndex>0){let t=y.openedFolders.slice(0,e.columnIndex).map(e=>e.name).join("/");t.length>0&&await y.validateParentFolderEmpty(t)}await y.refetchAllOpenedFolders(),y.setSelectedItemsToDelete([]),T.oR.success("Successfully deleted ".concat(e.name))}catch(e){T.oR.error("Failed to delete folder: ".concat(e.message))}},renameFolder:async(e,t,a)=>{let o=e.name;if(o===t)return y.updateRowStatus({name:o,status:D.U1.READY,columnIndex:a});let l=(0,T.oR)((0,n.jsx)(W.t,{progress:0,message:"Renaming folder to ".concat(t)}),{closeButton:!1,position:"top-right"});try{if(t.includes("/")||t.includes("\\"))return T.oR.error("Folder name cannot contain forward or back slashes.");y.updateRowStatus({name:o,status:D.U1.LOADING,columnIndex:a,updatedName:t});let r=await y.getAllItemsAlongFolder(e),s=0,c=!1,d=r.map(e=>{let o="".concat(e.prefix,"/").concat(e.name),n=o.split("/"),l=n.slice(0,a).concat(t).concat(n.slice(a+1)).join("/");return()=>new Promise(async e=>{s+=1/r.length;try{await G({projectRef:y.projectRef,bucketId:y.selectedBucket.id,from:o,to:l})}catch(e){c=!0,T.oR.error("Failed to move ".concat(o," to the new folder"))}e()})}),u=i()(d,2);await u.reduce(async(e,a)=>{await e,await Promise.all(a.map(e=>e())),(0,T.oR)((0,n.jsx)(W.t,{progress:100*s,message:"Renaming folder to ".concat(t)}),{id:l,closeButton:!1,position:"top-right"})},Promise.resolve()),c?T.oR.error("Renamed folder to ".concat(t," with some errors"),{id:l,closeButton:!0,duration:H.j}):T.oR.success("Successfully renamed folder to ".concat(t),{id:l,closeButton:!0,duration:H.j}),y.openedFolders[a].name===e.name&&(y.setSelectedFilePreview(void 0),y.popOpenedFoldersAtIndex(a-1)),await y.refetchAllOpenedFolders()}catch(e){T.oR.error("Failed to rename folder to ".concat(t,": ").concat(e.message),{id:l,closeButton:!0,duration:H.j})}},updateFolderAfterEdit:e=>{let{folderName:t,columnIndex:a,status:o=D.U1.READY}=e,n=void 0!==a?a:y.getLatestColumnIndex(),l=y.columns.map((e,a)=>{if(a===n){let a=e.items.map(e=>{if(e.status===D.U1.EDITING){let a=new Date().toISOString();return{...e,status:o,name:t,createdAt:a,lastAccessedAt:a,updatedAt:a,metadata:null,id:null}}return e});return{...e,items:a}}return e});y.columns=l},downloadFolder:async e=>{let t=0,a=T.oR.loading("Retrieving files from folder...");try{var o;let l=await y.getAllItemsAlongFolder(e);(0,T.oR)((0,n.jsx)(W.t,{progress:0,message:"Downloading ".concat(l.length," file").concat(l.length>1?"s":"","...")}),{id:a,closeButton:!1,position:"top-right"});let r=l.map(e=>{var a,o;let n=null!=(o=null==(a=e.metadata)?void 0:a.mimetype)?o:null;return()=>new Promise(async a=>{try{let o=await (0,q.c)({projectRef:y.projectRef,bucketId:y.selectedBucket.id,path:"".concat(e.prefix,"/").concat(e.name)});t+=1/l.length;let r=await o.blob();a({name:e.name,prefix:e.prefix,blob:new Blob([r],{type:n})})}catch(t){console.error("Failed to download file","".concat(e.prefix,"/").concat(e.name)),a(!1)}})}),s=i()(r,10),c=await s.reduce(async(e,o)=>{let r=await e,s=await Promise.allSettled(o.map(e=>e()));return(0,T.oR)((0,n.jsx)(W.t,{progress:100*t,message:"Downloading ".concat(l.length," file").concat(l.length>1?"s":"","...")}),{id:a,closeButton:!1,position:"top-right"}),r.concat(s.map(e=>e.value).filter(Boolean))},Promise.resolve([])),d=new P.D7("application/zip"),u=new P.Vx(d,{bufferedWrite:!0});0===c.length&&T.oR.error('Failed to download files from "'.concat(e.name,'"'),{id:a,closeButton:!0,duration:H.j}),c.forEach(e=>{e.blob&&u.add("".concat(e.prefix,"/").concat(e.name),new P.nZ(e.blob))});let p=URL.createObjectURL(await u.close()),m=document.createElement("a");m.href=p,m.setAttribute("download","".concat(e.name,".zip")),document.body.appendChild(m),m.click(),null==(o=m.parentNode)||o.removeChild(m),T.oR.success(c.length===l.length?'Successfully downloaded folder "'.concat(e.name,'"'):'Downloaded folder "'.concat(e.name,'". However, ').concat(l.length-c.length," files did not download successfully."),{id:a,closeButton:!0,duration:H.j})}catch(e){T.oR.error("Failed to download folder: ".concat(e.message),{id:a,closeButton:!0,duration:H.j})}},getAllItemsAlongFolder:async e=>{var t,a;let o=[],n=!1,l="",{name:r,columnIndex:s,prefix:i}=e;if(void 0===i){let e=y.openedFolders.slice(0,s).map(e=>e.name).join("/");l=e.length>0?"".concat(e,"/").concat(r):r}else l="".concat(i,"/").concat(r);let c={limit:1e4,offset:0,sortBy:{column:y.sortBy,order:y.sortByOrder}},d=[];for(;;)try{let e=await z({projectRef:y.projectRef,bucketId:y.selectedBucket.id,path:l,options:c});if(d=d.concat(e),c.offset+=c.limit,(e||[]).length<c.limit)break}catch(e){n=!0;break}if(n)throw Error("Failed to retrieve all files within folder");let u=null!=(t=null==d?void 0:d.filter(e=>null===e.id))?t:[];return(null!=(a=null==d?void 0:d.filter(e=>null!==e.id))?a:[]).forEach(e=>o.push({...e,prefix:l})),(await Promise.all(u.map(e=>y.getAllItemsAlongFolder({...e,columnIndex:0,prefix:l})))).map(e=>{e.map(e=>o.push(e))}),o},uploadFiles:async e=>{var t,a,o,l;let{files:s,columnIndex:c,isDrop:d=!1}=e,u=null==(t=(0,M.S)().getQueryCache().find(N.n.storage(y.projectRef)))?void 0:t.state.data,p=null==u?void 0:u.fileSizeLimit,m=new Date,f=d?(await (0,B.Rd)(s)).filter(e=>!e.path.includes("#/")):Array.from(s),h=-1===c?y.getLatestColumnIndex():c,v=void 0!==p?f.filter(e=>e.size<=p):f;if(v.length<f.length){let e=f.length-v.length,{value:t,unit:a}=(0,k.Jb)(p);if(T.oR.error((0,n.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,n.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," beyond the global upload limit of"," ",t,a,"."]}),(0,n.jsxs)("p",{className:"text-foreground-light",children:["You can change the global file size upload limit in"," ",(0,n.jsx)(O.g,{href:"/project/".concat(y.projectRef,"/settings/storage"),children:"Storage settings"}),"."]})]}),{duration:8e3}),e===f.length)return}let b=v.filter(e=>e.size>0);if(b.length<v.length){let e=v.length-b.length;if(T.oR.error((0,n.jsx)("div",{className:"flex flex-col gap-y-1",children:(0,n.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," 0."]})})),e===v.length)return}let w=(null!=(l=null==(o=y.columns)||null==(a=o[h])?void 0:a.items)?l:[]).filter(e=>!e.id).map(e=>e.name),I=v.filter(e=>".DS_Store"!==e.name).map(e=>{if(!e.path)return e;let t=e.path.split("/"),a=t.length>1?t[0]:null;if(w.includes(a)){let o=y.sanitizeNameForDuplicateInColumn({name:a,autofix:!0,columnIndex:c});t[0]=o,e.path=t.join("/")}return e});y.uploadProgresses=Array(I.length).fill({percentage:0,elapsed:0,uploadSpeed:0,remainingBytes:0,remainingTime:0});let R=[],x=I.length,S=0,C=0,E=y.openedFolders.slice(0,h).map(e=>e.name).join("/"),j=y.onUploadProgress(),P=I.map((e,t)=>{var a,o,n;let l=e.name.split(".").pop(),s={mimetype:null!=(a=e.type||function(e){if(void 0!==e)return J[e.toLowerCase()]}(l))?a:"",size:e.size},i={cacheControl:"3600",contentType:s.mimetype},c=(null!=(o=null==e?void 0:e.path)?o:"").split("/").length>1,d=c?e.name:y.sanitizeNameForDuplicateInColumn({name:e.name,autofix:!0}),u=g()(e,["path"])&&c?e.path:d,p=(null!=u?u:"unknown").replaceAll(/\u{202F}/gu," "),m=E.length>0?"".concat(E,"/").concat(p):p;if(c){let t=(null==(n=e.path)?void 0:n.split("/")[0])||"";R.includes(t)||(y.addTempRow({type:D.Vl.FOLDER,name:t,status:D.U1.LOADING,columnIndex:h,metadata:s}),R.push(t))}else y.addTempRow({type:D.Vl.FILE,name:d,status:D.U1.LOADING,columnIndex:h,metadata:s});let f=0,v=y.selectedBucket.name;return()=>new Promise(async(a,o)=>{let n,l=e.size/1048576,c=Date.now();n=Math.min(n=l<30?6291456:l<100?Math.floor(e.size/8):l<500?Math.floor(e.size/10):l<1024?Math.floor(e.size/20):l<10240?Math.floor(e.size/30):Math.floor(e.size/50),524288e3);let d=e.size<=n,u=new A._O(e,{endpoint:y.resumableUploadUrl,retryDelays:[0,200,500,1500,3e3,5e3],headers:{authorization:"Bearer ".concat(y.serviceKey),"x-source":"supabase-dashboard"},uploadDataDuringCreation:d,removeFingerprintOnSuccess:!0,metadata:{bucketName:v,objectName:m,...i},chunkSize:n,onShouldRetry:e=>![400,403,404,409,413,415,429].includes(e.originalResponse?e.originalResponse.getStatus():0),onError:t=>{if(C+=1,t instanceof A.nj){var a,n,l;let o=null==(a=t.originalResponse)?void 0:a.getStatus();415===o?T.oR.error(r()((null==t||null==(n=t.originalResponse)?void 0:n.getBody())||"Failed to upload ".concat(e.name,": ").concat(s.mimetype," is not allowed")),{description:"Allowed MIME types: ".concat(null==(l=y.selectedBucket.allowed_mime_types)?void 0:l.join(", "))}):413===o&&T.oR.error("Failed to upload ".concat(e.name,": File size exceeds the bucket upload limit."))}else T.oR.error("Failed to upload ".concat(e.name,": ").concat(t.message));o(t)},onProgress:(e,a)=>{0===f&&e>n&&(f=e);let o=e-f,l=(Date.now()-c)/1e3,r=o/l,s=a-o;y.uploadProgresses[t]={percentage:0===a?0:e/a,elapsed:l,uploadSpeed:r,remainingBytes:s,remainingTime:s/r},y.onUploadProgress(j)},onSuccess(){S+=1,a()}});return Array.isArray(y.abortUploadCallbacks[j])||(y.abortUploadCallbacks[j]=[]),y.abortUploadCallbacks[j].push(()=>{try{u.abort(!0)}catch(e){}o(Error("Upload aborted by user"))}),u.findPreviousUploads().then(e=>{e.length&&u.resumeFromPreviousUpload(e[0]),u.start()})})}),F=i()(P,10);try{await F.reduce(async(e,t)=>{await e,await Promise.allSettled(t.map(e=>e())),y.onUploadProgress(j)},Promise.resolve()),S>0&&await _({projectRef:y.projectRef,bucketId:y.selectedBucket.id,paths:["".concat(E,"/").concat(B.ok)]}),await y.refetchAllOpenedFolders(),0===x||0===S&&0===C?T.oR.dismiss(j):C===x?T.oR.error("Failed to upload ".concat(x," file").concat(x>1?"s":"","!"),{id:j,closeButton:!0,duration:H.j}):S===x?T.oR.success("Successfully uploaded ".concat(x," file").concat(x>1?"s":"","!"),{id:j,closeButton:!0,duration:H.j}):T.oR.success("Successfully uploaded ".concat(S," out of ").concat(x," file").concat(x>1?"s":"","!"),{id:j,closeButton:!0,duration:H.j})}catch(e){T.oR.error("Failed to upload files",{id:j,closeButton:!0,duration:H.j})}let U=new Date;console.log("Total time taken for ".concat(I.length," files: ").concat((U-m)/1e3," seconds"))},moveFiles:async e=>{let t=d()(e.split("/")).join("/"),a=0;y.clearSelectedItems();let o=(0,T.oR)("Moving ".concat(y.selectedItemsToMove.length," file").concat(y.selectedItemsToMove.length>1?"s":"","..."),{description:"Do not close the browser until it's completed",duration:1/0});await Promise.all(y.selectedItemsToMove.map(async o=>{let n=y.openedFolders.slice(0,o.columnIndex).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(o.name):o.name,r=e.length>0?"".concat(t,"/").concat(o.name):o.name;try{await G({projectRef:y.projectRef,bucketId:y.selectedBucket.id,from:l,to:r})}catch(e){a+=1,T.oR.error(e.message)}})),a===y.selectedItemsToMove.length?T.oR.error("Failed to move files"):(0,T.oR)("Successfully moved ".concat(y.selectedItemsToMove.length-a," files to ").concat(t.length>0?t:"the root of your bucket")),T.oR.dismiss(o),await y.refetchAllOpenedFolders(),y.setSelectedItemsToMove([])},deleteFiles:async e=>{let{files:t,isDeleteFolder:a=!1}=e;y.setSelectedFilePreview(void 0);let o=0,l=t.some(e=>e.prefix)?t.map(e=>"".concat(e.prefix,"/").concat(e.name)):t.map(e=>{let{name:t,columnIndex:a}=e,o=y.openedFolders.slice(0,a).map(e=>e.name).join("/");return y.updateRowStatus({name:t,status:D.U1.LOADING,columnIndex:a}),o.length>0?"".concat(o,"/").concat(t):t});y.clearSelectedItems();let r=(0,T.oR)((0,n.jsx)(W.t,{progress:0,message:"Deleting ".concat(l.length," file(s)...")}),{closeButton:!1,position:"top-right"}),s=i()(l,2).map(e=>()=>(o+=e.length/l.length,_({projectRef:y.projectRef,bucketId:y.selectedBucket.id,paths:e})));if(await i()(s,2).reduce(async(e,t)=>{await e,await Promise.all(t.map(e=>e())),(0,T.oR)((0,n.jsx)(W.t,{progress:100*o,message:"Deleting ".concat(l.length," file(s)...")}),{id:r,closeButton:!1,position:"top-right"})},Promise.resolve()),a)T.oR.dismiss(r);else{let e=w()(l.map(e=>{let t=e.split("/");return t.slice(0,t.length-1).join("/")}));await Promise.all(e.map(e=>y.validateParentFolderEmpty(e))),T.oR.success("Successfully deleted ".concat(l.length," file(s)"),{id:r,closeButton:!0,duration:H.j,description:void 0}),await y.refetchAllOpenedFolders(),y.setSelectedItemsToDelete([])}},downloadSelectedFiles:async e=>{var t;let a=Math.min(...e.map(e=>e.columnIndex)),o=e.map(e=>{let{name:t,columnIndex:o}=e,n=y.openedFolders.slice(a,o).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(t):t;return{...e,formattedPathToFile:l}}),l=0,r=T.oR.loading("Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")),s=o.map(e=>()=>new Promise(async t=>{let a=await (0,B.PE)({projectRef:y.projectRef,bucketId:y.selectedBucket.id,file:e,returnBlob:!0});l+=1/o.length,b()(a)&&t({...a,name:e.formattedPathToFile}),t(!1)})),c=i()(s,10),d=await c.reduce(async(t,a)=>{let o=await t,s=await Promise.allSettled(a.map(e=>e()));return(0,T.oR)((0,n.jsx)(W.t,{progress:100*l,message:"Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")}),{id:r,closeButton:!1,position:"top-right"}),o.concat(s.map(e=>e.value).filter(Boolean))},Promise.resolve([])),u=new P.D7("application/zip"),p=new P.Vx(u,{bufferedWrite:!0});d.forEach(e=>{p.add(e.name,new P.nZ(e.blob))});let m=URL.createObjectURL(await p.close()),f=document.createElement("a");f.href=m,f.setAttribute("download","supabase-files.zip"),document.body.appendChild(f),f.click(),null==(t=f.parentNode)||t.removeChild(f),T.oR.success("Successfully downloaded ".concat(d.length," files"),{id:r,closeButton:!0,duration:H.j})},renameFile:async(e,t,a)=>{let o=e.name;if(o===t||0===t.length)y.updateRowStatus({name:o,status:D.U1.READY,columnIndex:a});else{y.updateRowStatus({name:o,status:D.U1.LOADING,columnIndex:a,updatedName:t});let l=y.getPathAlongFoldersToIndex(a),r=l.length>0?"".concat(l,"/").concat(o):o,s=l.length>0?"".concat(l,"/").concat(t):t;try{var n;if(await G({projectRef:y.projectRef,bucketId:y.selectedBucket.id,from:r,to:s}),T.oR.success('Successfully renamed "'.concat(o,'" to "').concat(t,'"')),(null==(n=y.selectedFilePreview)?void 0:n.name)===o){let{previewUrl:a,...o}=e;y.setSelectedFilePreview({...o,name:t})}await y.refetchAllOpenedFolders()}catch(e){T.oR.error("Failed to rename file: ".concat(e.message)),y.updateRowStatus({name:o,status:D.U1.READY,columnIndex:a})}}},selectRangeItems:(e,t)=>{let a=y.columns[e].items,o=a[t],n=y.selectedItems.map(e=>e.id),l=n[n.length-1],r=f()(a,{id:l}),s=Math.min(t,r),i=Math.max(t,r),c=a.slice(s,i+1).map(t=>({...t,columnIndex:e}));if(t<r&&c.reverse(),n.includes(o.id)){let e=c.map(e=>e.id);y.setSelectedItems(y.selectedItems.filter(t=>t.id===o.id||!e.includes(t.id)))}else y.setSelectedItems(R()(y.selectedItems.concat(c),"id"))},sanitizeNameForDuplicateInColumn:e=>{let{name:t,columnIndex:a,autofix:o=!1}=e,n=void 0!==a?a:y.getLatestColumnIndex(),l=y.columns[n].items.filter(e=>e.status!==D.U1.EDITING);if(l.filter(e=>e.name===t).length>0)if(!o)return T.oR.error("The name ".concat(t," already exists in the current directory. Please use a different name.")),null;else{let[e,a]=t.split("."),o=new RegExp("".concat(e," \\([-0-9]+\\)").concat(a?"."+a:"","$")),n=l.filter(e=>e.name.match(o)),r=e+" (".concat(n.length+1,")");return a?"".concat(r,".").concat(a):r}return t},addTempRow:e=>{let{type:t,name:a,status:o,columnIndex:n,metadata:l,isPrepend:r=!1}=e,s=y.columns.map((e,s)=>{if(s===n){let n={type:t,name:a,status:o,metadata:l},s=r?[n].concat(e.items):e.items.concat([n]);return{...e,items:s}}return e});y.columns=s},removeTempRows:e=>{let t=y.columns.map((t,a)=>{if(a===e){let e=t.items.filter(e=>g()(e,"id"));return{...t,items:e}}return t});y.columns=t},onUploadProgress:e=>{let t=y.uploadProgresses.length,a=y.uploadProgresses.reduce((e,t)=>{let{percentage:a}=t;return e+a},0)/t*100,o=(0,B.Uh)(y.uploadProgresses);return(0,T.oR)((0,n.jsx)(W.t,{progress:a,message:"Uploading ".concat(t," file").concat(t>1?"s":"","..."),progressPrefix:"".concat(o&&!isNaN(o)&&isFinite(o)&&0!==o?"".concat((0,B.fU)(o)," remaining â€“ "):""),action:e&&(0,n.jsx)(X.$,{size:"tiny",type:"default",className:"ml-6",onClick:()=>y.abortUploads(e),children:"Cancel"})}),{id:e,closeButton:!1,position:"top-right"})},updateRowStatus:e=>{let{name:t,status:a,columnIndex:o,updatedName:n}=e,l=void 0!==o?o:y.getLatestColumnIndex(),r=y.columns.map((e,o)=>{if(o===l){let o=e.items.map(e=>e.name===t?{...e,status:a,...n&&{name:n}}:e);return{...e,items:o}}return e});y.columns=r}});return y}o=new AbortController;let Q={projectRef:"",resumableUploadUrl:"",serviceKey:"",supabaseClient:void 0},ee=(0,x.createContext)($(Q)),et=e=>{var t,a,o;let{children:l}=e,r=(0,Y.KT)(),s=(null==r?void 0:r.status)===V.BU.INACTIVE,[i,c]=(0,x.useState)(()=>$(Q)),d=(0,S.A)(i),{data:u}=(0,U.Gm)({projectRef:null==r?void 0:r.ref}),{serviceKey:p}=(0,U.d6)(u),m=null!=(o=null==u||null==(t=u.app_config)?void 0:t.protocol)?o:"https",f=null==u||null==(a=u.app_config)?void 0:a.endpoint,h="".concat(V.pe?"https":m,"://").concat(f,"/storage/v1/upload/resumable");return(0,x.useEffect)(()=>{let e=(0,C.P9)(d.current),t=!!(null==r?void 0:r.ref),a=e.projectRef!==(null==r?void 0:r.ref);if(!s&&t&&a&&p){var o;let e="".concat(V.pe?"https":m,"://").concat(f),t=(0,j.UU)(e,p.api_key,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storage:{getItem:e=>null,setItem:(e,t)=>{},removeItem:e=>{}}}});c($({projectRef:null!=(o=null==r?void 0:r.ref)?o:"",supabaseClient:t,resumableUploadUrl:h,serviceKey:p.api_key}))}},[null==r?void 0:r.ref,d,p,s]),(0,n.jsx)(ee.Provider,{value:i,"data-sentry-element":"unknown","data-sentry-component":"StorageExplorerStateContextProvider","data-sentry-source-file":"storage-explorer.tsx",children:l})};function ea(e){let t=(0,x.useContext)(ee);return(0,E.s)(t,e)}},51626:(e,t,a)=>{a.d(t,{RE:()=>u,UZ:()=>d});var o=a(80263),n=a(53239),l=a(56028),r=a(12532),s=a(19898);function i(){let e=(0,l.BX)({selectedDatabaseId:void 0,setSelectedDatabaseId:t=>{e.selectedDatabaseId=t}});return e}let c=(0,n.createContext)(i()),d=e=>{let{children:t}=e,a=(0,s.MF)(i);return(0,o.jsx)(c.Provider,{value:a,"data-sentry-element":"unknown","data-sentry-component":"DatabaseSelectorStateContextProvider","data-sentry-source-file":"database-selector.tsx",children:t})};function u(e){let t=(0,n.useContext)(c);return(0,r.s)(t,e)}},56163:(e,t,a)=>{a.d(t,{YD:()=>v,lW:()=>y,qm:()=>u,zv:()=>b});var o=a(80263),n=a(19898),l=a(68875),r=a(53667),s=a.n(r),i=a(53239),c=a(56028),d=a(12532);let u={table:["r","v","m","f","p"],sql:["sql"]},p=e=>"".concat("supabase_recent_items","_").concat(e),m={activeTab:null,openTabs:[],tabsMap:{},previewTabId:void 0},f=e=>"".concat("supabase_studio_tabs","_").concat(e);function h(e){let t=function(e){if(!e)return[];let t=localStorage.getItem(p(e));try{return JSON.parse(null!=t?t:'{"items": []}').items}catch(e){return[]}}(e),{openTabs:a,activeTab:o,tabsMap:n,previewTabId:l}=function(e){if(!e)return m;let t=localStorage.getItem(f(e));if(!t)return m;try{let e=JSON.parse(null!=t?t:JSON.stringify(m));if(!e.openTabs||!Array.isArray(e.openTabs)||!e.tabsMap||"object"!=typeof e.tabsMap)return m;return e}catch(e){return m}}(e),r=(0,c.BX)({recentItems:t,addRecentItem:e=>{let t=r.recentItems.find(t=>t.id===e.id);if(t){t.timestamp=Date.now();return}let a={id:e.id,type:e.type,label:e.label||"Untitled",timestamp:Date.now(),metadata:e.metadata};r.recentItems.unshift(a);let[o,n]=s()(r.recentItems,e=>{if(u.table.includes(e.type))return e});r.recentItems=[...o.slice(0,8),...n]},clearRecentItems:()=>{r.recentItems=[]},removeRecentItem:e=>{r.recentItems=r.recentItems.filter(t=>t.id!==e)},removeRecentItems:e=>{r.recentItems=r.recentItems.filter(t=>!e.includes(t.id))},removeRecentItemsByType:e=>{r.recentItems=r.recentItems.filter(t=>t.type!==e)},getRecentItemsByType:e=>r.recentItems.filter(t=>t.type===e),activeTab:o,openTabs:a,tabsMap:n,previewTabId:l,addTab:e=>{if(!r.tabsMap[e.id]||r.activeTab!==e.id){if(r.tabsMap[e.id]){r.activeTab=e.id,e.isPreview||r.addRecentItem(e);return}if(!1===e.isPreview){r.openTabs=[...r.openTabs,e.id],r.tabsMap[e.id]=e,r.activeTab=e.id,r.addRecentItem(e);return}r.previewTabId&&(r.openTabs=r.openTabs.filter(e=>e!==r.previewTabId),delete r.tabsMap[r.previewTabId]),r.tabsMap[e.id]={...e,isPreview:!0},r.openTabs=[...r.openTabs,e.id],r.previewTabId=e.id,r.activeTab=e.id}},updateTab:(e,t)=>{r.tabsMap[e]&&("label"in t&&(r.tabsMap[e].label=t.label),"scrollTop"in t&&r.tabsMap[e].metadata&&(r.tabsMap[e].metadata.scrollTop=t.scrollTop))},removeTab:e=>{let t=r.openTabs.indexOf(e);r.openTabs=r.openTabs.filter(t=>t!==e),delete r.tabsMap[e],e===r.activeTab&&(r.activeTab=r.openTabs[t-1]||r.openTabs[t+1]||null)},removeTabs:e=>{e.length&&e.forEach(e=>r.removeTab(e))},reorderTabs:(e,t)=>{let a=[...r.openTabs],[o]=a.splice(e,1);a.splice(t,0,o),r.openTabs=a},makeTabActive:e=>{let t=r.tabsMap[e];t&&(r.activeTab=t.id)},makeTabPermanent:e=>{let t=r.tabsMap[e];(null==t?void 0:t.isPreview)&&(t.isPreview=!1,r.previewTabId=void 0,r.addRecentItem(t))},makeActiveTabPermanent:()=>{var e;return!!r.activeTab&&null!=(e=r.tabsMap[r.activeTab])&&!!e.isPreview&&(r.makeTabPermanent(r.activeTab),!0)},handleTabNavigation:(e,t)=>{var a,o,n;let l=r.tabsMap[e];if(l)switch(r.activeTab=e,!l.isPreview&&r.addRecentItem(l),l.type){case"sql":let s=t.query.schema||"public";t.push("/project/".concat(t.query.ref,"/sql/").concat(null==(a=l.metadata)?void 0:a.sqlId,"?schema=").concat(s));break;case"r":case"v":case"m":case"f":case"p":t.push("/project/".concat(t.query.ref,"/editor/").concat(null==(o=l.metadata)?void 0:o.tableId,"?schema=").concat(null==(n=l.metadata)?void 0:n.schema))}},handleTabClose:e=>{var t;let{id:a,router:o,editor:n,onClose:l,onClearDashboardHistory:s}=e,i=r.tabsMap[a],c=Object.values(r.tabsMap).filter(e=>e.id!==a),d=n?null==(t=c.filter(e=>{var t;return null==(t=u[n])?void 0:t.includes(e.type)})[0])?void 0:t.id:void 0,{[a]:p,...m}=r.tabsMap;if(r.tabsMap=m,i){let e=[...r.openTabs].filter(e=>e!==a);r.openTabs=e}if(r.previewTabId===a&&(r.previewTabId=void 0),r.activeTab===a||"new"===a)if(d)r.activeTab=d,r.handleTabNavigation(d,o);else switch(s(),null==i?void 0:i.type){case"sql":o.push("/project/".concat(o.query.ref,"/sql"));break;case"r":case"v":case"m":case"f":case"p":o.push("/project/".concat(o.query.ref,"/editor"));break;default:o.push("/project/".concat(o.query.ref,"/").concat(n))}null==l||l(a)},handleTabCloseAll:e=>{let{editor:t,router:a,onClearDashboardHistory:o}=e,n="table"===t?r.openTabs.filter(e=>!e.startsWith("sql")):r.openTabs.filter(e=>e.startsWith("sql"));r.removeTabs(n),o(),a.push("/project/".concat(a.query.ref,"/").concat("table"===t?"editor":"sql"))},handleTabDragEnd:(e,t,a,o)=>{let n=r.tabsMap[a];(null==n?void 0:n.isPreview)&&r.makeTabPermanent(a);let l=[...r.openTabs];l.splice(e,1),l.splice(t,0,a),r.openTabs=l,r.activeTab=a,r.handleTabNavigation(a,o)}});return r}let g=(0,i.createContext)(h("")),v=e=>{let{children:t}=e,a=(0,l.KT)(),r=(0,n.MF)(()=>{var e;return h(null!=(e=null==a?void 0:a.ref)?e:"")});return(0,i.useEffect)(()=>{if(null==a?void 0:a.ref)return(0,c.B1)(r,()=>{localStorage.setItem(f(null==a?void 0:a.ref),JSON.stringify({activeTab:r.activeTab,openTabs:r.openTabs,tabsMap:r.tabsMap,previewTabId:r.previewTabId})),localStorage.setItem(p(null==a?void 0:a.ref),JSON.stringify({items:r.recentItems}))})},[]),(0,o.jsx)(g.Provider,{value:r,"data-sentry-element":"unknown","data-sentry-component":"TabsStateContextProvider","data-sentry-source-file":"tabs.tsx",children:t})},b=e=>{let t=(0,i.useContext)(g);return(0,d.s)(t,e)};function y(e,t){switch(e){case"r":return"r-".concat(t.id);case"v":return"v-".concat(t.id);case"m":return"m-".concat(t.id);case"f":return"f-".concat(t.id);case"p":return"p-".concat(t.id);case"sql":return"sql-".concat(t.id);default:return""}}},64588:(e,t,a)=>{a.d(t,{c:()=>l}),a(73969);var o=a(40807),n=a(64036);let l=async(e,t)=>{let{projectRef:a,bucketId:l,path:r,options:s}=e;if(!l)throw Error("bucketId is required");let i=await (0,o.tQ)("".concat(n.H$).concat(n.pe?"":"/platform","/storage/").concat(a,"/buckets/").concat(l,"/objects/download"),{path:r,options:s,abortSignal:t});if(i.error)throw i.error;return i}},73535:(e,t,a)=>{a.d(t,{t:()=>c});var o=a(80263),n=a(8945),l=a(47941),r=a(53239),s=a(51859);let i=r.forwardRef((e,t)=>{let{className:a,value:n,...r}=e;return(0,o.jsx)(l.bL,{ref:t,className:(0,s.cn)("relative h-1 w-full overflow-hidden rounded-full bg-surface-300",a),...r,children:(0,o.jsx)(l.C1,{className:"h-full w-full flex-1 bg-foreground transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});i.displayName=l.bL.displayName;let c=e=>{let{progress:t,progressPrefix:a,action:l,message:r}=e;return(0,o.jsxs)("div",{className:"flex gap-3 w-full","data-sentry-component":"SonnerProgress","data-sentry-source-file":"sonner-progress.tsx",children:[(0,o.jsx)(n.A,{className:"animate-spin text-foreground-muted mt-0.5",size:16,"data-sentry-element":"Loader2","data-sentry-source-file":"sonner-progress.tsx"}),(0,o.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,o.jsxs)("div",{className:"flex w-full justify-between",children:[(0,o.jsx)("p",{className:"text-foreground text-sm",children:r}),(0,o.jsxs)("p",{className:"text-foreground-light text-sm font-mono",children:[a||"","".concat(Number(t).toFixed(0),"%")]})]}),(0,o.jsx)(i,{value:t,className:"w-full","data-sentry-element":"Progress","data-sentry-source-file":"sonner-progress.tsx"}),(0,o.jsxs)("div",{className:"flex flex-row gap-2 items-center justify-between",children:[(0,o.jsx)("small",{className:"text-foreground-lighter text-xs",children:"Please do not close the browser"}),l]})]})]})}},77952:(e,t,a)=>{a.d(t,{E:()=>o,s:()=>n});let o=0xc80000000;var n=function(e){return e.BYTES="bytes",e.KB="KB",e.MB="MB",e.GB="GB",e}({})},81018:(e,t,a)=>{a.d(t,{JB:()=>n,Jn:()=>d,NA:()=>l,U1:()=>i,Uw:()=>c,Vl:()=>s,Vm:()=>o,ou:()=>r});var o=function(e){return e[e.WEEK=604800]="WEEK",e[e.MONTH=2592e3]="MONTH",e[e.YEAR=31536e3]="YEAR",e}({}),n=function(e){return e.COLUMNS="COLUMNS",e.LIST="LIST",e}({}),l=function(e){return e.NAME="name",e.UPDATED_AT="updated_at",e.CREATED_AT="created_at",e.LAST_ACCESSED_AT="last_accessed_at",e}({}),r=function(e){return e.ASC="asc",e.DESC="desc",e}({}),s=function(e){return e.BUCKET="BUCKET",e.FILE="FILE",e.FOLDER="FOLDER",e}({}),i=function(e){return e.READY="READY",e.LOADING="LOADING",e.EDITING="EDITING",e}({});let c={upload:["INSERT"],download:["SELECT"],list:["SELECT"],update:["SELECT","UPDATE"],move:["SELECT","UPDATE"],copy:["SELECT","INSERT"],remove:["SELECT","DELETE"],createSignedUrl:["SELECT"],createSignedUrls:["SELECT"],getPublicUrl:[]},d={STORAGE_COLUMN:"STORAGE_COLUMN",STORAGE_ITEM:"STORAGE_ITEM",STORAGE_FOLDER:"STORAGE_FOLDER"}},89634:(e,t,a)=>{a.d(t,{Co:()=>I,xd:()=>R});var o=a(80263),n=a(74557),l=a(77796),r=a.n(l),s=a(53239),i=a(56028),c=a(12532),d=a(19898),u=a(68875);let p={open:!1,initialInput:"",sqlSnippets:void 0,suggestions:void 0,tables:[],chats:{},activeChatId:void 0},m="assistantState";async function f(){return(0,n.P2)("ai-assistant-db",1,{upgrade(e){e.objectStoreNames.contains(m)||e.createObjectStore(m,{keyPath:"projectRef"})}})}async function h(e){if(e)try{let t=await f();return await t.get(m,e)}catch(e){console.error("Failed to get AI state from IndexedDB:",e);return}}async function g(e){if(e.projectRef)try{let t=await f();await t.put(m,e)}catch(e){console.error("Failed to save AI state to IndexedDB:",e)}}async function v(e){try{let t=await h(e);if(t)return Object.values(t.chats).forEach(e=>{e&&"object"==typeof e&&(e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt))}),t}catch(e){console.error("Error loading AI state from IndexedDB:",e)}return null}async function b(e){let t=localStorage.getItem(d.rS.AI_ASSISTANT_STATE(e));if(!t)return null;let a=null;try{let n=JSON.parse(t,(e,t)=>("createdAt"===e||"updatedAt"===e)&&t?new Date(t):t);if(n&&"object"==typeof n.chats){var o;a={projectRef:e,open:null!=(o=n.open)&&o,activeChatId:n.activeChatId,chats:n.chats}}else console.warn("Data in localStorage is not in the expected format, ignoring."),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e))}catch(t){console.error("Failed to parse state from localStorage:",t),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e))}if(a)try{return await g(a),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e)),a}catch(e){console.error("Failed to save migrated state to IndexedDB:",e)}return null}let y=()=>{let e={...p};{let t=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==t&&(e.open="true"===t)}let t=(0,i.BX)({...e,resetAiAssistantPanel:()=>{Object.assign(t,p)},openAssistant:()=>{t.open=!0},closeAssistant:()=>{t.open=!1},toggleAssistant:()=>{t.open=!t.open},get activeChat(){return t.activeChatId?t.chats[t.activeChatId]:void 0},newChat:e=>{var a,o,n,l,r,s;let i=crypto.randomUUID(),c={id:i,name:null!=(a=null==e?void 0:e.name)?a:"Untitled",messages:[],createdAt:new Date,updatedAt:new Date};return t.chats={...t.chats,[i]:c},t.activeChatId=i,t.open=null!=(o=null==e?void 0:e.open)?o:t.open,t.initialInput=null!=(n=null==e?void 0:e.initialInput)?n:p.initialInput,t.sqlSnippets=null!=(l=null==e?void 0:e.sqlSnippets)?l:p.sqlSnippets,t.suggestions=null!=(r=null==e?void 0:e.suggestions)?r:p.suggestions,t.tables=null!=(s=null==e?void 0:e.tables)?s:p.tables,i},selectChat:e=>{e!==t.activeChatId&&(t.activeChatId=e)},deleteChat:e=>{let{[e]:a,...o}=t.chats;if(t.chats=o,e===t.activeChatId){let e=Object.keys(o);t.activeChatId=e.length>0?e[0]:void 0}},renameChat:(e,a)=>{let o=t.chats[e];o&&o.name!==a&&(o.name=a,o.updatedAt=new Date)},clearMessages:()=>{let e=t.activeChat;e&&(e.messages=[],e.updatedAt=new Date,t.sqlSnippets=[],t.initialInput="")},saveMessage:e=>{let a=t.activeChat;if(!a)return;let o=a.messages,n=Array.isArray(e)?e.filter(e=>!o.some(t=>t.id===e.id)):o.some(t=>t.id===e.id)?[]:[e];n.length>0&&(a.messages.push(...n),a.updatedAt=new Date)},updateMessage:e=>{let{id:a,resultId:o,results:n}=e,l=t.activeChat;if(!l||!o)return;let r=l.messages.findIndex(e=>e.id===a);if(-1!==r){let e=l.messages[r];e.results||(e.results={}),e.results[o]=n}},setSqlSnippets:e=>{t.sqlSnippets=e},clearSqlSnippets:()=>{t.sqlSnippets=void 0,t.suggestions=void 0},getCachedSQLResults:e=>{var a;let{messageId:o,snippetId:n}=e,l=t.activeChat;if(!l||!n)return;let r=l.messages.find(e=>e.id===o);return(null!=(a=null==r?void 0:r.results)?a:{})[n]},loadPersistedState:e=>{t.open=e.open,t.chats=e.chats,t.activeChatId=e.activeChatId;{let e=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==e&&(t.open="true"===e)}if(!t.activeChat){let e=Object.keys(t.chats);e.length>0?t.activeChatId=e.sort((e,a)=>{var o,n;return((null==(o=t.chats[a].updatedAt)?void 0:o.getTime())||0)-((null==(n=t.chats[e].updatedAt)?void 0:n.getTime())||0)})[0]:t.newChat()}}});return t},w=(0,s.createContext)(y()),I=e=>{let{children:t}=e,a=(0,u.KT)(),[n]=(0,s.useState)(()=>y());return(0,s.useEffect)(()=>{let e=!0;return async function(){if(!(null==a?void 0:a.ref)){(null==a?void 0:a.ref)===void 0&&n.resetAiAssistantPanel();return}let t=null;if((t=await v(null==a?void 0:a.ref))||(t=await b(null==a?void 0:a.ref)),e){t&&n.loadPersistedState(t);{let e=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==e&&(n.open="true"===e)}if(!n.activeChatId||!n.chats[n.activeChatId]){let e=Object.keys(n.chats);e.length>0?n.activeChatId=e.sort((e,t)=>{var a,o;return((null==(a=n.chats[t].updatedAt)?void 0:a.getTime())||0)-((null==(o=n.chats[e].updatedAt)?void 0:o.getTime())||0)})[0]:n.newChat()}}}(),()=>{e=!1}},[null==a?void 0:a.ref,n]),(0,s.useEffect)(()=>{if(null==a?void 0:a.ref){let e=r()(g,500),t=(0,i.B1)(n,()=>{let t=(0,i.P9)(n);e({projectRef:null==a?void 0:a.ref,open:t.open,activeChatId:t.activeChatId,chats:t.chats?Object.entries(t.chats).reduce((e,t)=>{var a;let[o,n]=t;return{...e,[o]:{...n,messages:(null==(a=n.messages)?void 0:a.slice(-20))||[]}}},{}):{}})});return()=>{e.cancel(),t()}}},[n,null==a?void 0:a.ref]),(0,o.jsx)(w.Provider,{value:n,"data-sentry-element":"unknown","data-sentry-component":"AiAssistantStateContextProvider","data-sentry-source-file":"ai-assistant-state.tsx",children:t})},R=e=>{let t=(0,s.useContext)(w);return(0,c.s)(t,e)}},97872:(e,t,a)=>{a.d(t,{Om:()=>f,f2:()=>g,g3:()=>h});var o=a(80263),n=a(53239),l=a(54610),r=a(64036),s=a(89634),i=a(51626),c=a(32036),d=a(42230),u=a(39321),p=a(56163);let m=(0,n.createContext)({project:void 0,isLoading:!0}),f=()=>(0,n.useContext)(m),h=e=>{let{projectRef:t,children:a}=e,{data:r,isLoading:f}=(0,l.wT)({ref:t}),h=(0,n.useMemo)(()=>({project:r,isLoading:f}),[r,f]);return(0,o.jsx)(m.Provider,{value:h,"data-sentry-element":"unknown","data-sentry-component":"ProjectContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,o.jsx)(u.by,{"data-sentry-element":"TableEditorStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,o.jsx)(p.YD,{"data-sentry-element":"TabsStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,o.jsx)(s.Co,{"data-sentry-element":"AiAssistantStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,o.jsx)(d.y,{"data-sentry-element":"StorageExplorerStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,o.jsx)(i.UZ,{"data-sentry-element":"DatabaseSelectorStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,o.jsx)(c.ME,{"data-sentry-element":"RoleImpersonationStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:a},"role-impersonation-state-".concat(t))},"database-selector-state-".concat(t))},"storage-explorer-state-".concat(t))},"ai-assistant-state-".concat(t))},"tabs-state-".concat(t))},"table-editor-state-".concat(t))})},g=()=>{let{project:e}=f();return(null==e?void 0:e.status)===r.BU.ACTIVE_HEALTHY}}}]);