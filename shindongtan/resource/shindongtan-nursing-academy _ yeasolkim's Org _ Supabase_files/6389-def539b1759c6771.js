!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="11a6d8a2-d40d-40dd-bd49-83ecb7c5e8e1",e._sentryDebugIdIdentifier="sentry-dbid-11a6d8a2-d40d-40dd-bd49-83ecb7c5e8e1")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6389],{6263:(e,t,s)=>{s.d(t,{yA:()=>T,uJ:()=>S,TW:()=>z,Mn:()=>L,vY:()=>I,FI:()=>C});var a=s(80263),n=s(53434),r=s.n(n),o=s(42938),l=s(99709),i=s(28097),c=s(24560),d=s(64036),u=s(9093),h=s(51859),m=s(9729),x=s(51527),p=s(6579),g=s(21541),f=s(62659),v=s(24649),y=s(48460),j=s(53239),b=s(74115),w=s(71126);let k=e=>{let{col:t,setSortByValue:s}=e,n=(0,j.useRef)(0),[r,o]=(0,j.useState)(!1);return(0,j.useEffect)(()=>{n.current=Number(new Date)},[r]),(0,a.jsxs)("div",{className:"flex items-center justify-between font-normal text-xs w-full","data-sentry-component":"HeaderCell","data-sentry-source-file":"UsersGridComponents.tsx",children:[(0,a.jsx)("div",{className:"flex items-center gap-x-2",children:(0,a.jsx)("p",{className:"!text-foreground",children:t.name})}),["created_at","email","phone"].includes(t.id)&&(0,a.jsxs)(b.rI,{open:r,onOpenChange:e=>{!1===e&&Number(new Date)-n.current>100&&o(e)},children:[(0,a.jsx)(b.ty,{asChild:!0,children:(0,a.jsx)(w.$,{type:"text",icon:(0,a.jsx)(f.A,{}),className:"p-0 h-5 w-5",onClick:()=>o(!r)})}),(0,a.jsxs)(b.SQ,{className:"w-36",children:[(0,a.jsxs)(b._2,{className:"flex items-center gap-x-2",onClick:()=>{o(!1),s("".concat(t.id,":desc"))},children:[(0,a.jsx)(v.A,{size:14}),"Sort descending"]}),(0,a.jsxs)(b._2,{className:"flex items-center gap-x-2",onClick:()=>{o(!1),s("".concat(t.id,":asc"))},children:[(0,a.jsx)(y.A,{size:14}),"Sort ascending"]})]})]})]})},N="https://avatars.githubusercontent.com",_=[N,"https://lh3.googleusercontent.com"],I=e=>{let{currentTarget:t}=e;return t.scrollTop+10>=t.scrollHeight-t.clientHeight},S=e=>e.map(e=>{var t,s;let a=null!=(s=null==(t=e.raw_app_meta_data)?void 0:t.provider)?s:"",n=e.providers.map(e=>e.startsWith("sso")?"SAML":e);return{id:e.id,email:e.email,phone:e.phone,created_at:e.created_at,last_sign_in_at:e.last_sign_in_at,providers:e.is_anonymous?"-":n,provider_icons:n.map(e=>"email"===e?"".concat(d.o2,"/img/icons/email-icon2.svg"):"SAML"===e?"".concat(d.o2,"/img/icons/saml-icon.svg"):C[e]?"".concat(d.o2,"/img/icons/").concat(C[e],".svg"):void 0).filter(Boolean),provider_type:e.is_anonymous?"Anonymous":"email"===a?"-":E.includes(a)?"Social":R.includes(a)?"Phone":"-",img:z(e),name:L(e)}}),A={social:[{email:"email-icon2"},{apple:"apple-icon"},{azure:"microsoft-icon"},{bitbucket:"bitbucket-icon"},{discord:"discord-icon"},{facebook:"facebook-icon"},{figma:"figma-icon"},{github:"github-icon"},{gitlab:"gitlab-icon"},{google:"google-icon"},{kakao:"kakao-icon"},{keycloak:"keycloak-icon"},{linkedin_oidc:"linkedin-icon"},{notion:"notion-icon"},{twitch:"twitch-icon"},{twitter:"twitter-icon"},{slack_oidc:"slack-icon"},{slack:"slack-icon"},{spotify:"spotify-icon"},{workos:"workos-icon"},{zoom:"zoom-icon"}],phone:[{twilio:"twilio-icon"},{messagebird:"messagebird-icon"},{textlocal:"messagebird-icon"},{vonage:"messagebird-icon"},{twilioverify:"twilio-verify-icon"}]},C=Object.values([...A.social,...A.phone]).reduce((e,t)=>{let[[s,a]]=Object.entries(t);return{...e,[s]:a}},{}),E=A.social.map(e=>{let[t]=Object.keys(e);return t}),R=A.phone.map(e=>{let[t]=Object.keys(e);return t});function D(e){if(e){if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>D(e)).join(" ");try{return JSON.stringify(e)}catch(e){}}}function L(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{custom_claims:a,displayName:n,display_name:r,fullName:o,full_name:l,familyName:i,family_name:c,givenName:d,given_name:u,surname:h,lastName:m,last_name:x,firstName:p,first_name:g}=null!=(t=e.raw_user_meta_data)?t:{},{displayName:f,display_name:v,fullName:y,full_name:j,familyName:b,family_name:w,givenName:k,given_name:N,surname:_,lastName:I,last_name:S,firstName:A,first_name:C}=null!=a?a:{},E=D(i||c||h||m||x||b||w||_||I||S),R=D(d||u||p||g||k||N||A||C);return D(n||r||f||v||o||l||y||j||R&&E&&"".concat(R," ").concat(E)||E||R)||s}function z(e){var t;let{avatarUrl:s,avatarURL:a,avatar_url:n,profileUrl:r,profileURL:o,profile_url:l,profileImage:i,profile_image:c,profileImageUrl:d,profileImageURL:u,profile_image_url:h}=null!=(t=e.raw_user_meta_data)?t:{},m=s||a||n||i||c||r||o||l||d||u||h||"";if("string"!=typeof m)return;let x=_.some(e=>m.startsWith(e));try{let e=new URL(m);return e.searchParams.set("s","24"),x?m.startsWith(N)?e.href:m:void 0}catch(e){return x?m:void 0}}let T=e=>{var t;let{config:s,users:n,visibleColumns:d=[],setSortByValue:f,onSelectDeleteUser:v}=e,y=null!=(t=s.map(e=>e.id))?t:g.AF.map(e=>e.id),j=g.AF.map(e=>{var t,d,g;let y=s.find(t=>t.id===e.id);return{key:e.id,name:e.name,resizable:null==(t=e.resizable)||t,sortable:!1,draggable:!0,width:null!=(d=null==y?void 0:y.width)?d:e.width,minWidth:null!=(g=e.minWidth)?g:120,headerCellClass:"z-50 outline-none !shadow-none",renderHeaderCell:()=>{if("img"!==e.id)return(0,a.jsx)(k,{col:e,setSortByValue:f})},renderCell:t=>{let{row:s}=t,[d,g]=(0,c.Uk)(),f=null==s?void 0:s[e.id],y=null==n?void 0:n.find(e=>e.id===s.id),j=null!==f&&["created_at","last_sign_in_at"].includes(e.id)?r()(f).format("ddd DD MMM YYYY HH:mm:ss [GMT]ZZ"):Array.isArray(f)?"providers"===e.id?f.map(e=>{let t=p.S5.find(t=>"key"in t&&t.key===e||t.title.toLowerCase()===e);return null==t?void 0:t.title}).join(", "):f.join(", "):f,b=!!(null==y?void 0:y.confirmed_at);return"img"===e.id?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[(0,a.jsx)(u.S,{checked:d,onClick:e=>{e.stopPropagation(),g({row:s,type:"ROW",checked:!d,isShiftClick:e.shiftKey})}}),(0,a.jsx)("div",{className:(0,h.cn)("flex items-center justify-center w-6 h-6 rounded-full bg-center bg-cover bg-no-repeat",s.img?"border":"bg-selection"),style:{backgroundImage:s.img?"url('".concat(s.img,"')"):"none"},children:!s.img&&(0,a.jsx)(o.A,{size:12})})]}):(0,a.jsxs)(m.tz,{children:[(0,a.jsx)(m.Rc,{asChild:!0,children:(0,a.jsxs)("div",{className:(0,h.cn)("w-full flex items-center text-xs",e.id.includes("provider")?"capitalize":""),children:["providers"===e.id&&s.provider_icons.map((e,t)=>{let n=s.providers[t];return(0,a.jsx)("div",{className:"min-w-6 min-h-6 rounded-full border flex items-center justify-center bg-surface-75",style:{marginLeft:0===t?0:"-8px",zIndex:s.provider_icons.length-t},children:(0,a.jsx)("img",{width:16,src:e,alt:"".concat(n," auth icon"),className:(0,h.cn)("github"===n&&"dark:invert")},"".concat(null==y?void 0:y.id,"-").concat(n))})}),"last_sign_in_at"!==e.id||b?(0,a.jsx)("p",{className:(0,h.cn)("providers"===e.id&&"ml-1"),children:null===j?"-":j}):(0,a.jsx)("p",{className:"text-foreground-lighter",children:"Waiting for verification"})]})}),(0,a.jsxs)(m.Ip,{onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)(m.kt,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{let t="providers"===e.id?s.providers.join(", "):j;(0,x.l)(t)},children:[(0,a.jsx)(l.A,{size:12}),(0,a.jsxs)("span",{children:["Copy ","id"===e.id?e.name:e.name.toLowerCase()]})]}),(0,a.jsx)(m.K5,{}),(0,a.jsxs)(m.kt,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{y&&v(y)},children:[(0,a.jsx)(i.A,{size:12}),(0,a.jsx)("span",{children:"Delete user"})]})]})]})}}}),b=j.find(e=>"img"===e.key);return y.length>0&&(j=j.filter(e=>y.includes(e.key)).sort((e,t)=>y.indexOf(e.key)-y.indexOf(t.key))),0===d.length?j:[b].concat(j.filter(e=>d.includes(e.key)))}},21541:(e,t,s)=>{s.d(t,{AF:()=>i,GS:()=>o,UC:()=>l,jU:()=>r});var a=s(64036),n=s(6579);let r="px-5 py-5",o=20,l=n.S5.map(e=>({name:e.title,value:"key"in e?e.key:e.title.toLowerCase(),icon:"".concat(a.o2,"/img/icons/").concat(e.misc.iconKey,".svg"),iconClass:"GitHub"===e.title?"dark:invert":""})).concat(n.ns.properties.SMS_PROVIDER.enum.map(e=>({name:e.label,value:e.value,icon:"".concat(a.o2,"/img/icons/").concat(e.icon),iconClass:""}))),i=[{id:"img",name:"",minWidth:95,width:95,resizable:!1},{id:"id",name:"UID",width:280},{id:"name",name:"Display name",minWidth:0,width:150},{id:"email",name:"Email",width:300},{id:"phone",name:"Phone"},{id:"providers",name:"Providers",minWidth:150},{id:"provider_type",name:"Provider type",minWidth:150},{id:"created_at",name:"Created at",width:260},{id:"last_sign_in_at",name:"Last sign in at",width:260}]},36389:(e,t,s)=>{s.d(t,{g:()=>K,w:()=>H});var a=s(80263),n=s(53239),r=s(95793),o=s(71126),l=s(51859),i=s(62659),c=s(42938),d=s(32036),u=s(6263),h=s(74115),m=s(796);let x=e=>{let{isSelected:t=!1}=e,{resolvedTheme:s}=(0,m.D)();return(0,a.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"ServiceRoleIcon","data-sentry-source-file":"Icons.tsx",children:(0,a.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,a.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===s?"#7E868C":"#7E7E7E","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},p=e=>{let{isSelected:t=!1}=e,{resolvedTheme:s}=(0,m.D)();return(0,a.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AnonIcon","data-sentry-source-file":"Icons.tsx",children:(0,a.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,a.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===s?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},g=e=>{let{isSelected:t=!1}=e,{resolvedTheme:s}=(0,m.D)();return(0,a.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AuthenticatedIcon","data-sentry-source-file":"Icons.tsx",children:(0,a.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,a.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===s?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,a.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===s?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})};var f=s(44679),v=s(75547);let y=function(e){let{label:t,value:s,isSelected:n,onSelectedChange:r,icon:o}=e;return(0,a.jsxs)("label",{className:(0,l.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",n&&"border-foreground-muted hover:border-foreground-muted bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&r(s)},htmlFor:"role-".concat(s),"data-sentry-component":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationRadio.tsx",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[o&&(0,a.jsx)("div",{children:o}),n&&(0,a.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof n&&(0,a.jsx)(f.A,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===n&&(0,a.jsx)(v.A,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,a.jsx)("input",{id:"role-".concat(s),type:"radio",name:"role",value:s,checked:!!n,onChange:e=>{r(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,a.jsxs)("span",{className:(0,l.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",n&&"text-foreground"),children:[null!=t?t:s," role"]})]})};var j=s(56404),b=s(8945),w=s(95285),k=s(62763),N=s(77877),_=s(73969),I=s(19898),S=s(97872),A=s(48153),C=s(37632),E=s(48329),R=s(25400),D=s(95319),L=s(16988),z=s(71390),T=s(91378),M=s(67585),U=s(53010);let O=()=>{var e,t,s,r,c;let[h,m]=(0,n.useState)(""),[x,p]=(0,n.useState)("aal1"),[g,f]=(0,n.useState)(""),[v,y]=(0,n.useState)(""),{id:O}=(0,I.g)(),[P,H]=(0,D.M)(I.rS.USER_IMPERSONATION_SELECTOR_PREVIOUS_SEARCHES(O),[]),[K,B]=(0,n.useState)(!1),Y=(0,d.RY)(),$=(0,j.d7)(h,300),{project:V}=(0,S.Om)(),{data:q,isSuccess:J,isLoading:G,isError:Q,error:X,isFetching:ee,isPreviousData:et}=(0,C.aq)({projectRef:null==V?void 0:V.ref,connectionString:null==V?void 0:V.connectionString,keywords:$.trim().toLocaleLowerCase()},{keepPreviousData:!0}),es=(0,n.useMemo)(()=>{var e;return null!=(e=null==q?void 0:q.pages.flatMap(e=>e.result))?e:[]},[null==q?void 0:q.pages]),ea=(null==(e=Y.role)?void 0:e.type)==="postgrest"&&"authenticated"===Y.role.role&&"native"===Y.role.userType&&Y.role.user,en=(null==(t=Y.role)?void 0:t.type)==="postgrest"&&"authenticated"===Y.role.role&&"external"===Y.role.userType&&Y.role.externalAuth,er=function(e){let{data:t}=(0,R.op)({projectRef:e});return(0,n.useMemo)(()=>(function(e){if(e&&e.HOOK_CUSTOM_ACCESS_TOKEN_ENABLED)return(0,E.vw)(e.HOOK_CUSTOM_ACCESS_TOKEN_URI,e.HOOK_CUSTOM_ACCESS_TOKEN_SECRETS)})(t),[t])}(null==V?void 0:V.ref),[eo,el]=(0,n.useState)(!1);async function ei(e){el(!0),H(t=>[...t.filter(t=>t.id!==e.id),e].slice(-6)),(null==er?void 0:er.type)==="https"&&_.oR.info("Please note that HTTPS custom access token hooks are not yet supported in the dashboard.");try{await Y.setRole({type:"postgrest",role:"authenticated",userType:"native",user:e,aal:x},er)}catch(e){_.oR.error("Failed to impersonate user: ".concat(e.message))}el(!1)}async function ec(){el(!0);let e={};try{e=v?JSON.parse(v):{}}catch(e){_.oR.error("Invalid JSON in additional claims");return}try{await Y.setRole({type:"postgrest",role:"authenticated",userType:"external",externalAuth:{sub:g,additionalClaims:e},aal:x},er)}catch(e){_.oR.error("Failed to impersonate user: ".concat(e.message))}el(!1)}function ed(){Y.setRole(void 0),B(!1)}let eu=ea?(0,u.Mn)(ea,null!=(c=null!=(r=null!=(s=ea.email)?s:ea.phone)?r:ea.id)?c:"Unknown"):en?Y.role.externalAuth.sub:void 0;return(0,a.jsxs)("div",{className:"flex flex-col gap-1","data-sentry-component":"UserImpersonationSelector","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,a.jsx)("h2",{className:"text-foreground text-sm",children:eu?"Impersonating ".concat(eu):"Impersonate a User"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:ea||en?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),ea||en?(0,a.jsxs)(a.Fragment,{children:[ea&&(0,a.jsx)(W,{user:ea,onClick:ed,isImpersonating:!0,aal:x,isLoading:eo}),en&&(0,a.jsx)(F,{sub:Y.role.externalAuth.sub,onClick:ed,aal:x,isLoading:eo})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-2 relative",children:[(0,a.jsx)(L.A,{className:"table-editor-search border-none",icon:et&&ee?(0,a.jsx)(b.A,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,a.jsx)(w.A,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search by id, email, phone, or name...",onChange:e=>m(e.target.value),value:h,size:"small",actions:h&&(0,a.jsx)(o.$,{size:"tiny",type:"text",className:"px-1",onClick:()=>m(""),children:(0,a.jsx)(k.A,{size:12,strokeWidth:2})})}),(0,a.jsxs)(z.Nt,{children:[(0,a.jsx)(z.R6,{className:"group font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-1 w-full",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"Advanced options"}),(0,a.jsx)(i.A,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,a.jsxs)(z.Ke,{className:"mt-1 flex flex-col gap-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-4 text-sm text-foreground-light",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("h3",{children:"MFA assurance level"}),(0,a.jsxs)(U.I,{side:"top",className:"flex flex-col gap-1 max-w-96",children:[(0,a.jsxs)("p",{children:["AAL1 verifies users via standard login methods, while AAL2 adds a second authentication factor.",(0,a.jsx)("br",{}),"If you're not using MFA, you can leave this on AAL1."]}),(0,a.jsxs)("a",{href:"/docs/guides/auth/auth-mfa",target:"_blank",rel:"noreferrer",className:"flex items-center gap-x-1 opacity-50 hover:opacity-100 transition",children:["Learn more about MFA ",(0,a.jsx)(N.A,{size:14,strokeWidth:2})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-2 text-xs font-bold",children:[(0,a.jsx)("p",{className:"aal1"===x?void 0:"text-foreground-lighter",children:"AAL1"}),(0,a.jsx)(T.d,{checked:"aal2"===x,onCheckedChange:function(){p(e=>"aal2"===e?"aal1":"aal2")}}),(0,a.jsx)("p",{className:"aal2"===x?void 0:"text-foreground-lighter",children:"AAL2"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("h3",{className:"text-sm text-foreground-light",children:"External Auth Impersonation"}),(0,a.jsx)(U.I,{side:"top",className:"flex flex-col gap-1 max-w-96",children:(0,a.jsx)("p",{children:"Test RLS policies with external auth providers like Clerk or Auth0 by providing a user ID and optional claims."})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,a.jsx)(T.d,{checked:K,onCheckedChange:B}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Enable external auth impersonation"})]}),K&&(0,a.jsxs)("div",{className:"flex flex-col gap-y-4 mt-2 border rounded-md p-4 bg-surface-100",children:[(0,a.jsx)(L.A,{className:"border-strong",label:"External User ID",descriptionText:"The user ID from your external auth provider",placeholder:"e.g. user_abc123",value:g,onChange:e=>f(e.target.value),size:"small"}),(0,a.jsx)(L.A,{className:"border-strong",label:"Additional Claims (JSON)",descriptionText:"Optional: Add custom claims like org_id or roles",placeholder:'e.g. {"app_metadata": {"org_id": "org_456"}}',value:v,onChange:e=>y(e.target.value),size:"small"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{}),(0,a.jsx)(o.$,{type:"default",disabled:!g,onClick:ec,children:"Impersonate"})]})]})]})]})]}),!K&&(0,a.jsxs)(a.Fragment,{children:[G&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,a.jsx)(b.A,{className:"animate-spin",size:24}),(0,a.jsx)("span",{className:"text-foreground-light",children:"Loading users..."})]}),Q&&(0,a.jsx)(A.A,{error:X,subject:"Failed to retrieve users"}),J&&(es.length>0?(0,a.jsx)("div",{children:(0,a.jsx)("ul",{className:"divide-y max-h-[150px] overflow-y-scroll",role:"list",children:es.map(e=>(0,a.jsx)("li",{role:"listitem",children:(0,a.jsx)(Z,{user:e,onClick:ei,isLoading:eo})},e.id))})}):(0,a.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,a.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})})),P.length>0&&(0,a.jsx)("div",{className:"border-t",children:P.length>0?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(z.Nt,{className:"mt-2 relative",children:[(0,a.jsx)(z.R6,{className:"group font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-1 w-full",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"Recents"}),(0,a.jsx)(i.A,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,a.jsxs)(z.Ke,{className:"mt-1 flex flex-col gap-y-4",children:[(0,a.jsx)(o.$,{size:"tiny",type:"text",className:"absolute right-0 top-0 py-2 hover:bg-muted flex items-center text",onClick:function(){H([])},children:(0,a.jsx)("span",{className:"flex items-center",children:"Clear"})}),(0,a.jsx)(M.FK,{className:(0,l.cn)(P.length>3?"h-36":"h-auto"),children:(0,a.jsx)("ul",{className:"grid gap-2 ",children:P.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(Z,{user:e,onClick:ei})},e.id))})})]})]})}):(0,a.jsx)("div",{className:"p-4 text-center text-muted-foreground",children:"No recent searches"})})]})]})]})},P=e=>{let{onClick:t,aal:s,displayName:n,avatarUrl:r,isImpersonating:l=!1,isLoading:i=!1}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground","data-sentry-component":"BaseImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-4 pl-0.5 py-0.5 border rounded-full max-w-l",children:[r?(0,a.jsx)("img",{className:"rounded-full w-5 h-5",src:r,alt:n}):(0,a.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)(c.A,{size:12,strokeWidth:2})}),(0,a.jsxs)("span",{className:"text-sm truncate",children:[n," ",(0,a.jsx)("span",{className:"ml-2 text-foreground-lighter text-xs font-light",children:"aal2"===s?"AAL2":"AAL1"})]})]}),(0,a.jsx)(o.$,{type:"default",onClick:t,disabled:i,loading:i,"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:l?"Stop Impersonating":"Impersonate"})]})},W=e=>{var t,s,n;let{user:r,onClick:o,isImpersonating:l=!1,isLoading:i=!1,aal:c}=e,d=(0,u.TW)(r),h=(0,u.Mn)(r,null!=(n=null!=(s=null!=(t=r.email)?t:r.phone)?s:r.id)?n:"Unknown")+(r.is_anonymous?" (anonymous)":"");return(0,a.jsx)(P,{onClick:()=>o(r),aal:c,displayName:h,avatarUrl:d,isImpersonating:l,isLoading:i,"data-sentry-element":"BaseImpersonatingRow","data-sentry-component":"UserImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx"})},F=e=>{let{sub:t,onClick:s,aal:n,isLoading:r=!1}=e;return(0,a.jsx)(P,{onClick:s,aal:n,displayName:t,isImpersonating:!0,isLoading:r,"data-sentry-element":"BaseImpersonatingRow","data-sentry-component":"ExternalAuthImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx"})},Z=e=>{var t;let{user:s,onClick:n,isImpersonating:r=!1,isLoading:l=!1}=e,i=(0,u.TW)(s),d=s.email||s.phone,h=(0,u.Mn)(s,""),m=s.is_anonymous,x=h&&h!==d;return(0,a.jsxs)("div",{className:"flex items-center justify-between py-1 text-foreground","data-sentry-component":"UserRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[i?(0,a.jsx)("img",{className:"rounded-full w-5 h-5",src:i,alt:h||d}):(0,a.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border flex items-center justify-center text-foreground-lighter",children:(0,a.jsx)(c.A,{size:12,strokeWidth:2})}),(0,a.jsxs)("span",{className:"text-sm flex items-center gap-4",children:[d,x&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("span",{className:"text-foreground-lighter",children:[h,m?" (anonymous)":""]})}),(0,a.jsx)("span",{className:"text-foreground-light bg-surface-200 dark:bg-surface-400 rounded-md px-1 py-0.5 font-mono text-xs",children:null==s||null==(t=s.id)?void 0:t.slice(0,8)})]})]}),(0,a.jsx)(o.$,{type:"default",onClick:()=>n(s),disabled:l,loading:l,"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:r?"Stop Impersonating":"Impersonate"})]})},H=e=>{var t;let{serviceRoleLabel:s,padded:r=!0,disallowAuthenticatedOption:o=!1}=e,i=(0,d.RY)(),[c,u]=(0,n.useState)(()=>{var e;return(null==(e=i.role)?void 0:e.type)==="postgrest"&&("anon"===i.role.role||"authenticated"===i.role.role)?i.role.role:"service_role"}),m=!!("authenticated"===c&&(null==(t=i.role)?void 0:t.type)==="postgrest"&&"authenticated"===i.role.role&&("user"in i.role&&i.role.user||"externalAuth"in i.role&&i.role.externalAuth));function f(e){"service_role"===e&&i.setRole(void 0),"anon"===e&&i.setRole({type:"postgrest",role:e}),u(e)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,l.cn)("flex flex-col gap-3",r?"p-5":"pb-5"),children:[(0,a.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,a.jsxs)("fieldset",{className:"flex gap-3",children:[(0,a.jsx)(y,{value:"service_role",isSelected:"service_role"===c,onSelectedChange:f,label:s,icon:(0,a.jsx)(x,{isSelected:"service_role"===c}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,a.jsx)(y,{value:"anon",isSelected:"anon"===c,onSelectedChange:f,icon:(0,a.jsx)(p,{isSelected:"anon"===c}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),!o&&(0,a.jsx)(y,{value:"authenticated",isSelected:"authenticated"===c&&(m||"partially"),onSelectedChange:f,icon:(0,a.jsx)(g,{isSelected:"authenticated"===c})})]})}),"service_role"===c&&(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role.",o?(0,a.jsx)("br",{}):" ","This has admin privileges.",(0,a.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===c&&(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access".',o?(0,a.jsx)("br",{}):" ","This is the role which the API (PostgREST)",(0,a.jsx)("br",{}),"will use when a user is not logged in.",o?(0,a.jsx)("br",{}):" ","It will respect Row Level Security (RLS) policies."]}),"authenticated"===c&&(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST)',(0,a.jsx)("br",{}),"will use when a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.mB,{}),(0,a.jsx)("div",{className:(0,l.cn)("py-5",r&&"px-5"),children:(0,a.jsx)(O,{})})]})]})},K=e=>{var t,s,c,u;let{portal:h=!0,serviceRoleLabel:m,variant:x="regular",align:p="end",disallowAuthenticatedOption:g=!1}=e,f=(0,d.RY)(),[v,y]=(0,n.useState)(!1),j=null!=(u=null!=(c=null==(t=f.role)?void 0:t.role)?c:m)?u:"service role";return(0,a.jsxs)(r.AM,{open:v,onOpenChange:y,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"RoleImpersonationPopover","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[(0,a.jsx)(r.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,a.jsx)(o.$,{size:"tiny",type:"default",className:(0,l.cn)("h-[26px] pr-3 gap-0","connected-on-right"===x&&"rounded-r-none border-r-0","connected-on-left"===x&&"rounded-l-none border-l-0","connected-on-both"===x&&"rounded-none border-x-0"),"data-sentry-element":"Button","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-foreground-muted",children:"Role"}),(0,a.jsx)("span",{children:j}),(null==(s=f.role)?void 0:s.type)==="postgrest"&&"authenticated"===f.role.role&&(0,a.jsxs)(a.Fragment,{children:["native"===f.role.userType&&f.role.user?(0,a.jsx)(B,{user:f.role.user}):"external"===f.role.userType&&f.role.externalAuth?(0,a.jsx)(Y,{sub:f.role.externalAuth.sub}):null,(0,a.jsx)("span",{className:"text-xs text-foreground-lighter font-light",children:"aal2"===f.role.aal?"AAL2":"AAL1"})]}),(0,a.jsx)(i.A,{className:"text-muted",strokeWidth:1,size:12,"data-sentry-element":"ChevronDown","data-sentry-source-file":"RoleImpersonationPopover.tsx"})]})})}),(0,a.jsx)(r.hl,{portal:h,className:"p-0 w-full overflow-hidden",side:"bottom",align:p,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,a.jsx)(H,{serviceRoleLabel:m,disallowAuthenticatedOption:g,"data-sentry-element":"RoleImpersonationSelector","data-sentry-source-file":"RoleImpersonationPopover.tsx"})})]})},B=e=>{var t,s,n;let{user:r}=e,o=(0,u.TW)(r),l=(0,u.Mn)(r,null!=(n=null!=(s=null!=(t=r.email)?t:r.phone)?s:r.id)?n:"Unknown");return(0,a.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden","data-sentry-component":"UserRoleButtonSection","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[o?(0,a.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:o,alt:l}):(0,a.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,a.jsx)(c.A,{size:12,strokeWidth:2})}),(0,a.jsx)("span",{className:"truncate max-w-[84px]",children:l})]})},Y=e=>{let{sub:t}=e;return(0,a.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden","data-sentry-component":"ExternalAuthButtonSection","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[(0,a.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,a.jsx)(c.A,{size:12,strokeWidth:2,"data-sentry-element":"IconUser","data-sentry-source-file":"RoleImpersonationPopover.tsx"})}),(0,a.jsx)("span",{className:"truncate max-w-[84px]",children:t})]})}},37632:(e,t,s)=>{s.d(t,{aq:()=>c});var a=s(17702),n=s(96557),r=s(68875),o=s(64036),l=s(69830);let i=e=>{let{page:t=0,verified:s,keywords:a,providers:n,sort:r,order:o}=e,l=[];if(a&&""!==a){let e=a.replaceAll("'","''");l.push("id::text like '%".concat(e,"%' or email like '%").concat(e,"%' or phone like '%").concat(e,"%' or raw_user_meta_data->>'full_name' ilike '%").concat(e,"%' or raw_user_meta_data->>'first_name' ilike '%").concat(e,"%' or raw_user_meta_data->>'last_name' ilike '%").concat(e,"%' or raw_user_meta_data->>'display_name' ilike '%").concat(e,"%'"))}"verified"===s?l.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===s?l.push("is_anonymous is true"):"unverified"===s&&l.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),n&&n.length>0&&(n.includes("saml 2.0")?l.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(n.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):l.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(n.map(e=>"'".concat(e,"'")).join(", "),"]")));let i=l.map(e=>"(".concat(e,")")).join(" and ");return"".concat("\n  select *, coalesce((select array_agg(distinct i.provider) from auth.identities i where i.user_id = auth.users.id), '{}'::text[]) as providers from auth.users\n  ".trim()).concat(l.length>0?" where ".concat(i):"",' order by "').concat(null!=r?r:"created_at",'" ').concat(null!=o?o:"desc"," nulls last limit ").concat(50," offset ").concat(50*t,";")},c=function(e){let{projectRef:t,connectionString:s,keywords:c,filter:d,providers:u,sort:h,order:m}=e,{enabled:x=!0,...p}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=(0,r.KT)(),f=(null==g?void 0:g.status)===o.BU.ACTIVE_HEALTHY;return(0,a.q)(l.Z.usersInfinite(t,{keywords:c,filter:d,providers:u,sort:h,order:m}),e=>{let{signal:a,pageParam:r}=e;return(0,n.E)({projectRef:t,connectionString:s,sql:i({page:r,verified:d,keywords:c,providers:u,sort:null!=h?h:"created_at",order:null!=m?m:"desc"}),queryKey:l.Z.usersInfinite(t)},a)},{enabled:x&&void 0!==t&&f,getNextPageParam(e,t){let s=t.length;if(e.result.length>=50)return s},...p})}},48329:(e,t,s)=>{s.d(t,{IT:()=>r,U2:()=>n,vw:()=>a});let a=(e,t)=>{if(e.startsWith("https"))return{type:"https",url:e,secret:t||""};{let[t,s,a,n,r]=(e||"").split("/");return{type:"postgres",schema:n||"",functionName:r||""}}},n=e=>"postgres"===e.method.type&&e.method.schema.length>0&&e.method.functionName.length>0||"https"===e.method.type&&e.method.url.startsWith("https")&&e.method.secret.length>0,r=(e,t)=>["-- Revoke access to function from supabase_auth_admin\nrevoke execute on function ".concat(e,".").concat(t," from supabase_auth_admin;"),"-- Revoke access to schema from supabase_auth_admin\nrevoke usage on schema ".concat(e," from supabase_auth_admin;"),"-- Restore function permissions to authenticated, anon and public\ngrant execute on function ".concat(e,".").concat(t," to authenticated, anon, public;")]},53010:(e,t,s)=>{s.d(t,{I:()=>l});var a=s(80263),n=s(53239),r=s(16632);let o=(0,n.forwardRef)((e,t)=>(0,a.jsx)("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",...e,children:(0,a.jsx)("path",{d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",fillRule:"evenodd",clipRule:"evenodd"})})),l=(0,n.forwardRef)((e,t)=>{let{...s}=e;return(0,a.jsxs)(r.m_,{children:[(0,a.jsx)(r.k$,{type:"button",role:"button",className:"flex [&_svg]:data-[state=delayed-open]:fill-foreground-lighter [&_svg]:data-[state=instant-open]:fill-foreground-lighter",children:(0,a.jsx)(o,{strokeWidth:2,className:"transition-colors fill-foreground-muted w-4 h-4"})}),(0,a.jsx)(r.ZI,{...s})]})})},91378:(e,t,s)=>{s.d(t,{d:()=>d});var a=s(80263),n=s(44893),r=s(79279),o=s(53239),l=s(51859);let i=(0,r.F)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),c=(0,r.F)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),d=o.forwardRef((e,t)=>{let{className:s,size:r,...o}=e;return(0,a.jsx)(n.bL,{className:(0,l.cn)(i({size:r}),s),...o,ref:t,children:(0,a.jsx)(n.zi,{className:(0,l.cn)(c({size:r}))})})});d.displayName=n.bL.displayName}}]);